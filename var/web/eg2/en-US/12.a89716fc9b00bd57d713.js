(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"3RDE":function(e,t,r){"use strict";r.d(t,"b",(function(){return o})),r.d(t,"a",(function(){return c}));var a=r("3Pt+"),i=(r("f0Wu"),r("fXoL"));function o(e){return t=>t.value&&t.value.isBefore(e)?{tooEarly:"This cannot be before "+e.format("LLL")}:null}let c=(()=>{class e{validate(e){return this.notBeforeMoment?o(this.notBeforeMoment)(e):null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=i.Gb({type:e,selectors:[["","egNotBeforeMoment",""]],inputs:{notBeforeMoment:["egNotBeforeMoment","notBeforeMoment"]},features:[i.wb([{provide:a.q,useExisting:e,multi:!0}])]}),e})()},Pf76:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return f}));var a=r("fXoL"),i=r("3Pt+"),o=r("Osig"),c=r("8PDw"),n=r("LRne"),s=r("sVev"),b=r("cx9U"),l=r("eIep"),d=r("JIr8");let u=(()=>{class e{constructor(e,t){this.auth=e,this.net=t,this.validate=e=>this.parseActorCall(this.net.request("open-ils.actor","open-ils.actor.get_barcodes",this.auth.token(),this.auth.user().ws_ou(),"actor",e.value.trim())),this.parseActorCall=e=>e.pipe(Object(b.a)(),Object(l.a)(()=>Object(n.a)(null)),Object(d.a)(e=>e instanceof s.a?Object(n.a)({patronBarcode:"No patron found with that barcode"}):"Sequence contains more than one element"===e?Object(n.a)({patronBarcode:"Barcode matches more than one patron"}):void 0))}}return e.\u0275fac=function(t){return new(t||e)(a.cc(c.a),a.cc(o.b))},e.\u0275prov=a.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),f=(()=>{class e{constructor(e){this.pbv=e,this.validate=e=>{this.pbv.validate(e)}}}return e.\u0275fac=function(t){return new(t||e)(a.Lb(u))},e.\u0275dir=a.Gb({type:e,selectors:[["","egValidPatronBarcode",""]],features:[a.wb([{provide:i.p,useExisting:Object(a.S)(()=>u),multi:!0}])]}),e})()},UjDu:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var a,i,o=r("fXoL"),c=r("3Pt+"),n=r("8PDw"),s=r("cm5s"),b=r("wVJ/"),l=r("ofXK");function d(e,t){if(1&e){const e=o.Sb();o.Rb(0,"div",7),o.Rb(1,"input",8),o.fc("blur",(function(){return o.Bc(e),o.hc().propagateTouch()})),o.Qb(),o.Rb(2,"label",9),o.Vb(3,a),o.Qb(),o.Qb()}if(2&e){const e=o.hc();o.xb(1),o.qc("id","",e.domId,"-include-ancestors"),o.xb(1),o.qc("for","",e.domId,"-include-ancestors")}}function u(e,t){if(1&e){const e=o.Sb();o.Rb(0,"div",7),o.Rb(1,"input",10),o.fc("blur",(function(){return o.Bc(e),o.hc().propagateTouch()})),o.Qb(),o.Rb(2,"label",9),o.Vb(3,i),o.Qb(),o.Qb()}if(2&e){const e=o.hc();o.xb(1),o.qc("id","",e.domId,"-include-descendants"),o.xb(1),o.qc("for","",e.domId,"-include-descendants")}}a=$localize`:␟4615d2661fa26d4fc4a16370e015882a21fb0666␟6169615151051315407:+ Ancestors`,i=$localize`:␟834572c167c788dda79f6a184894c2c93fcac8c7␟8654149606703826544:+ Descendants`;let f=(()=>{class e{constructor(e,t){this.auth=e,this.org=t,this.labelText="Library",this.hideAncestorSelector=!1,this.hideDescendantSelector=!1,this.ancestorSelectorChecked=!1,this.descendantSelectorChecked=!1,this.propagateChange=e=>{},this.propagateTouch=()=>{}}ngOnInit(){this.selectedOrgId?this.options={primaryOrgId:this.selectedOrgId}:this.auth.user()&&(this.options={primaryOrgId:this.auth.user().ws_ou()}),this.familySelectors=new c.j({includeAncestors:new c.g({value:this.ancestorSelectorChecked,disabled:this.disableAncestorSelector()}),includeDescendants:new c.g({value:this.descendantSelectorChecked,disabled:this.disableDescendantSelector()})}),this.domId||(this.domId="org-family-select-"+Math.floor(1e5*Math.random())),this.familySelectors.valueChanges.subscribe(e=>{this.emitArray()}),this.orgOnChange=e=>{this.options.primaryOrgId=e.id(),this.disableAncestorSelector()?this.includeAncestors.disable():this.includeAncestors.enable(),this.disableDescendantSelector()?this.includeDescendants.disable():this.includeDescendants.enable(),this.emitArray()},this.emitArray=()=>{this.options.orgIds=[this.options.primaryOrgId],this.includeAncestors.value&&(this.options.orgIds=this.org.ancestors(this.options.primaryOrgId,!0)),this.includeDescendants.value&&(this.options.orgIds=this.options.orgIds.concat(this.org.descendants(this.options.primaryOrgId,!0)));const e={};this.options.orgIds.forEach(t=>e[t]=!0),this.options.orgIds=Object.keys(e).map(e=>Number(e)),this.propagateChange(this.options)}}writeValue(e){e&&(this.selectedOrgId=e.primaryOrgId,this.orgSelects&&(this.orgSelects.toArray()[0].applyOrgId=this.selectedOrgId,this.options={primaryOrgId:this.selectedOrgId}),this.familySelectors.patchValue({includeAncestors:!!e.includeAncestors&&e.includeAncestors,includeDescendants:!!e.includeDescendants&&e.includeDescendants}))}registerOnChange(e){this.propagateChange=e}registerOnTouched(e){this.propagateTouch=e}disableAncestorSelector(){return this.options.primaryOrgId===this.org.root().id()}disableDescendantSelector(){return 0===this.org.get(this.options.primaryOrgId).children().length}get includeAncestors(){return this.familySelectors.get("includeAncestors")}get includeDescendants(){return this.familySelectors.get("includeDescendants")}}return e.\u0275fac=function(t){return new(t||e)(o.Lb(n.a),o.Lb(s.a))},e.\u0275cmp=o.Fb({type:e,selectors:[["eg-org-family-select"]],viewQuery:function(e,t){var r;1&e&&o.Sc(b.a,!0),2&e&&o.yc(r=o.gc())&&(t.orgSelects=r)},inputs:{labelText:"labelText",hideAncestorSelector:"hideAncestorSelector",hideDescendantSelector:"hideDescendantSelector",ancestorSelectorChecked:"ancestorSelectorChecked",descendantSelectorChecked:"descendantSelectorChecked",selectedOrgId:"selectedOrgId",limitPerms:"limitPerms",domId:"domId"},features:[o.wb([{provide:c.r,useExisting:Object(o.S)(()=>e),multi:!0}])],decls:9,vars:7,consts:[[1,"form-inline",3,"formGroup"],[1,"input-group"],[1,"input-group-prepend"],[1,"input-group-text"],[3,"domId","limitPerms","applyOrgId","onChange"],[1,"ml-2","d-flex","flex-column","align-items-start"],["class","form-check",4,"ngIf"],[1,"form-check"],["type","checkbox","formControlName","includeAncestors",1,"form-check-input",3,"id","blur"],[1,"form-check-label",3,"for"],["type","checkbox","formControlName","includeDescendants",1,"form-check-input",3,"id","blur"]],template:function(e,t){1&e&&(o.Rb(0,"form",0),o.Rb(1,"div",1),o.Rb(2,"div",2),o.Rb(3,"span",3),o.Mc(4),o.Qb(),o.Qb(),o.Rb(5,"eg-org-select",4),o.fc("onChange",(function(e){return t.orgOnChange(e)})),o.Qb(),o.Qb(),o.Rb(6,"div",5),o.Kc(7,d,4,2,"div",6),o.Kc(8,u,4,2,"div",6),o.Qb(),o.Qb()),2&e&&(o.oc("formGroup",t.familySelectors),o.xb(4),o.Nc(t.labelText),o.xb(1),o.oc("domId",t.domId)("limitPerms",t.limitPerms)("applyOrgId",t.selectedOrgId),o.xb(2),o.oc("ngIf",!t.hideAncestorSelector),o.xb(1),o.oc("ngIf",!t.hideDescendantSelector))},directives:[c.J,c.u,c.k,b.a,l.v,c.a,c.t,c.i],encapsulation:2}),e})()},csFu:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var a=r("VEwP"),i=r("pKmL"),o=r("r2N+"),c=r("3Pt+"),n=r("fXoL");let s=(()=>{class e{}return e.\u0275mod=n.Jb({type:e}),e.\u0275inj=n.Ib({factory:function(t){return new(t||e)},providers:[],imports:[[a.a,i.a,o.a,c.D]]}),e})()},cx9U:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var a=r("7o/Q"),i=r("sVev");function o(e){return t=>t.lift(new c(e,t))}class c{constructor(e,t){this.predicate=e,this.source=t}call(e,t){return t.subscribe(new n(e,this.predicate,this.source))}}class n extends a.a{constructor(e,t,r){super(e),this.predicate=t,this.source=r,this.seenValue=!1,this.index=0}applySingleValue(e){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=e)}_next(e){const t=this.index++;this.predicate?this.tryNext(e,t):this.applySingleValue(e)}tryNext(e,t){try{this.predicate(e,t,this.source)&&this.applySingleValue(e)}catch(r){this.destination.error(r)}}_complete(){const e=this.destination;this.index>0?(e.next(this.seenValue?this.singleValue:void 0),e.complete()):e.error(new i.a)}}},zRzw:function(e,t,r){"use strict";r.r(t),r.d(t,"BookingModule",(function(){return Li}));var a=r("3Pt+"),i=r("MZHd"),o=r("tyNb"),c=r("LRne"),n=r("Kj3r"),s=r("eIep"),b=r("8PDw"),l=r("Osig"),d=r("tNQm"),u=r("YRS1"),f=r("fXoL"),p=r("JIr8"),h=r("iA0r");let g=(()=>{class e{constructor(e){this.pcrud=e,this.validate=e=>this.pcrud.search("brsrc",{barcode:e.value},{limit:1}).pipe(Object(s.a)(()=>Object(c.a)(null)),Object(p.a)(e=>Object(c.a)({resourceBarcode:"No resource found with that barcode"})))}}return e.\u0275fac=function(t){return new(t||e)(f.cc(h.a))},e.\u0275prov=f.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var m=r("vkgz"),v=r("5+tZ"),y=r("E45d");let R=(()=>{class e{constructor(e,t,r,a){this.auth=e,this.pcrud=t,this.printer=r,this.router=a,this.manageReservationsByResource=e=>{this.router.navigate(["/staff","booking","manage_reservations","by_resource",e])},this.printCaptureSlip=e=>{e.staff=this.auth.user(),e.workstation=this.auth.workstation(),this.printer.print({templateName:"booking_capture",contextData:e,printContext:"receipt"})},this.reprintCaptureSlip=e=>this.fetchDataForCaptureSlip$(e).pipe(Object(m.a)(e=>this.printCaptureSlip(e))),this.viewItemStatus=e=>{this.pcrud.search("acp",{barcode:e},{limit:1}).subscribe(e=>{window.open("/eg/staff/cat/item/"+e.id())})},this.notOneUniqueSelected=e=>1!==new Set(e).size,this.fetchDataForCaptureSlip$=e=>this.pcrud.search("bresv",{id:e},{flesh:2,flesh_fields:{bresv:["usr","current_resource","type"],au:["card"],brsrc:["type"]}}).pipe(Object(v.a)(e=>this.assembleDataForCaptureSlip$(e))),this.assembleDataForCaptureSlip$=e=>{let t=Object(c.a)({reservation:e,captured:1});return e.pickup_lib()===this.auth.user().ws_ou()&&(t=this.pcrud.search("artc",{reservation:e.id()},{limit:1}).pipe(Object(s.a)(t=>Object(c.a)({reservation:e,captured:1,transit:t})))),t}}}return e.\u0275fac=function(t){return new(t||e)(f.cc(b.a),f.cc(h.a),f.cc(y.a),f.cc(o.c))},e.\u0275prov=f.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var _,O=r("Cfvw"),Q=r("UUQ6"),S=r("ZvpF"),I=r("9Zsr"),x=r("MWGh"),w=r("cm5s"),k=r("rRT/");_=$localize`:␟8d544c3af453e872c2c6200bdf951e3bd2d19c53␟6376962826280870178:Timezone not set for your library`;const T=["aria-label",$localize`:␟f4e529ae5ffd73001d1ff4bbdeeb0a72e342e5c8␟7819314041543176992:Close`];var z,C,$;function L(e,t){if(1&e){const e=f.Sb();f.Rb(0,"div",1),f.Rb(1,"h4",2),f.Vb(2,_),f.Qb(),f.Rb(3,"button",3),f.Xb(4,T),f.fc("click",(function(){return f.Bc(e),f.hc().dismiss("cross_click")})),f.Rb(5,"span",4),f.Mc(6,"\xd7"),f.Qb(),f.Qb(),f.Qb(),f.Rb(7,"div",5),f.bc(8,z),f.Rb(9,"p"),f.Mb(10,"i"),f.Qb(),f.Yb(),f.Qb(),f.Rb(11,"div",6),f.Rb(12,"button",7),f.fc("click",(function(){return f.Bc(e),f.hc().openLSE()})),f.Vb(13,C),f.Qb(),f.Rb(14,"button",8),f.fc("click",(function(){return f.Bc(e),f.hc().dismiss("canceled")})),f.Vb(15,$),f.Qb(),f.Qb()}}z=$localize`:␟b70f1361078982a7ad29c2791b853324d994d0ce␟4827774345529307183:${"\ufffd#9\ufffd"}:START_PARAGRAPH:Please make sure that ${"\ufffd#10\ufffd"}:START_ITALIC_TEXT:lib.timezone${"\ufffd/#10\ufffd"}:CLOSE_ITALIC_TEXT: has a valid value in the Library Settings Editor.${"\ufffd/#9\ufffd"}:CLOSE_PARAGRAPH:`,C=$localize`:␟b44d1a3f91b0fbf677b5146dca2e874e285d1dae␟6682548463162595844:Go to Library Settings Editor`,$=$localize`:␟401705d097ac3f045677ffdde9961d28a68b46a0␟6621917341438113980:Continue anyway`;let B=(()=>{class e extends k.a{openLSE(){window.open("/eg/staff/admin/local/asset/org_unit_settings","_blank")}}return e.\u0275fac=function(t){return D(t||e)},e.\u0275cmp=f.Fb({type:e,selectors:[["eg-no-timezone-set-dialog"]],features:[f.ub],decls:2,vars:0,consts:[["dialogContent",""],[1,"modal-header","bg-info"],[1,"modal-title"],["type","button",1,"close",3,"click",6,"aria-label"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-success",3,"click"],["type","button",1,"btn","btn-warning",3,"click"]],template:function(e,t){1&e&&f.Kc(0,L,16,0,"ng-template",null,0,f.Lc)},encapsulation:2}),e})();const D=f.Tb(B);var j=r("36iw");const P=["confirmCancelReservationDialog"],V=["dialogTitle",$localize`:␟e5104f883b5029525ccb30951c4eaaa653f97042␟1272605907958035192:Confirm Cancelation`];var A,N;function X(e,t){if(1&e&&(f.Rb(0,"span"),f.Vb(1,N),f.Qb()),2&e){const e=f.hc();f.xb(1),f.Zb(e.reservations.length)(e.reservations.length),f.Wb(1)}}A=$localize`:␟8fefd96eca15b727ba8db0171580c7eb7d5ec23b␟6392678350521948481:{VAR_PLURAL, plural, =1 {this reservation} other {these {INTERPOLATION} reservations}}`,A=f.ac(A,{VAR_PLURAL:"\ufffd0\ufffd",INTERPOLATION:"\ufffd1\ufffd"}),N=$localize`:␟719be0f6113aea15805bc5c2e0e1238bf4cfcf60␟5318380763021940082: Are you sure you want to cancel ${A}:ICU:? `;let G=(()=>{class e{constructor(e,t,r){this.auth=e,this.net=t,this.toast=r,this.onSuccessfulCancel=new f.n}open(e){this.reservations=e,this.cancelReservationDialog.open().pipe(Object(s.a)(()=>this.net.request("open-ils.booking","open-ils.booking.reservations.cancel",this.auth.token(),e))).subscribe(e=>{e.textcode?this.toast.danger("Could not cancel reservation"):(this.toast.success("Reservation successfully canceled"),this.onSuccessfulCancel.emit())})}}return e.\u0275fac=function(t){return new(t||e)(f.Lb(b.a),f.Lb(l.b),f.Lb(u.a))},e.\u0275cmp=f.Fb({type:e,selectors:[["eg-cancel-reservation-dialog"]],viewQuery:function(e,t){var r;1&e&&f.Ic(P,!0),2&e&&f.yc(r=f.gc())&&(t.cancelReservationDialog=r.first)},outputs:{onSuccessfulCancel:"onSuccessfulCancel"},decls:5,vars:1,consts:[[3,"dialogBodyTemplate",6,"dialogTitle"],["confirmCancelReservationDialog",""],["confirmMessage",""]],template:function(e,t){if(1&e&&(f.Rb(0,"eg-confirm-dialog",0,1),f.Xb(2,V),f.Qb(),f.Kc(3,X,2,2,"ng-template",null,2,f.Lc)),2&e){const e=f.zc(4);f.oc("dialogBodyTemplate",e)}},directives:[j.a],encapsulation:2}),e})();var M=r("f0Wu"),F=r("QGNW"),E=r("ofXK"),K=r("t7hH"),q=r("eXX1"),U=r("vG6Q"),H=r("3RDE");const J=["grid"],W=["editDialog"],Z=["confirmCancelReservationDialog"],Y=["noTimezoneSetDialog"],ee=["label",$localize`:␟c525cbf6c3ff841184f81b04f0303bce644b1c51␟2886653045266158715:Edit Selected`],te=["label",$localize`:␟864a74fcf43e35646fa5b4044996dce75d9224b0␟4631443662332502920:Cancel Selected`],re=["label",$localize`:␟5147d9d66e208c2b6b2202e31aa61173bb0e4089␟933921798150896612:Reprint Capture Slip`],ae=["label",$localize`:␟69e5bea20da96f14ef47287e1757fdaed5e0b4ef␟2690693254017561816:Pick Up Selected`],ie=["label",$localize`:␟bc4a167ef5c5a9d5d190e03fb45043007a5958b4␟6052558249322238398:Return Selected`],oe=["label",$localize`:␟f8c57953371f041de2749f57418d6a1c1421df77␟7172445714733252046:View Patron Record`],ce=["label",$localize`:␟2000145ed29fb08ede6a0aa836883149e4ad7009␟2916516996724582850:View Reservations for This Patron`],ne=["label",$localize`:␟1de6b559c8ef8d3c9a044d0f8944e2ad3907eab7␟2449572130417759292:View Item Status`],se=["label",$localize`:␟38125d8aada23aff979f4b47323f42654b83ae14␟7116064472023363630:View Reservations for This Resource`],be=["label",$localize`:␟45cc8ca94b5a50842a9a8ef804a5ab089a38ae5c␟8040881171107393560:ID`],le=["label",$localize`:␟10520beefe056bbeff8b1333db6283af4182b1db␟5779041452883100612:Patron username`],de=["label",$localize`:␟a5af88d641d9f4f325017b9951c6afed7477566d␟4713151336247961822:Patron barcode`],ue=["label",$localize`:␟608e773333d59a85d7d46e8ace5362c5d3e9ce2b␟1997357726019367256:Patron first name`],fe=["label",$localize`:␟68b5306e302ed93681c3a166f9069744bcec2c1e␟270011572726624557:Patron middle name`],pe=["label",$localize`:␟8a434213205753ef58416efc33c2e42d39233f4b␟3463103327638524924:Patron family name`],he=["label",$localize`:␟7c0a71d337783e527c1c8e91e433b301c5b1d8a8␟4204880191779081093:Start Time`],ge=["label",$localize`:␟e1f10d9bf4d3c37490cd5bf82007444ae7af46b1␟3845185958891849368:End Time`],me=["label",$localize`:␟ec5a209facfd9fd29a37d145e0fc0439656c536e␟2957208724344476932:Request Time`],ve=["label",$localize`:␟bdbe2bf40307c36d3f877c043bb68037b6e05ceb␟7684679030975813040:Capture Time`],ye=["label",$localize`:␟a0e84031a69671df8e78da7184dc7eaa5b6090d0␟4804735999662853878:Pickup Time`],Re=["label",$localize`:␟d49ccccf68e6e36b4806e76548cc74afce4125e3␟115800162501069231:Email notify`],_e=["label",$localize`:␟85cd29a2b20a1a8971d9fe124be91ec2429bf996␟7704378054769491892:Billing total`],Oe=["label",$localize`:␟0546bad43ac72e425705c268d6aaf75a60211e3e␟1915397274948123092:Payment total`],Qe=["label",$localize`:␟c0f6aad7dc5650076b575683fbb398779e398a83␟5569000452720146687:Booking interval`],Se=["label",$localize`:␟79abf99af1ff5b99b7e8584427ee34f3ed7bb7b9␟519552556048661339:Fine interval`],Ie=["label",$localize`:␟106196711e7dc761c7c2e53d05bcb24bb1fda46c␟6284945585858649478:Fine amount`],xe=["label",$localize`:␟b86935542cac1ca860e0998ecb0d386f43572a23␟2770558010311977337:Maximum fine`],we=["label",$localize`:␟ff0d06c5cec6ec35e06bc6bd785a742474c84c23␟7812404654519474952:Resource Barcode`],ke=["label",$localize`:␟5c54befce78d70e20c215f10a00e617245f53bc9␟4388879716045736175:Note`],Te=["label",$localize`:␟a15e0231f8585af4515291b8ce367eb13749e391␟773041829051514672:Resource Type`],ze=["label",$localize`:␟2fc5c4bada61b67b316b81e2eefaeede87e70dae␟7020825193111193715:Reservation length`],Ce=["label",$localize`:␟99d4a100ba51f90ac4962b7c7b630fedb4f94cf0␟5951699041646176965:Request library`],$e=["label",$localize`:␟0af1c463769865497f9776f1207fe37e242a0e73␟4981002288470877556:Reservation location`],Le=["label",$localize`:␟c938a0aed096723dd1231467fa1c517d70c9ec69␟2017054093951071070:Reservation location timezone`],Be=["label",$localize`:␟0db1427766fab2a75d7b7babd6ceefec696c3ed3␟793765545064154154:Create New Reservation`];function De(e,t){if(1&e){const e=f.Sb();f.Rb(0,"eg-grid-toolbar-button",37),f.Xb(1,Be),f.fc("onClick",(function(t){return f.Bc(e),f.hc().redirectToCreate(t)})),f.Qb()}}const je=["label",$localize`:␟69e5bea20da96f14ef47287e1757fdaed5e0b4ef␟2690693254017561816:Pick Up Selected`];function Pe(e,t){if(1&e){const e=f.Sb();f.Rb(0,"eg-grid-toolbar-button",38),f.Xb(1,je),f.fc("onClick",(function(t){return f.Bc(e),f.hc().pickupSelected(t)})),f.Qb()}if(2&e){f.hc();const e=f.zc(1);f.oc("disabled",!e.context.getSelectedRows().length)}}const Ve=["label",$localize`:␟bc4a167ef5c5a9d5d190e03fb45043007a5958b4␟6052558249322238398:Return Selected`];function Ae(e,t){if(1&e){const e=f.Sb();f.Rb(0,"eg-grid-toolbar-button",38),f.Xb(1,Ve),f.fc("onClick",(function(t){return f.Bc(e),f.hc().returnSelected(t)})),f.Qb()}if(2&e){f.hc();const e=f.zc(1);f.oc("disabled",!e.context.getSelectedRows().length)}}function Ne(e,t){if(1&e){const e=f.Sb();f.Rb(0,"eg-datetime-select",39),f.fc("onChangeAsIso",(function(r){return f.Bc(e),t.record[t.field.name](r)})),f.Qb()}if(2&e){const e=t.field,r=t.record,a=f.hc(),i=f.zc(75);f.pc("initialIso",r[e.name]()),f.oc("showTZ",i.timezone)("timezone",i.timezone)("egNotBeforeMoment",a.momentizeIsoString(r.start_time(),i.timezone))("readOnly",e.readOnly)}}const Xe=function(e){return{template:e}},Ge=function(e){return{customTemplate:e}},Me=function(e){return{end_time:e}};let Fe=(()=>{class e{constructor(e,t,r,a,i,o,n,b){this.auth=e,this.format=t,this.pcrud=r,this.router=a,this.toast=i,this.net=o,this.org=n,this.actions=b,this.onlyCaptured=!1,this.onPickup=new f.n,this.onReturn=new f.n,this.enrichRow$=e=>Object(O.a)(this.org.settings("lib.timezone",e.pickup_lib().id())).pipe(Object(s.a)(t=>(e.length=M(e.end_time()).from(M(e.start_time()),!0),e.timezone=t["lib.timezone"],Object(c.a)(e))))}ngOnInit(){this.format.wsOrgTimezone||this.noTimezoneSetDialog.open(),this.gridSource=new x.c,this.gridSource.getRows=(e,t)=>{const r={},a={usr:this.patron?this.patron:{">":0},target_resource_type:this.resourceType?this.resourceType:{">":0},cancel_time:null,xact_finish:null};return this.resourceBarcode&&(a.current_resource={in:{from:"brsrc",select:{brsrc:["id"]},where:{barcode:this.resourceBarcode}}}),this.pickupLibIds&&(a.pickup_lib=this.pickupLibIds),this.onlyCaptured&&(a.capture_time={"!=":null}),this.status?"pickupReady"===this.status?(a.pickup_time=null,a.start_time={"!=":null}):"pickedUp"===this.status||"returnReady"===this.status?(a.pickup_time={"!=":null},a.return_time=null):"returnedToday"===this.status?a.return_time={">":M().startOf("day").toISOString()}:"capturedToday"===this.status&&(a.capture_time={between:[M().startOf("day").toISOString(),M().add(1,"day").startOf("day").toISOString()]}):a.return_time=null,t.length&&(r.bresv=t[0].name+" "+t[0].dir),this.pcrud.search("bresv",a,{order_by:r,limit:e.limit,offset:e.offset,flesh:2,flesh_fields:{bresv:["usr","capture_staff","target_resource","target_resource_type","current_resource","request_lib","pickup_lib"],au:["card"]}}).pipe(Object(v.a)(e=>this.enrichRow$(e)))},this.editDialog.mode="update",this.editSelected=e=>{const t=r=>{r&&this.showEditDialog(r).then(()=>t(e.shift()))};t(e.shift())},this.cancelSelected=e=>{this.cancelReservationDialog.open(e.map(e=>e.id()))},this.viewByResource=e=>{this.actions.manageReservationsByResource(e[0].current_resource().barcode())},this.viewByPatron=e=>{const t=e.map(e=>e.usr().id());this.router.navigate(["/staff","booking","manage_reservations","by_patron",t[0]])},this.viewItemStatus=e=>{this.actions.viewItemStatus(e[0].current_resource().barcode())},this.viewPatronRecord=e=>{const t=e.map(e=>e.usr().id());window.open("/eg/staff/circ/patron/"+t[0]+"/checkout")},this.noSelectedRows=e=>0===e.length,this.notOnePatronSelected=e=>this.actions.notOneUniqueSelected(e.map(e=>e.usr().id())),this.notOneResourceSelected=e=>this.actions.notOneUniqueSelected(e.map(e=>{if(e.current_resource())return e.current_resource().id()})),this.notOneCatalogedItemSelected=e=>this.actions.notOneUniqueSelected(e.filter(e=>e.current_resource()&&"t"===e.target_resource_type().catalog_item()).map(e=>e.current_resource().id())),this.cancelNotAppropriate=e=>this.noSelectedRows(e)||["pickedUp","returnReady","returnedToday"].includes(this.status),this.pickupNotAppropriate=e=>this.noSelectedRows(e)||!("pickupReady"===this.status||"capturedToday"===this.status),this.editNotAppropriate=e=>this.noSelectedRows(e)||"returnedToday"===this.status,this.reprintNotAppropriate=e=>!!this.noSelectedRows(e)||"capturedToday"!==this.status&&!!e.filter(e=>!e.capture_time()).length,this.returnNotAppropriate=e=>!!this.noSelectedRows(e)||!(!this.status||"pickupReady"!==this.status&&"capturedToday"!==this.status)||(e.forEach(e=>{if(null==e.pickup_time()||e.return_time())return!0}),!1),this.pickupSelected=e=>{const t=r=>{r&&this.pickupResource(r).subscribe(()=>t(e.shift()))};t(e.shift())},this.returnSelected=e=>{const t=r=>{r&&this.returnResource(r).subscribe(()=>t(e.shift()))};t(e.shift())},this.reprintCaptureSlip=e=>{this.actions.reprintCaptureSlip(e.map(e=>e.id())).subscribe()},this.pickupResource=e=>this.net.request("open-ils.circ","open-ils.circ.reservation.pickup",this.auth.token(),{patron_barcode:e.usr().card().barcode(),reservation:e}).pipe(Object(m.a)(()=>{this.onPickup.emit(e),this.grid.reload()})),this.returnResource=e=>this.net.request("open-ils.circ","open-ils.circ.reservation.return",this.auth.token(),{patron_barcode:this.patronBarcode,reservation:e}).pipe(Object(m.a)(()=>{this.onReturn.emit(e),this.grid.reload()})),this.listReadOnlyFields=()=>{let e="usr,xact_start,request_time,capture_time,pickup_time,return_time,capture_staff,target_resource_type,email_notify,current_resource,target_resource,unrecovered,request_lib,pickup_lib,fine_interval,fine_amount,max_fine";return this.status&&"pickupReady"!==this.status&&(e+=",start_time"),this.status&&"returnedToday"===this.status&&(e+=",end_time"),e},this.handleRowActivate=e=>{this.status?"returnReady"===this.status?this.returnResource(e).subscribe():"pickupReady"===this.status?this.pickupResource(e).subscribe():"returnedToday"===this.status?this.toast.warning("Cannot edit this reservation"):this.showEditDialog(e):this.showEditDialog(e)},this.redirectToCreate=()=>{this.router.navigate(["/staff","booking","create_reservation"])}}ngOnChanges(){this.reloadGrid()}reloadGrid(){this.grid.reload()}showEditDialog(e){return this.editDialog.recordId=e.id(),this.editDialog.timezone=e.timezone,new Promise((e,t)=>{this.editDialog.open({size:"lg"}).subscribe(t=>{this.toast.success("Reservation successfully updated"),this.grid.reload(),e(t)},e=>{})})}filterByResourceBarcode(e){this.router.navigate(["/staff","booking","manage_reservations","by_resource",e])}momentizeIsoString(e,t){return this.format.momentizeIsoString(e,t)}}return e.\u0275fac=function(t){return new(t||e)(f.Lb(b.a),f.Lb(S.a),f.Lb(h.a),f.Lb(o.c),f.Lb(u.a),f.Lb(l.b),f.Lb(w.a),f.Lb(R))},e.\u0275cmp=f.Fb({type:e,selectors:[["eg-reservations-grid"]],viewQuery:function(e,t){var r;1&e&&(f.Ic(J,!0),f.Ic(W,!0),f.Ic(Z,!0),f.Ic(Y,!0)),2&e&&(f.yc(r=f.gc())&&(t.grid=r.first),f.yc(r=f.gc())&&(t.editDialog=r.first),f.yc(r=f.gc())&&(t.cancelReservationDialog=r.first),f.yc(r=f.gc())&&(t.noTimezoneSetDialog=r.first))},inputs:{patron:"patron",resourceBarcode:"resourceBarcode",resourceType:"resourceType",pickupLibIds:"pickupLibIds",status:"status",persistSuffix:"persistSuffix",onlyCaptured:"onlyCaptured"},outputs:{onPickup:"onPickup",onReturn:"onReturn"},features:[f.vb],decls:82,vars:41,consts:[[3,"dataSource","sortable","useLocalSort","persistKey","onRowActivate"],["grid",""],[3,"disableOnRows","onClick",6,"label"],[3,"onClick",4,"ngIf",6,"label"],[3,"disabled","onClick",4,"ngIf",6,"label"],["name","id","path","id",3,"hidden","index",6,"label"],["path","usr.usrname",3,"hidden",6,"label"],["path","usr.card.barcode",6,"label"],["path","usr.first_given_name",6,"label"],["path","usr.second_given_name",3,"hidden",6,"label"],["path","usr.family_name",6,"label"],["name","start_time","path","start_time","datatype","timestamp",3,"datePlusTime",6,"label"],["name","end_time","path","end_time","datatype","timestamp",3,"datePlusTime",6,"label"],["name","request_time","path","request_time","datatype","timestamp",3,"datePlusTime",6,"label"],["name","capture_time","path","capture_time","datatype","timestamp",3,"datePlusTime",6,"label"],["name","pickup_time","path","pickup_time","datatype","timestamp",3,"datePlusTime",6,"label"],["path","email_notify","datatype","bool",3,"hidden",6,"label"],["path","unrecovered","datatype","bool",3,"hidden"],["path","billing_total","datatype","money",6,"label"],["path","payment_total","datatype","money",6,"label"],["path","booking_interval",3,"hidden",6,"label"],["path","fine_interval",3,"hidden",6,"label"],["path","fine_amount","datatype","money",3,"hidden",6,"label"],["path","max_fine","datatype","money",3,"hidden",6,"label"],["path","current_resource.barcode",6,"label"],["path","note",6,"label"],["path","target_resource_type.name",6,"label"],["path","length",6,"label"],["path","request_lib.name",6,"label"],["path","pickup_lib.name",6,"label"],["path","timezone",6,"label"],["idlClass","bresv","datetimeFields","start_time,end_time","hiddenFields","xact_start,xact_finish,cancel_time,booking_interval",3,"fieldOptions","readonlyFields"],["editDialog",""],[3,"onSuccessfulCancel"],["confirmCancelReservationDialog",""],["noTimezoneSetDialog",""],["endTimeTemplate",""],[3,"onClick",6,"label"],[3,"disabled","onClick",6,"label"],["domId","endTime",3,"showTZ","timezone","egNotBeforeMoment","readOnly","initialIso","onChangeAsIso"]],template:function(e,t){if(1&e){const e=f.Sb();f.Rb(0,"eg-grid",0,1),f.fc("onRowActivate",(function(e){return t.handleRowActivate(e)})),f.Rb(2,"eg-grid-toolbar-action",2),f.Xb(3,ee),f.fc("onClick",(function(e){return t.editSelected(e)})),f.Qb(),f.Rb(4,"eg-grid-toolbar-action",2),f.Xb(5,te),f.fc("onClick",(function(e){return t.cancelSelected(e)})),f.Qb(),f.Rb(6,"eg-grid-toolbar-action",2),f.Xb(7,re),f.fc("onClick",(function(e){return t.reprintCaptureSlip(e)})),f.Qb(),f.Rb(8,"eg-grid-toolbar-action",2),f.Xb(9,ae),f.fc("onClick",(function(e){return t.pickupSelected(e)})),f.Qb(),f.Rb(10,"eg-grid-toolbar-action",2),f.Xb(11,ie),f.fc("onClick",(function(e){return t.returnSelected(e)})),f.Qb(),f.Rb(12,"eg-grid-toolbar-action",2),f.Xb(13,oe),f.fc("onClick",(function(e){return t.viewPatronRecord(e)})),f.Qb(),f.Rb(14,"eg-grid-toolbar-action",2),f.Xb(15,ce),f.fc("onClick",(function(e){return t.viewByPatron(e)})),f.Qb(),f.Rb(16,"eg-grid-toolbar-action",2),f.Xb(17,ne),f.fc("onClick",(function(e){return t.viewItemStatus(e)})),f.Qb(),f.Rb(18,"eg-grid-toolbar-action",2),f.Xb(19,se),f.fc("onClick",(function(e){return t.viewByResource(e)})),f.Qb(),f.Kc(20,De,2,0,"eg-grid-toolbar-button",3),f.Kc(21,Pe,2,1,"eg-grid-toolbar-button",4),f.Kc(22,Ae,2,1,"eg-grid-toolbar-button",4),f.Rb(23,"eg-grid-column",5),f.Xb(24,be),f.Qb(),f.Rb(25,"eg-grid-column",6),f.Xb(26,le),f.Qb(),f.Rb(27,"eg-grid-column",7),f.Xb(28,de),f.Qb(),f.Rb(29,"eg-grid-column",8),f.Xb(30,ue),f.Qb(),f.Rb(31,"eg-grid-column",9),f.Xb(32,fe),f.Qb(),f.Rb(33,"eg-grid-column",10),f.Xb(34,pe),f.Qb(),f.Rb(35,"eg-grid-column",11),f.Xb(36,he),f.Qb(),f.Rb(37,"eg-grid-column",12),f.Xb(38,ge),f.Qb(),f.Rb(39,"eg-grid-column",13),f.Xb(40,me),f.Qb(),f.Rb(41,"eg-grid-column",14),f.Xb(42,ve),f.Qb(),f.Rb(43,"eg-grid-column",15),f.Xb(44,ye),f.Qb(),f.Rb(45,"eg-grid-column",16),f.Xb(46,Re),f.Qb(),f.Mb(47,"eg-grid-column",17),f.Rb(48,"eg-grid-column",18),f.Xb(49,_e),f.Qb(),f.Rb(50,"eg-grid-column",19),f.Xb(51,Oe),f.Qb(),f.Rb(52,"eg-grid-column",20),f.Xb(53,Qe),f.Qb(),f.Rb(54,"eg-grid-column",21),f.Xb(55,Se),f.Qb(),f.Rb(56,"eg-grid-column",22),f.Xb(57,Ie),f.Qb(),f.Rb(58,"eg-grid-column",23),f.Xb(59,xe),f.Qb(),f.Rb(60,"eg-grid-column",24),f.Xb(61,we),f.Qb(),f.Rb(62,"eg-grid-column",25),f.Xb(63,ke),f.Qb(),f.Rb(64,"eg-grid-column",26),f.Xb(65,Te),f.Qb(),f.Rb(66,"eg-grid-column",27),f.Xb(67,ze),f.Qb(),f.Rb(68,"eg-grid-column",28),f.Xb(69,Ce),f.Qb(),f.Rb(70,"eg-grid-column",29),f.Xb(71,$e),f.Qb(),f.Rb(72,"eg-grid-column",30),f.Xb(73,Le),f.Qb(),f.Qb(),f.Mb(74,"eg-fm-record-editor",31,32),f.Rb(76,"eg-cancel-reservation-dialog",33,34),f.fc("onSuccessfulCancel",(function(){return f.Bc(e),f.zc(1).reload()})),f.Qb(),f.Mb(78,"eg-no-timezone-set-dialog",null,35),f.Kc(80,Ne,1,5,"ng-template",null,36,f.Lc)}if(2&e){const e=f.zc(81);f.qc("persistKey","booking.",t.persistSuffix,""),f.oc("dataSource",t.gridSource)("sortable",!0)("useLocalSort",!0),f.xb(2),f.oc("disableOnRows",t.editNotAppropriate),f.xb(2),f.oc("disableOnRows",t.cancelNotAppropriate),f.xb(2),f.oc("disableOnRows",t.reprintNotAppropriate),f.xb(2),f.oc("disableOnRows",t.pickupNotAppropriate),f.xb(2),f.oc("disableOnRows",t.returnNotAppropriate),f.xb(2),f.oc("disableOnRows",t.notOnePatronSelected),f.xb(2),f.oc("disableOnRows",t.notOnePatronSelected),f.xb(2),f.oc("disableOnRows",t.notOneCatalogedItemSelected),f.xb(2),f.oc("disableOnRows",t.notOneResourceSelected),f.xb(2),f.oc("ngIf",!t.status),f.xb(1),f.oc("ngIf","pickupReady"===t.status),f.xb(1),f.oc("ngIf","returnReady"===t.status),f.xb(1),f.oc("hidden",!0)("index",!0),f.xb(2),f.oc("hidden",!0),f.xb(6),f.oc("hidden",!0),f.xb(4),f.oc("datePlusTime",!0),f.xb(2),f.oc("datePlusTime",!0),f.xb(2),f.oc("datePlusTime",!0),f.xb(2),f.oc("datePlusTime",!0),f.xb(2),f.oc("datePlusTime",!0),f.xb(2),f.oc("hidden",!0),f.xb(2),f.oc("hidden",!0),f.xb(5),f.oc("hidden",!0)("hidden",!0),f.xb(2),f.oc("hidden",!0)("hidden",!0),f.xb(2),f.oc("hidden",!0),f.xb(2),f.oc("hidden",!0),f.xb(16),f.oc("fieldOptions",f.uc(39,Me,f.uc(37,Ge,f.uc(35,Xe,e))))("readonlyFields",t.listReadOnlyFields())}},directives:[I.a,F.a,E.v,K.a,Q.a,G,B,q.a,U.a,H.a],encapsulation:2}),e})();var Ee=r("ufrD"),Ke=r("ayJW");const qe=["capturedTodayGrid"],Ue=["noResourceString"],He=["captureSuccessString"],Je=["captureFailureString"],We=["text",$localize`:␟66dc3383fdccb87b77709c0ad1207d9dd0202b4b␟4058411149562054111:No resource found with this barcode`],Ze=["text",$localize`:␟f8fde56142e7edf5a9d0b4d7447fb8e274f42910␟7604538383371427619:Resource successfully captured`],Ye=["text",$localize`:␟7505dfcf9fcea380d45de68326de3a7952b3abba␟34432187865030535:Could not capture this resource`],et=["bannerText",$localize`:␟422b58d49daa2f43f61b7f063817db372fd32d67␟2742699697094849589:Booking Capture`],tt=["prefix",$localize`:␟6c088e91256dd14ed45f9b23c7f33bf6987c9694␟847964475497879979:Booking`,"suffix",$localize`:␟d3a31da907b361ca8363a03642a652e52284b8f5␟7869356423919656180:Capture`];var rt,at;rt=$localize`:␟f0850ec47a55edd1fdc712a23379cfba7be4a231␟3830558080255006527:Resource barcode`,at=$localize`:␟4bca5d618a744c9e5c845c7f1e00b705a17c61b0␟4263927292656527289:Captured today`;let it=(()=>{class e{constructor(e,t,r,a,i){this.auth=e,this.net=t,this.resourceValidator=r,this.toast=a,this.actions=i,this.subscriptions=[]}ngOnInit(){this.findResource=new a.j({resourceBarcode:new a.g(null,[],this.resourceValidator.validate)}),this.subscriptions.push(this.resourceBarcode.valueChanges.pipe(Object(n.a)(1500),Object(s.a)(e=>"INVALID"===this.resourceBarcode.status?(this.noResourceString.current().then(e=>this.toast.danger(e)),Object(c.a)()):this.net.request("open-ils.booking","open-ils.booking.resources.capture_for_reservation",this.auth.token(),this.resourceBarcode.value).pipe(Object(s.a)(e=>(e&&void 0!==e.ilsevent&&e.payload&&e.payload.captured>0?(this.captureSuccessString.current().then(e=>this.toast.success(e)),this.actions.printCaptureSlip(e.payload),this.capturedTodayGrid.reloadGrid()):this.captureFailureString.current().then(e=>this.toast.danger(e)),Object(c.a)()))))).subscribe())}get resourceBarcode(){return this.findResource.get("resourceBarcode")}ngOnDestroy(){this.subscriptions.forEach(e=>{e.unsubscribe()})}}return e.\u0275fac=function(t){return new(t||e)(f.Lb(b.a),f.Lb(l.b),f.Lb(g),f.Lb(u.a),f.Lb(R))},e.\u0275cmp=f.Fb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var r;1&e&&(f.Sc(qe,!0),f.Ic(Ue,!0),f.Ic(He,!0),f.Ic(Je,!0)),2&e&&(f.yc(r=f.gc())&&(t.capturedTodayGrid=r.first),f.yc(r=f.gc())&&(t.noResourceString=r.first),f.yc(r=f.gc())&&(t.captureSuccessString=r.first),f.yc(r=f.gc())&&(t.captureFailureString=r.first))},decls:24,vars:1,consts:[[6,"text"],["noResourceString",""],["captureSuccessString",""],["captureFailureString",""],[6,"bannerText"],[6,"prefix","suffix"],[1,"row",3,"formGroup"],[1,"col-md-4"],[1,"input-group","flex-nowrap"],[1,"input-group-prepend"],["for","resource-barcode",1,"input-group-text"],["type","text","id","resource-barcode","formControlName","resourceBarcode",1,"form-control"],[1,"text-center","mt-2"],["status","capturedToday","persistSuffix","captured"],["capturedTodayGrid",""]],template:function(e,t){1&e&&(f.Rb(0,"eg-string",0,1),f.Xb(2,We),f.Qb(),f.Rb(3,"eg-string",0,2),f.Xb(5,Ze),f.Qb(),f.Rb(6,"eg-string",0,3),f.Xb(8,Ye),f.Qb(),f.Rb(9,"eg-staff-banner",4),f.Xb(10,et),f.Qb(),f.Rb(11,"eg-title",5),f.Xb(12,tt),f.Qb(),f.Rb(13,"form",6),f.Rb(14,"div",7),f.Rb(15,"div",8),f.Rb(16,"div",9),f.Rb(17,"label",10),f.Vb(18,rt),f.Qb(),f.Mb(19,"input",11),f.Qb(),f.Qb(),f.Qb(),f.Qb(),f.Rb(20,"h2",12),f.Vb(21,at),f.Qb(),f.Mb(22,"eg-reservations-grid",13,14)),2&e&&(f.xb(13),f.oc("formGroup",t.findResource))},directives:[d.a,Ee.a,Ke.a,a.J,a.u,a.k,a.c,a.t,a.i,Fe],encapsulation:2}),e})();var ot=r("NXyV"),ct=r("EY2u"),nt=r("PqYM"),st=r("z6cu"),bt=r("BFxc"),lt=r("cx9U"),dt=r("CqXF"),ut=r("JX91"),ft=r("Pf76"),pt=r("/xpB"),ht=r("1kSV"),gt=r("wVJ/"),mt=r("9emE"),vt=r("9rfo"),yt=r("ib0n");const Rt=["fail"],_t=["dialogBody",$localize`:␟8eeab6cd2738ade8d80ea82f6a19a65075020593␟5540793927294137302:Could not create this reservation`];var Ot;Ot=$localize`:␟e810d77f15ae96c25f0ea325001b8a987a808619␟3031149684398930958:Confirm Reservation Details`;const Qt=["aria-label",$localize`:␟f4e529ae5ffd73001d1ff4bbdeeb0a72e342e5c8␟7819314041543176992:Close`];var St,It,xt,wt,kt;St=$localize`:␟a5af88d641d9f4f325017b9951c6afed7477566d␟4713151336247961822:Patron barcode`,It=$localize`:␟78d6b1f6d1b2616a5102eab851f6863d5867b39a␟7732774133897019679: ${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd1\ufffd"}:INTERPOLATION_1: ${"\ufffd2\ufffd"}:INTERPOLATION_2: `,xt=$localize`:␟4c11aad490b2d53fdae30b3807beabf79306752c␟3770761673682962465:Start time`,wt=$localize`:␟2f4e35e36f4d3c62e2c17df41730b6dee4afc4b9␟3029887440722063094:End time`,kt=$localize`:␟0af1c463769865497f9776f1207fe37e242a0e73␟4981002288470877556:Reservation location`;const Tt=["helpText",$localize`:␟499a71de56dcd0735684da3cf580c8e663bbb78c␟1248707501774452115:The library where the resource is picked up or used`];var zt,Ct,$t,Lt,Bt,Dt,jt,Pt;function Vt(e,t){1&e&&(f.Rb(0,"div",30),f.Rb(1,"span",31),f.Mc(2,"error"),f.Qb(),f.Rb(3,"span"),f.Vb(4,jt),f.Qb(),f.Qb())}function At(e,t){if(1&e&&(f.Rb(0,"div",32),f.Rb(1,"span",31),f.Mc(2,"access_time"),f.Qb(),f.Rb(3,"span"),f.Vb(4,Pt),f.Qb(),f.Qb()),2&e){const e=f.hc(2);f.xb(4),f.Zb(e.timezone),f.Wb(4)}}function Nt(e,t){if(1&e&&f.Mb(0,"input",33),2&e){const e=f.hc(2);f.pc("value",e.targetResourceBarcode)}}zt=$localize`:␟ffde342dc48f0b074d3dbcbb2f665216a2dd3deb␟1664620352147673062:Resource`,Ct=$localize`:␟bf6cf522c399bc811b31b293a415ab893b8fca4f␟6155532629582446437:Notify by email?`,$t=$localize`:␟5c54befce78d70e20c215f10a00e617245f53bc9␟4388879716045736175:Note`,Lt=$localize`:␟2e67a3e8f4a01f594882d52ba48e6139f074aef0␟3211588401417695137:Confirm reservation`,Bt=$localize`:␟c6d0e9bb231aa0a4321d754c85169184b9db119b␟8769902851392509715: Confirm and show patron reservations `,Dt=$localize`:␟d7b35c384aecd25a516200d6921836374613dfe7␟2159130950882492111:Cancel`,jt=$localize`:␟f8efb205efdee2790929b233e094429c70b65c75␟653649827000852183:Start time must be before end time`,Pt=$localize`:␟6695919c66eb7ba2a94fc143bde17207e80d2823␟424870090577028136:Reservation location is in the ${"\ufffd0\ufffd"}:INTERPOLATION: timezone`;const Xt=["entryLabel",$localize`:␟23324344c1f867ac71b99496cf4d76f6d7649fc4␟6638736673517346270:Any resource`];function Gt(e,t){if(1&e&&f.Mb(0,"eg-combobox-entry",37),2&e){const e=t.$implicit;f.pc("entryId",e.id()),f.pc("entryLabel",e.barcode())}}function Mt(e,t){if(1&e&&(f.Rb(0,"eg-combobox",34),f.Rb(1,"eg-combobox-entry",35),f.Xb(2,Xt),f.Qb(),f.Kc(3,Gt,1,2,"eg-combobox-entry",36),f.Qb()),2&e){const e=f.hc(2);f.xb(3),f.oc("ngForOf",e.resources)}}function Ft(e,t){if(1&e){const e=f.Sb();f.Rb(0,"div",3),f.Rb(1,"h3",4),f.Vb(2,Ot),f.Qb(),f.Rb(3,"button",5),f.Xb(4,Qt),f.fc("click",(function(){return f.Bc(e),f.hc().dismiss("cross_click")})),f.Rb(5,"span",6),f.Mc(6,"\xd7"),f.Qb(),f.Qb(),f.Qb(),f.Rb(7,"form",7),f.Rb(8,"div",8),f.Rb(9,"label",9),f.Vb(10,St),f.Qb(),f.Mb(11,"input",10),f.Rb(12,"span",11),f.Vb(13,It),f.ic(14,"async"),f.ic(15,"async"),f.ic(16,"async"),f.Qb(),f.Qb(),f.Rb(17,"div",8),f.Rb(18,"label",12),f.Vb(19,xt),f.Qb(),f.Mb(20,"eg-datetime-select",13),f.Qb(),f.Rb(21,"div",8),f.Rb(22,"label",12),f.Vb(23,wt),f.Qb(),f.Mb(24,"eg-datetime-select",14),f.Kc(25,Vt,5,0,"div",15),f.Qb(),f.Rb(26,"div",8),f.Rb(27,"label",16),f.Vb(28,kt),f.Qb(),f.Rb(29,"eg-org-select",17),f.fc("onChange",(function(t){return f.Bc(e),f.hc().handlePickupLibChange(t)})),f.Qb(),f.Rb(30,"eg-help-popover",18),f.Xb(31,Tt),f.Qb(),f.Qb(),f.Kc(32,At,5,1,"div",19),f.Rb(33,"div",8),f.Rb(34,"label",20),f.Vb(35,zt),f.Qb(),f.Kc(36,Nt,1,1,"input",21),f.Kc(37,Mt,4,1,"eg-combobox",22),f.Qb(),f.Rb(38,"div",8),f.Rb(39,"label",23),f.Vb(40,Ct),f.Qb(),f.Mb(41,"input",24),f.Qb(),f.Rb(42,"div",8),f.Rb(43,"label",25),f.Vb(44,$t),f.Qb(),f.Mb(45,"input",26),f.Qb(),f.Qb(),f.Rb(46,"div",27),f.Rb(47,"button",28),f.fc("click",(function(){return f.Bc(e),f.hc().addBresv$().subscribe()})),f.Vb(48,Lt),f.Qb(),f.Rb(49,"button",28),f.fc("click",(function(){return f.Bc(e),f.hc().addBresvAndOpenPatronReservations()})),f.Vb(50,Bt),f.Qb(),f.Rb(51,"button",29),f.fc("click",(function(){return f.Bc(e),f.hc().close()})),f.Vb(52,Dt),f.Qb(),f.Qb()}if(2&e){const e=f.hc();var r;const t=null==(r=f.jc(14,16,e.patron$))?null:r.first_given_name;var a;const o=null==(a=f.jc(15,18,e.patron$))?null:a.second_given_name;var i;const c=null==(i=f.jc(16,20,e.patron$))?null:i.family_name;f.xb(7),f.oc("formGroup",e.create),f.xb(4),f.oc("disabled",e.patronId),f.xb(5),f.Zb(t)(o)(c),f.Wb(13),f.xb(4),f.oc("timezone",e.timezone),f.xb(4),f.oc("timezone",e.timezone),f.xb(1),f.oc("ngIf",e.create.errors&&e.create.errors.startTimeNotBeforeEndTime),f.xb(4),f.oc("applyDefault",!0)("disableOrgs",e.disableOrgs())("hideOrgs",e.disableOrgs()),f.xb(3),f.oc("ngIf",e.pickupLibraryUsesDifferentTz),f.xb(4),f.oc("ngIf",e.targetResource&&e.targetResourceBarcode),f.xb(1),f.oc("ngIf",!(e.targetResource&&e.targetResourceBarcode)),f.xb(10),f.oc("disabled",!e.create.valid),f.xb(2),f.oc("disabled",!e.create.valid)}}const Et=e=>{const t=e.get("startTime").value,r=e.get("endTime").value;return null!==t&&null!==r&&t.isBefore(r)?null:{startTimeNotBeforeEndTime:!0}};let Kt=(()=>{class e extends k.a{constructor(e,t,r,a,i,o,c,n,s){super(c),this.auth=e,this.format=t,this.net=r,this.org=a,this.pcrud=i,this.router=o,this.modal=c,this.pbv=n,this.toast=s,this.attributes=[],this.resources=[],this.timezone=this.format.wsOrgTimezone,this.openPatronReservations=()=>{this.net.request("open-ils.actor","open-ils.actor.get_barcodes",this.auth.token(),this.auth.user().ws_ou(),"actor",this.patronBarcode.value).subscribe(e=>this.router.navigate(["/staff","booking","manage_reservations","by_patron",e[0].id]))},this.addBresvAndOpenPatronReservations=()=>{this.addBresv$().subscribe(()=>this.openPatronReservations())},this.onComplete=new f.n}ngOnInit(){this.create=new a.j({patronBarcode:new a.g("",[a.H.required],[this.pbv.validate]),emailNotify:new a.g(!0),startTime:new a.g(null,Object(H.b)(M().add("15","minutes"))),endTime:new a.g,resourceList:new a.g,note:new a.g},[Et]),this.patronId&&this.pcrud.search("au",{id:this.patronId},{flesh:1,flesh_fields:{au:["card"]}}).subscribe(e=>this.create.patchValue({patronBarcode:e.card().barcode()})),this.addBresv$=()=>{let e=this.targetResource?[this.targetResource]:null;return e||null===this.resourceListSelection||"any"===this.resourceListSelection.id||(e=[this.resourceListSelection.id]),this.net.request("open-ils.booking","open-ils.booking.reservations.create",this.auth.token(),this.patronBarcode.value.trim(),this.selectedTimes,this.pickupLibId,this.targetResourceType.id,e,this.attributes.filter(Boolean),this.emailNotify,this.bresvNote).pipe(Object(m.a)(e=>{e.ilsevent?(console.warn(e),this.fail.open()):(this.toast.success("Reservation successfully created"),console.debug(e),this.close())},e=>{console.warn(e),this.fail.open()},()=>this.onComplete.emit(!0)))},this.handlePickupLibChange=e=>{this.pickupLibId=e.id(),this.org.settings("lib.timezone",this.pickupLibId).then(e=>{this.timezone=e["lib.timezone"]||this.format.wsOrgTimezone,this.pickupLibraryUsesDifferentTz=e["lib.timezone"]&&this.format.wsOrgTimezone!==e["lib.timezone"]})},this.disableOrgs=()=>this.org.filterList({canHaveVolumes:!1},!0),this.patron$=this.patronBarcode.statusChanges.pipe(Object(ut.a)({first_given_name:"",second_given_name:"",family_name:""}),Object(s.a)(()=>"VALID"===this.patronBarcode.status?this.net.request("open-ils.actor","open-ils.actor.get_barcodes",this.auth.token(),this.auth.user().ws_ou(),"actor",this.patronBarcode.value.trim()).pipe(Object(lt.a)(),Object(s.a)(e=>this.pcrud.retrieve("au",e[0].id).pipe(Object(s.a)(e=>Object(c.a)({first_given_name:e.first_given_name(),second_given_name:e.second_given_name(),family_name:e.family_name()}))))):Object(c.a)({first_given_name:"",second_given_name:"",family_name:""})))}setDefaultTimes(e,t){this.create.patchValue({startTime:M.min(e),endTime:M.max(e).clone().add(t,"minutes")})}get emailNotify(){return this.create.get("emailNotify").value}get bresvNote(){return this.create.get("note").value}get patronBarcode(){return this.create.get("patronBarcode")}get resourceListSelection(){return this.create.get("resourceList").value}get selectedTimes(){return[this.create.get("startTime").value.toISOString(),this.create.get("endTime").value.toISOString()]}}return e.\u0275fac=function(t){return new(t||e)(f.Lb(b.a),f.Lb(S.a),f.Lb(l.b),f.Lb(w.a),f.Lb(h.a),f.Lb(o.c),f.Lb(ht.s),f.Lb(ft.a),f.Lb(u.a))},e.\u0275cmp=f.Fb({type:e,selectors:[["eg-create-reservation-dialog"]],viewQuery:function(e,t){var r;1&e&&f.Ic(Rt,!0),2&e&&f.yc(r=f.gc())&&(t.fail=r.first)},inputs:{targetResource:"targetResource",targetResourceBarcode:"targetResourceBarcode",targetResourceType:"targetResourceType",patronId:"patronId",attributes:"attributes",resources:"resources"},outputs:{onComplete:"onComplete"},features:[f.ub],decls:5,vars:0,consts:[["dialogContent",""],[6,"dialogBody"],["fail",""],[1,"modal-header","bg-info"],[1,"modal-title"],["type","button",1,"close",3,"click",6,"aria-label"],["aria-hidden","true"],[1,"modal-body","form-common",3,"formGroup"],[1,"form-group","row"],["for","create-patron-barcode",1,"col-lg-4","text-right","font-weight-bold"],["type","text","id","create-patron-barcode","formControlName","patronBarcode",1,"form-control","col-lg-7",3,"disabled"],[1,"col-lg-7","offset-lg-4"],["for","create-end-time",1,"col-lg-4","text-right","font-weight-bold"],["formControlName","startTime",3,"timezone"],["formControlName","endTime",3,"timezone"],["role","alert","class","alert alert-danger offset-lg-4",4,"ngIf"],["for","create-pickup-library",1,"col-lg-4","text-right","font-weight-bold"],["domId","create-pickup-library",3,"applyDefault","disableOrgs","hideOrgs","onChange"],[6,"helpText"],["role","alert","class","alert alert-info",4,"ngIf"],["for","create-resource",1,"col-lg-4","text-right","font-weight-bold"],["id","create-resource","disabled","",3,"value",4,"ngIf"],["formControlName","resourceList","startId","any",4,"ngIf"],["for","create-email-notify",1,"col-lg-4","text-right","font-weight-bold"],["type","checkbox","formControlName","emailNotify"],["for","create-note",1,"col-lg-4","text-right","font-weight-bold"],["type","text","id","create-note","formControlName","note",1,"form-control","col-lg-7"],[1,"modal-footer"],[1,"btn","btn-info",3,"disabled","click"],[1,"btn","btn-warning","ml-2",3,"click"],["role","alert",1,"alert","alert-danger","offset-lg-4"],["aria-hidden","true",1,"material-icons"],["role","alert",1,"alert","alert-info"],["id","create-resource","disabled","",3,"value"],["formControlName","resourceList","startId","any"],["entryId","any",6,"entryLabel"],[3,"entryId","entryLabel",4,"ngFor","ngForOf"],[3,"entryId","entryLabel"]],template:function(e,t){1&e&&(f.Kc(0,Ft,53,22,"ng-template",null,0,f.Lc),f.Rb(2,"eg-alert-dialog",1,2),f.Xb(4,_t),f.Qb())},directives:[pt.a,a.J,a.u,a.k,a.c,a.t,a.i,U.a,E.v,gt.a,mt.a,a.a,vt.a,yt.a,E.u],pipes:[E.b],encapsulation:2}),e})();var qt=r("OsfI");let Ut=(()=>{class e{constructor(e,t){this.auth=e,this.pcrud=t,this.hoursOfOperation=e=>this.pcrud.retrieve("aouhoo",this.auth.user().ws_ou()).pipe(Object(s.a)(t=>{const r=t[this.evergreenStyleDow(e)+"_open"]().split(":"),a=t[this.evergreenStyleDow(e)+"_close"]().split(":");return Object(c.a)({startOfDay:{hour:"00"===r[0]?9:+r[0],minute:+r[1],second:0},endOfDay:{hour:"00"===a[0]?17:+a[0],minute:+a[1],second:0}})})),this.resourceAvailabilityIcon=(e,t)=>{let r={icon:"event_busy",title:"All resources are reserved at this time"},a=0;for(const i in e.patrons)e.patrons[i]instanceof Array&&e.patrons[i].length&&(a+=1);return a<t&&(r={icon:"event_available",title:"Resources are available at this time"}),r},this.fetchRelevantResources=(e,t,r)=>{const a={type:e,owner:t};return r.length&&(a.id={in:{from:"bram",select:{bram:["resource"]},where:{value:r}}}),this.pcrud.search("brsrc",a,{order_by:"barcode ASC",flesh:1,flesh_fields:{brsrc:["attr_maps"]}})},this.momentizeDateRange=(e,t)=>({startTime:M.tz([e.fromDate.year,e.fromDate.month-1,e.fromDate.day],t),endTime:M.tz([e.toDate.year,e.toDate.month-1,e.toDate.day+1],t)}),this.momentizeDay=(e,t,r,a)=>({startTime:M.tz([e.getFullYear(),e.getMonth(),e.getDate(),t.hour,t.minute],a),endTime:M.tz([e.getFullYear(),e.getMonth(),e.getDate(),r.hour,r.minute],a)}),this.createBasicSchedule=(e,t)=>{const r=e.startTime.clone(),a=[];for(;r<e.endTime;)a.push({time:r.clone()}),r.add(t,"minutes");return a},this.fetchReservations=(e,t)=>this.pcrud.search("bresv",{"-or":{target_resource:t,current_resource:t},end_time:{">":e.startTime.toISOString()},start_time:{"<":e.endTime.toISOString()},return_time:null,cancel_time:null},{flesh:1,flesh_fields:{bresv:["current_resource","usr"]}}),this.addReservationToSchedule=(e,t,r,a)=>{for(let i=0;i<t.length;i++){const o=t[i].time,c=i+1<t.length?t[i+1].time:t[i].time.clone().add(r,"minutes");M.tz(e.start_time(),a).isBefore(c)&&M.tz(e.end_time(),a).isAfter(o)&&(t[i].patrons||(t[i].patrons={}),t[i].patrons[e.current_resource().barcode()]||(t[i].patrons[e.current_resource().barcode()]=[]),-1===t[i].patrons[e.current_resource().barcode()].findIndex(t=>t.patronId===e.usr().id())&&t[i].patrons[e.current_resource().barcode()].push({patronLabel:e.usr().usrname(),patronId:e.usr().id(),reservationId:e.id()}))}return t},this.evergreenStyleDow=e=>"dow_"+(e.getDay()+6)%7}}return e.\u0275fac=function(t){return new(t||e)(f.cc(b.a),f.cc(h.a))},e.\u0275prov=f.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Ht=r("LTyc"),Jt=r("dpqa"),Wt=r("UjDu");const Zt=["createDialog"],Yt=["details"],er=["noTimezoneSetDialog"],tr=["viewReservation"],rr=["scheduleGrid"],ar=["bannerText",$localize`:␟b873b6951738d7d36fae7e60d937c68a16294644␟497728370667410908:Create Reservation`],ir=["prefix",$localize`:␟6c088e91256dd14ed45f9b23c7f33bf6987c9694␟847964475497879979:Booking`,"suffix",$localize`:␟b873b6951738d7d36fae7e60d937c68a16294644␟497728370667410908:Create Reservation`];var or,cr,nr,sr,br,lr;function dr(e,t){if(1&e&&(f.Rb(0,"option",32),f.Vb(1,sr),f.Qb()),2&e){const e=t.$implicit;f.oc("ngValue",e),f.xb(1),f.Zb(e.name),f.Wb(1)}}function ur(e,t){1&e&&f.Mb(0,"eg-date-select",33,34)}function fr(e,t){1&e&&f.Mb(0,"eg-daterange-select",35)}function pr(e,t){1&e&&(f.Rb(0,"span",36),f.Mc(1,"dns"),f.Qb(),f.Pb(2),f.Vb(3,br),f.Ob())}or=$localize`:␟9563c19b839d86cf74353d0db893070628ba91c0␟5360100160458018907:Reservation type`,cr=$localize`:␟7f239ddbe574fdc49ba545afcfb43dde37649242␟3132339113110882197:Reservation date`,nr=$localize`:␟3b12681ee32d316b1e9d6315b3ac15af2b46ed89␟5239779940045550692:Reservation details`,sr=$localize`:␟d6b57d40a922d358dd4742d942cb2f3475b5fb78␟8654677463254099684:${"\ufffd0\ufffd"}:INTERPOLATION:`,br=$localize`:␟50740338ae1150539461459b4c2824beda4d2a7e␟711173173943179604:Choose resource by type`,lr=$localize`:␟af875e23fcd65bfa8e024ae3aefd080b01d3c973␟1607585788222737264:Search by resource type`;const hr=["labelText",$localize`:␟91083dc31e79f6809fa4760da86474e882c9c637␟4479146797004254107:Owning library`];function gr(e,t){1&e&&(f.Rb(0,"div",37),f.Rb(1,"div",5),f.Rb(2,"div",6),f.Rb(3,"div",7),f.Rb(4,"label",38),f.Vb(5,lr),f.Qb(),f.Qb(),f.Mb(6,"eg-combobox",39),f.Qb(),f.Rb(7,"div",5),f.Rb(8,"eg-org-family-select",40),f.Xb(9,hr),f.Qb(),f.Qb(),f.Qb(),f.Qb()),2&e&&(f.xb(6),f.oc("asyncSupportsEmptyTermClick",!0),f.xb(2),f.oc("hideAncestorSelector",!0))}var mr,vr,yr,Rr,_r,Or,Qr,Sr;function Ir(e,t){1&e&&(f.Rb(0,"span",36),f.Mc(1,"assignment"),f.Qb(),f.Pb(2),f.Vb(3,mr),f.Ob())}function xr(e,t){1&e&&(f.Rb(0,"div",37),f.Rb(1,"div",5),f.Rb(2,"div",6),f.Rb(3,"div",7),f.Rb(4,"label",41),f.Vb(5,vr),f.Qb(),f.Qb(),f.Mb(6,"input",42),f.Qb(),f.Qb(),f.Qb())}function wr(e,t){1&e&&(f.Rb(0,"span",36),f.Mc(1,"filter_list"),f.Qb(),f.Pb(2),f.Vb(3,yr),f.Ob())}function kr(e,t){if(1&e&&f.Mb(0,"eg-combobox-entry",49),2&e){const e=t.$implicit;f.oc("entryId",e.id())("entryLabel",e.valid_value())}}function Tr(e,t){if(1&e&&(f.Rb(0,"li",45),f.Rb(1,"span",6),f.Rb(2,"span",7),f.Rb(3,"label",46),f.Vb(4,Rr),f.Qb(),f.Qb(),f.Rb(5,"eg-combobox",47),f.Kc(6,kr,1,2,"eg-combobox-entry",48),f.Qb(),f.Qb(),f.Qb()),2&e){const e=t.$implicit,r=t.index;f.xb(3),f.qc("for","attribute-",e.id(),""),f.xb(1),f.Zb(e.name()),f.Wb(4),f.xb(1),f.oc("formControlName",r),f.xb(1),f.oc("ngForOf",e.valid_values())}}function zr(e,t){if(1&e&&(f.Rb(0,"ul",43),f.Kc(1,Tr,7,4,"li",44),f.Qb()),2&e){const e=f.hc();f.xb(1),f.oc("ngForOf",e.attributes)}}function Cr(e,t){1&e&&(f.Rb(0,"span",36),f.Mc(1,"settings"),f.Qb(),f.Pb(2),f.Vb(3,_r),f.Ob())}mr=$localize`:␟55e5ed9a2717d2451c7cfb3bc56811d87633af35␟4214948655632780796:Choose resource by barcode`,vr=$localize`:␟4bfef9766a2fd88d3d5cb19bac1e2cbf6547658a␟5365909521761730842:Search by resource barcode`,yr=$localize`:␟179470ef9029a54cc8c27d1148bfe9f8f0df1fea␟3355226944889845141:Limit by attributes`,Rr=$localize`:␟8d993a483620e3722ef67d07f8f5290e43c10561␟1226557749153390518:${"\ufffd0\ufffd"}:INTERPOLATION:`,_r=$localize`:␟28efc5840cc631aa2180332f29d4f3e5c9b128a6␟5145403754551415773:Schedule settings`,Or=$localize`:␟4c11aad490b2d53fdae30b3807beabf79306752c␟3770761673682962465:Start time`,Qr=$localize`:␟2f4e35e36f4d3c62e2c17df41730b6dee4afc4b9␟3029887440722063094:End time`,Sr=$localize`:␟2219a2ca733f12976f7de7247ff0d6f79c4d260a␟207515246239441863:Granularity`;const $r=["entryLabel",$localize`:␟0a7f83a1f27750ef634a1f1f97263fac36113b1f␟6648333117195452824:15 minutes`],Lr=["entryLabel",$localize`:␟601eb137c2dbcfcf927ce857ebf2c2bfe1340574␟3024744231536209225:30 minutes`],Br=["entryLabel",$localize`:␟307d061c8be36868f10969012ae6ca2c4d026c3f␟8957769602890064019:60 minutes`];var Dr;function jr(e,t){1&e&&(f.Rb(0,"li",45),f.Rb(1,"div",59),f.Rb(2,"span",60),f.Mc(3,"error"),f.Qb(),f.Rb(4,"span"),f.Vb(5,Dr),f.Qb(),f.Qb(),f.Qb())}function Pr(e,t){if(1&e){const e=f.Sb();f.Rb(0,"ul",50),f.Rb(1,"li",45),f.Rb(2,"span",6),f.Rb(3,"span",7),f.Rb(4,"label",51),f.Vb(5,Or),f.Qb(),f.Qb(),f.Mb(6,"ngb-timepicker",52),f.Qb(),f.Qb(),f.Rb(7,"li",45),f.Rb(8,"span",6),f.Rb(9,"span",7),f.Rb(10,"label",53),f.Vb(11,Qr),f.Qb(),f.Qb(),f.Mb(12,"ngb-timepicker",54),f.Qb(),f.Qb(),f.Kc(13,jr,6,0,"li",55),f.Rb(14,"li",45),f.Rb(15,"span",6),f.Rb(16,"span",7),f.Rb(17,"label",56),f.Vb(18,Sr),f.Qb(),f.Qb(),f.Rb(19,"eg-combobox",57),f.fc("onChange",(function(t){return f.Bc(e),f.hc().changeGranularity(t)})),f.Rb(20,"eg-combobox-entry",58),f.Xb(21,$r),f.Qb(),f.Rb(22,"eg-combobox-entry",58),f.Xb(23,Lr),f.Qb(),f.Rb(24,"eg-combobox-entry",58),f.Xb(25,Br),f.Qb(),f.Qb(),f.Qb(),f.Qb(),f.Qb()}if(2&e){const e=f.hc();f.xb(6),f.oc("minuteStep",e.minuteStep())("meridian",!0),f.xb(6),f.oc("minuteStep",e.minuteStep())("meridian",!0),f.xb(1),f.oc("ngIf",e.criteria.errors&&e.criteria.errors.startOfDayNotBeforeEndOfDay),f.xb(6),f.oc("startId",e.granularity?e.granularity:30),f.xb(1),f.oc("entryId",15),f.xb(2),f.oc("entryId",30),f.xb(2),f.oc("entryId",60)}}Dr=$localize`:␟f8efb205efdee2790929b233e094429c70b65c75␟653649827000852183:Start time must be before end time`;const Vr=["label",$localize`:␟b873b6951738d7d36fae7e60d937c68a16294644␟497728370667410908:Create Reservation`],Ar=["label",$localize`:␟b873b6951738d7d36fae7e60d937c68a16294644␟497728370667410908:Create Reservation`],Nr=["name",$localize`:␟b24f1cd32cbc1ec9537af28c4fe1b8204097714b␟8497528947328199741:Time`];var Xr,Gr,Mr,Fr;function Er(e,t){if(1&e){const e=f.Sb();f.Rb(0,"div",4),f.Rb(1,"button",67),f.fc("click",(function(){return f.Bc(e),f.hc(2).addDays(-1)})),f.Rb(2,"span",68),f.Mc(3,"keyboard_arrow_left"),f.Qb(),f.Rb(4,"span"),f.Vb(5,Xr),f.Qb(),f.Qb(),f.Rb(6,"h2",69),f.Vb(7,Gr),f.ic(8,"formatValue"),f.Qb(),f.Rb(9,"button",70),f.fc("click",(function(){return f.Bc(e),f.hc(2).addDays(1)})),f.Rb(10,"span"),f.Vb(11,Mr),f.Qb(),f.Rb(12,"span",68),f.Mc(13,"keyboard_arrow_right"),f.Qb(),f.Qb(),f.Qb()}if(2&e){const e=f.hc(2);f.xb(8),f.Zb(f.kc(8,1,e.idealDate,"timestamp")),f.Wb(7)}}function Kr(e,t){if(1&e&&f.Mb(0,"eg-grid-column",71),2&e){const e=t.$implicit;f.hc(2);const r=f.zc(43);f.pc("path",e.barcode()),f.oc("cellTemplate",r)("name",e.barcode())("disableTooltip",!0)}}function qr(e,t){if(1&e){const e=f.Sb();f.Pb(0),f.Mb(1,"hr"),f.Kc(2,Er,14,4,"div",61),f.Rb(3,"eg-grid",62,63),f.fc("onRowActivate",(function(t){return f.Bc(e),f.hc().openTheDialog([t])})),f.Rb(5,"eg-grid-toolbar-button",64),f.Xb(6,Vr),f.fc("onClick",(function(t){return f.Bc(e),f.hc().openTheDialog(t)})),f.Qb(),f.Rb(7,"eg-grid-toolbar-action",64),f.Xb(8,Ar),f.fc("onClick",(function(t){return f.Bc(e),f.hc().openTheDialog(t)})),f.Qb(),f.Rb(9,"eg-grid-column",65),f.Xb(10,Nr),f.Qb(),f.Kc(11,Kr,1,4,"eg-grid-column",66),f.Qb(),f.Ob()}if(2&e){const e=f.hc(),t=f.zc(45);f.xb(2),f.oc("ngIf",e.idealDate&&!e.multiday),f.xb(1),f.oc("cellTextGenerator",e.cellTextGenerator)("sortable",!1)("dataSource",e.scheduleSource)("rowFlairIsEnabled",!0)("rowFlairCallback",e.resourceAvailabilityIcon)("disablePaging",!0),f.xb(6),f.oc("index",!0)("cellTemplate",t),f.xb(2),f.oc("ngForOf",e.resources)}}Xr=$localize`:␟68149b3e5c8377f1741b76e87802ed3efbe6e332␟3324233834879915508:Previous day`,Gr=$localize`:␟94fefe90ce570dee560e4ffd91687f20a5086425␟1831107535946560684:${"\ufffd0\ufffd"}:INTERPOLATION:`,Mr=$localize`:␟fd78c797e104e0add29b5df28716bde3e726f6ef␟7468598398356612819:Next day`,Fr=$localize`:␟acee1706d34368434ec603e17f9a1040abe14a89␟4374823966966289621: There are no bookable resource that match your criteria. Would you like to create ${"\ufffd#2\ufffd"}:START_LINK:some new resources${"\ufffd/#2\ufffd"}:CLOSE_LINK:?
`;const Ur=function(){return["/staff","admin","booking","splash"]};function Hr(e,t){1&e&&(f.Rb(0,"div",72),f.bc(1,Fr),f.Mb(2,"a",73),f.Yb(),f.Qb()),2&e&&(f.xb(2),f.oc("routerLink",f.tc(1,Ur)))}function Jr(e,t){if(1&e){const e=f.Sb();f.Rb(0,"li"),f.Rb(1,"button",76),f.fc("click",(function(){f.Bc(e);const r=t.$implicit;return f.hc(3).openReservationViewer(r.reservationId)})),f.Mc(2),f.Qb(),f.Qb()}if(2&e){const e=t.$implicit;f.xb(2),f.Oc(" ",e.patronLabel," ")}}function Wr(e,t){if(1&e&&(f.Pb(0),f.Rb(1,"ul",74),f.Kc(2,Jr,3,1,"li",75),f.Qb(),f.Ob()),2&e){const e=f.hc(),t=e.row,r=e.col;f.xb(2),f.oc("ngForOf",t.patrons[r.name])}}function Zr(e,t){if(1&e&&f.Kc(0,Wr,3,1,"ng-container",23),2&e){const e=t.row,r=t.col;f.oc("ngIf",e.patrons&&e.patrons[r.name])}}function Yr(e,t){if(1&e&&(f.Pb(0),f.Mc(1),f.Ob()),2&e){const e=f.hc().row;f.xb(1),f.Oc(" ",e.time.format("LT")," ")}}function ea(e,t){if(1&e&&(f.Pb(0),f.Mc(1),f.ic(2,"formatValue"),f.Ob()),2&e){const e=f.hc().row;f.xb(1),f.Oc(" ",f.kc(2,1,e.time,"timestamp")," ")}}function ta(e,t){if(1&e&&(f.Kc(0,Yr,2,1,"ng-container",23),f.Kc(1,ea,3,4,"ng-container",23)),2&e){const e=f.hc();f.oc("ngIf",!e.multiday),f.xb(1),f.oc("ngIf",e.multiday)}}const ra=e=>{const t=e.get("startOfDay").value,r=e.get("endOfDay").value;return null!==t&&null!==r&&t.hour<=r.hour&&!(t.hour===r.hour&&t.minute>=r.minute)?null:{startOfDayNotBeforeEndOfDay:!0}};let aa=(()=>{class e{constructor(e,t,r,a,i,o,c,n,b,l){this.auth=e,this.calendar=t,this.format=r,this.net=a,this.pcrud=i,this.route=o,this.router=c,this.scheduleService=n,this.store=b,this.toast=l,this.attributes=[],this.multiday=!1,this.subscriptions=[],this.defaultGranularity=30,this.granularity=this.defaultGranularity,this.scheduleSource=new x.c,this.resources=[],this.fetchData=()=>{this.setGranularity(),this.scheduleSource.data=[];let e=this.scheduleService.fetchRelevantResources(this.resourceType.value?this.resourceType.value.id:null,this.owningLibraries,this.flattenedSelectedAttributes);this.resourceId?e=Object(O.a)(this.resources):this.resources=[],e.pipe(Object(m.a)(e=>{this.resources.push(e),this.resources.sort((e,t)=>e.barcode()>t.barcode()?1:t.barcode()>e.barcode()?-1:0)}),Object(bt.a)(1),Object(s.a)(()=>{let e={startTime:M(),endTime:M()};return e=this.multiday?this.scheduleService.momentizeDateRange(this.idealDateRange,this.format.wsOrgTimezone):this.scheduleService.momentizeDay(this.idealDate,this.userStartOfDay,this.userEndOfDay,this.format.wsOrgTimezone),this.scheduleSource.data=this.scheduleService.createBasicSchedule(e,this.granularity),this.scheduleService.fetchReservations(e,this.resources.map(e=>e.id()))})).subscribe(e=>{this.scheduleSource.data=this.scheduleService.addReservationToSchedule(e,this.scheduleSource.data,this.granularity,this.format.wsOrgTimezone)},e=>{},()=>{this.cellTextGenerator={Time:e=>this.multiday?e.time.format("LT"):this.format.transform({value:e.time,datatype:"timestamp",datePlusTime:!0})},this.resources.forEach(e=>{this.cellTextGenerator[e.barcode()]=t=>t.patrons[e.barcode()]?t.patrons[e.barcode()].map(e=>e.patronLabel).join(", "):""})})},this.addDays=e=>{const t=new Date(this.idealDate);t.setDate(t.getDate()+e),this.criteria.patchValue({idealDate:t})},this.openReservationViewer=e=>{this.viewReservation.mode="view",this.viewReservation.recordId=e,this.viewReservation.open({size:"lg"})}}ngOnInit(){this.format.wsOrgTimezone||this.noTimezoneSetDialog.open();const e={fromDate:this.calendar.getToday(),toDate:this.calendar.getNext(this.calendar.getToday(),"d",10)};this.route.paramMap.pipe(Object(m.a)(e=>{this.patronId=+e.get("patron_id"),this.resourceBarcode=e.get("resource_barcode")}),Object(s.a)(e=>function(e,t=ct.a,r=ct.a){return Object(ot.a)(()=>e()?t:r)}(()=>e.has("resource_barcode"),this.handleBarcodeFromUrl$(e.get("resource_barcode")),Object(c.a)(e)))).subscribe({error(){console.warn("could not find a resource with this barcode")}}),this.reservationTypes=[{id:"single",name:"Single day reservation"},{id:"multi",name:"Multiple day reservation"}],this.criteria=new a.j({resourceBarcode:new a.g(this.resourceBarcode?this.resourceBarcode:"",[],e=>Object(nt.a)(800).pipe(Object(s.a)(()=>this.pcrud.search("brsrc",{barcode:e.value},{limit:1})),Object(lt.a)(),Object(dt.a)(null),Object(p.a)(()=>Object(c.a)({resourceBarcode:"No resource found with that barcode"})))),resourceType:new a.g,startOfDay:new a.g({hour:9,minute:0,second:0}),endOfDay:new a.g({hour:17,minute:0,second:0}),idealDate:new a.g(new Date),idealDateRange:new a.g(e),reservationType:new a.g,owningLibrary:new a.g({primaryOrgId:this.auth.user().ws_ou(),includeDescendants:!0}),selectedAttributes:new a.e([])},[ra]),this.criteria.get("resourceBarcode").valueChanges.pipe(Object(n.a)(1500)).subscribe(e=>{this.resources=[],"INVALID"===this.criteria.get("resourceBarcode").status?this.toast.danger("No resource found with this barcode"):this.router.navigate(["/staff","booking","create_reservation","for_resource",e])}),this.subscriptions.push(this.resourceType.valueChanges.pipe(Object(s.a)(e=>{for(this.resourceBarcode=null,this.resources=[],this.resourceId=null,this.attributes=[];this.selectedAttributes.length;)this.selectedAttributes.removeAt(0);return e.id?this.pcrud.search("bra",{resource_type:e.id},{order_by:"name ASC",flesh:1,flesh_fields:{bra:["valid_values"]}}).pipe(Object(m.a)(e=>{this.attributes.push(e),this.selectedAttributes.push(new a.g)})):Object(c.a)()})).subscribe(()=>this.fetchData())),this.criteria.get("reservationType").valueChanges.subscribe(e=>{this.multiday="multi"===e.id,this.store.setItem("eg.booking.create.multiday",this.multiday)}),this.subscriptions.push(this.owningLibraryFamily.valueChanges.subscribe(()=>this.resources=[])),this.subscriptions.push(this.criteria.valueChanges.subscribe(()=>this.fetchData())),this.store.getItem("eg.booking.create.multiday").then(e=>{e&&(this.multiday=e),this.criteria.patchValue({reservationType:this.multiday?this.reservationTypes[1]:this.reservationTypes[0]})}),this.setGranularity=()=>{this.multiday?this.granularity=1440:this.store.getItem("eg.booking.create.granularity").then(e=>{this.granularity=e||this.defaultGranularity})},this.criteria.get("idealDate").valueChanges.pipe(Object(s.a)(e=>this.scheduleService.hoursOfOperation(e))).subscribe(e=>this.criteria.patchValue(e,{emitEvent:!1}),()=>{},()=>this.fetchData()),this.changeGranularity=e=>{this.granularity=e.id,this.store.setItem("eg.booking.create.granularity",e.id).then(()=>this.fetchData())},this.minuteStep=()=>this.granularity<60?this.granularity:this.defaultGranularity,this.resourceAvailabilityIcon=e=>this.scheduleService.resourceAvailabilityIcon(e,this.resources.length)}ngAfterViewInit(){this.fetchData(),this.openTheDialog=e=>{e&&e.length&&this.createDialog.setDefaultTimes(e.map(e=>e.time.clone()),this.granularity),this.subscriptions.push(this.createDialog.open({size:"lg"}).subscribe(()=>this.fetchData()))}}invalidMultidaySettings(){return this.multiday&&(!this.idealDateRange||null==this.idealDateRange.fromDate||null==this.idealDateRange.toDate)}handleBarcodeFromUrl$(e){return this.findResourceByBarcode$(e).pipe(Object(p.a)(()=>this.handleBrsrcError$(e)),Object(m.a)(e=>{e&&(this.resourceId=e.id(),this.criteria.patchValue({resourceType:{id:e.type()}},{emitEvent:!1}),this.resources=[e],this.details.select("select-resource"),this.fetchData())}))}findResourceByBarcode$(e){return this.pcrud.search("brsrc",{barcode:e},{limit:1}).pipe(Object(lt.a)())}handleBrsrcError$(e){return this.tryToMakeThisBookable$(e).pipe(Object(s.a)(()=>this.findResourceByBarcode$(e)),Object(p.a)(()=>(this.toast.danger("No resource found with this barcode"),this.resourceId=-1,Object(st.a)("could not find or create a resource"))))}tryToMakeThisBookable$(e){return this.pcrud.search("acp",{barcode:e},{limit:1}).pipe(Object(lt.a)(),Object(s.a)(e=>this.net.request("open-ils.booking","open-ils.booking.resources.create_from_copies",this.auth.token(),[e.id()])),Object(p.a)(()=>(this.toast.danger("Cannot make this barcode bookable"),Object(st.a)("Tried and failed to make that barcode bookable"))),Object(m.a)(e=>{this.toast.info("Made this barcode bookable"),this.resourceId=e.brsrc[0][0]}))}get resourceType(){return this.criteria.get("resourceType")}get userStartOfDay(){return this.criteria.get("startOfDay").value}get userEndOfDay(){return this.criteria.get("endOfDay").value}get idealDate(){return this.criteria.get("idealDate").value}get idealDateRange(){return this.criteria.get("idealDateRange").value}get owningLibraryFamily(){return this.criteria.get("owningLibrary")}get owningLibraries(){return this.criteria.get("owningLibrary").value.orgIds?this.criteria.get("owningLibrary").value.orgIds:[this.criteria.get("owningLibrary").value.primaryOrgId]}get selectedAttributes(){return this.criteria.get("selectedAttributes")}get flattenedSelectedAttributes(){return this.selectedAttributes.value.filter(Boolean).map(e=>e.id)}ngOnDestroy(){this.subscriptions.forEach(e=>{e.unsubscribe()})}}return e.\u0275fac=function(t){return new(t||e)(f.Lb(b.a),f.Lb(ht.d),f.Lb(S.a),f.Lb(l.b),f.Lb(h.a),f.Lb(o.a),f.Lb(o.c),f.Lb(Ut),f.Lb(qt.a),f.Lb(u.a))},e.\u0275cmp=f.Fb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var r;1&e&&(f.Ic(Zt,!0),f.Ic(Yt,!0),f.Ic(er,!0),f.Ic(tr,!0),f.Sc(rr,!0)),2&e&&(f.yc(r=f.gc())&&(t.createDialog=r.first),f.yc(r=f.gc())&&(t.details=r.first),f.yc(r=f.gc())&&(t.noTimezoneSetDialog=r.first),f.yc(r=f.gc())&&(t.viewReservation=r.first),f.yc(r=f.gc())&&(t.scheduleGrids=r))},decls:50,vars:13,consts:[[6,"bannerText"],[6,"prefix","suffix"],[1,"row",3,"formGroup"],[1,"col-sm-6"],[1,"row"],[1,"col"],[1,"input-group"],[1,"input-group-prepend"],["for","ideal-reservation-type",1,"input-group-text"],["id","ideal-reservation-type","formControlName","reservationType",1,"form-control"],[3,"ngValue",4,"ngFor","ngForOf"],["for","ideal-reservation-date",1,"input-group-text"],["domId","ideal-reservation-date","formControlName","idealDate",4,"ngIf"],["formControlName","idealDateRange",4,"ngIf"],[1,"card","col-sm-6"],[1,"card-header"],["details","ngbTabset"],["id","select-resource-type"],["ngbTabTitle",""],["ngbTabContent",""],["id","select-resource"],["id","attributes",3,"disabled"],["id","display-settings"],[4,"ngIf"],["class","text-sm-center",4,"ngIf"],[3,"patronId","targetResourceBarcode","targetResource","targetResourceType","attributes","resources","onComplete"],["createDialog",""],["reservationsTemplate",""],["timeTemplate",""],["idlClass","bresv","datetimeFields","start_time,end_time","hiddenFields","xact_start,xact_finish,cancel_time,booking_interval"],["viewReservation",""],["noTimezoneSetDialog",""],[3,"ngValue"],["domId","ideal-reservation-date","formControlName","idealDate"],["dateLimiter",""],["formControlName","idealDateRange"],[1,"material-icons"],["ngbPanelContent","",1,"row"],["for","ideal-resource-type",1,"input-group-text"],["formControlName","resourceType","domId","ideal-resource-type","idlClass","brt",3,"asyncSupportsEmptyTermClick"],["formControlName","owningLibrary",3,"hideAncestorSelector",6,"labelText"],["for","ideal-resource-barcode",1,"input-group-text"],["type","text","id","ideal-resource-barcode","formControlName","resourceBarcode",1,"form-control"],["formArrayName","selectedAttributes",1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[1,"input-group-text",3,"for"],[3,"formControlName"],[3,"entryId","entryLabel",4,"ngFor","ngForOf"],[3,"entryId","entryLabel"],[1,"list-group","list-group-flush"],["for","start-time",1,"input-group-text"],["formControlName","startOfDay",3,"minuteStep","meridian"],["for","end-time",1,"input-group-text"],["formControlName","endOfDay",3,"minuteStep","meridian"],["class","list-group-item",4,"ngIf"],["for","granularity",1,"input-group-text"],[3,"startId","onChange"],[3,"entryId",6,"entryLabel"],["role","alert",1,"alert","alert-danger"],["aria-hidden","true",1,"material-icons"],["class","row",4,"ngIf"],["persistKey","disabled",3,"cellTextGenerator","sortable","dataSource","rowFlairIsEnabled","rowFlairCallback","disablePaging","onRowActivate"],["scheduleGrid",""],[3,"onClick",6,"label"],["path","time",3,"index","cellTemplate",6,"name"],[3,"path","cellTemplate","name","disableTooltip",4,"ngFor","ngForOf"],[1,"btn","btn-info","col-sm-2","offset-sm-3",3,"click"],[1,"material-icons","mat-icon-in-button"],[1,"col-sm-2","text-center"],[1,"btn","btn-info","col-sm-2",3,"click"],[3,"path","cellTemplate","name","disableTooltip"],[1,"text-sm-center"],[3,"routerLink"],[1,"list-unstyled"],[4,"ngFor","ngForOf"],[1,"btn","btn-info",3,"click"]],template:function(e,t){1&e&&(f.Rb(0,"eg-staff-banner",0),f.Xb(1,ar),f.Qb(),f.Rb(2,"eg-title",1),f.Xb(3,ir),f.Qb(),f.Rb(4,"form",2),f.Rb(5,"div",3),f.Rb(6,"div",4),f.Rb(7,"div",5),f.Rb(8,"div",6),f.Rb(9,"div",7),f.Rb(10,"label",8),f.Vb(11,or),f.Qb(),f.Qb(),f.Rb(12,"select",9),f.Kc(13,dr,2,2,"option",10),f.Qb(),f.Qb(),f.Qb(),f.Rb(14,"div",5),f.Rb(15,"div",6),f.Rb(16,"div",7),f.Rb(17,"label",11),f.Vb(18,cr),f.Qb(),f.Qb(),f.Kc(19,ur,2,0,"eg-date-select",12),f.Kc(20,fr,1,0,"eg-daterange-select",13),f.Qb(),f.Qb(),f.Qb(),f.Qb(),f.Rb(21,"div",14),f.Rb(22,"h2",15),f.Vb(23,nr),f.Qb(),f.Rb(24,"ngb-tabset",null,16),f.Rb(26,"ngb-tab",17),f.Kc(27,pr,4,0,"ng-template",18),f.Kc(28,gr,10,2,"ng-template",19),f.Qb(),f.Rb(29,"ngb-tab",20),f.Kc(30,Ir,4,0,"ng-template",18),f.Kc(31,xr,7,0,"ng-template",19),f.Qb(),f.Rb(32,"ngb-tab",21),f.Kc(33,wr,4,0,"ng-template",18),f.Kc(34,zr,2,1,"ng-template",19),f.Qb(),f.Rb(35,"ngb-tab",22),f.Kc(36,Cr,4,0,"ng-template",18),f.Kc(37,Pr,26,9,"ng-template",19),f.Qb(),f.Qb(),f.Qb(),f.Qb(),f.Kc(38,qr,12,10,"ng-container",23),f.Kc(39,Hr,3,2,"div",24),f.Rb(40,"eg-create-reservation-dialog",25,26),f.fc("onComplete",(function(){return t.fetchData()})),f.Qb(),f.Kc(42,Zr,1,1,"ng-template",null,27,f.Lc),f.Kc(44,ta,2,2,"ng-template",null,28,f.Lc),f.Mb(46,"eg-fm-record-editor",29,30),f.Mb(48,"eg-no-timezone-set-dialog",null,31)),2&e&&(f.xb(4),f.oc("formGroup",t.criteria),f.xb(9),f.oc("ngForOf",t.reservationTypes),f.xb(6),f.oc("ngIf",!t.multiday),f.xb(1),f.oc("ngIf",t.multiday),f.xb(12),f.oc("disabled",0===t.attributes.length),f.xb(6),f.oc("ngIf",t.resources.length),f.xb(1),f.oc("ngIf",t.resourceType.value&&!t.resources.length),f.xb(1),f.oc("patronId",t.patronId)("targetResourceBarcode",t.resourceBarcode)("targetResource",t.resourceId)("targetResourceType",t.resourceType.value)("attributes",t.flattenedSelectedAttributes)("resources",t.resources))},directives:[Ee.a,Ke.a,a.J,a.u,a.k,a.F,a.t,a.i,E.u,E.v,ht.W,ht.T,ht.V,ht.U,Kt,Q.a,B,a.y,a.I,Ht.a,Jt.a,vt.a,Wt.a,a.c,a.f,yt.a,ht.X,I.a,q.a,F.a,K.a,o.f],pipes:[S.b],styles:["#ideal-resource-barcode[_ngcontent-%COMP%] {min-width: 300px;}"]}),e})();const ia=["filterTabs"],oa=["reservationsGrid"],ca=["bannerText",$localize`:␟2f459f35dd7184d07fabce77ab9e5b430597100d␟3188500773800251137:Manage Reservations`],na=["prefix",$localize`:␟6c088e91256dd14ed45f9b23c7f33bf6987c9694␟847964475497879979:Booking`,"suffix",$localize`:␟2f459f35dd7184d07fabce77ab9e5b430597100d␟3188500773800251137:Manage Reservations`],sa=["labelText",$localize`:␟0af1c463769865497f9776f1207fe37e242a0e73␟4981002288470877556:Reservation location`];var ba,la,da,ua,fa,pa,ha,ga,ma,va;function ya(e,t){1&e&&(f.Rb(0,"span",18),f.Mc(1,"filter_list"),f.Qb())}function Ra(e,t){if(1&e&&(f.Kc(0,ya,2,0,"span",17),f.Rb(1,"span"),f.Vb(2,la),f.Qb()),2&e){const e=f.hc();f.oc("ngIf",e.patronId)}}function _a(e,t){if(1&e){const e=f.Sb();f.Rb(0,"button",26),f.fc("click",(function(){return f.Bc(e),f.hc(2).removeFilters()})),f.bc(1,ua),f.Mb(2,"span",18),f.Yb(),f.Qb()}}function Oa(e,t){if(1&e&&(f.Rb(0,"div",19),f.Rb(1,"div",20),f.Rb(2,"div",21),f.Rb(3,"label",22),f.Vb(4,da),f.Qb(),f.Qb(),f.Mb(5,"input",23),f.Rb(6,"div",24),f.Kc(7,_a,3,0,"button",25),f.Qb(),f.Qb(),f.Qb()),2&e){const e=f.hc();f.xb(7),f.oc("ngIf",e.patronBarcode.value)}}function Qa(e,t){1&e&&(f.Rb(0,"span",18),f.Mc(1,"filter_list"),f.Qb())}function Sa(e,t){if(1&e&&(f.Kc(0,Qa,2,0,"span",17),f.Rb(1,"span"),f.Vb(2,fa),f.Qb()),2&e){const e=f.hc();f.oc("ngIf",e.resourceBarcode.value)}}function Ia(e,t){if(1&e){const e=f.Sb();f.Rb(0,"button",26),f.fc("click",(function(){return f.Bc(e),f.hc(2).removeFilters()})),f.bc(1,ha),f.Mb(2,"span",18),f.Yb(),f.Qb()}}function xa(e,t){if(1&e&&(f.Rb(0,"div",19),f.Rb(1,"div",20),f.Rb(2,"div",21),f.Rb(3,"label",27),f.Vb(4,pa),f.Qb(),f.Qb(),f.Mb(5,"input",28),f.Rb(6,"div",24),f.Kc(7,Ia,3,0,"button",25),f.Qb(),f.Qb(),f.Qb()),2&e){const e=f.hc();f.xb(7),f.oc("ngIf",e.resourceBarcode.value)}}function wa(e,t){1&e&&(f.Rb(0,"span",18),f.Mc(1,"filter_list"),f.Qb())}function ka(e,t){if(1&e&&(f.Kc(0,wa,2,0,"span",17),f.Rb(1,"span"),f.Vb(2,ga),f.Qb()),2&e){const e=f.hc();f.oc("ngIf",e.resourceTypeForGrid)}}function Ta(e,t){if(1&e){const e=f.Sb();f.Rb(0,"div",19),f.Rb(1,"div",20),f.Rb(2,"div",21),f.Rb(3,"label",29),f.Vb(4,ma),f.Qb(),f.Qb(),f.Mb(5,"eg-combobox",30),f.Rb(6,"div",24),f.Rb(7,"button",26),f.fc("click",(function(){return f.Bc(e),f.hc().removeFilters()})),f.bc(8,va),f.Mb(9,"span",18),f.Yb(),f.Qb(),f.Qb(),f.Qb(),f.Qb()}2&e&&(f.xb(5),f.oc("asyncSupportsEmptyTermClick",!0))}ba=$localize`:␟e58a36bc983e3c3edc5924e222af10ee1f54d206␟6205244119512545477:Filter reservations`,la=$localize`:␟050087f61c4a61614cb3507dac3e51e97652ebce␟1495544699828328166:Filter by patron`,da=$localize`:␟a5af88d641d9f4f325017b9951c6afed7477566d␟4713151336247961822:Patron barcode`,ua=$localize`:␟dbabb7796d887e4a7d1ad0b7884045d61164b936␟6997386739786701973:${"\ufffd#2\ufffd"}:START_TAG_SPAN:delete${"\ufffd/#2\ufffd"}:CLOSE_TAG_SPAN: Remove filter`,fa=$localize`:␟303cc137b1f4dee75cbeff596f7cf1f55f71d18b␟8887207451668338252:Filter by resource`,pa=$localize`:␟f0850ec47a55edd1fdc712a23379cfba7be4a231␟3830558080255006527:Resource barcode`,ha=$localize`:␟dbabb7796d887e4a7d1ad0b7884045d61164b936␟6997386739786701973:${"\ufffd#2\ufffd"}:START_TAG_SPAN:delete${"\ufffd/#2\ufffd"}:CLOSE_TAG_SPAN: Remove filter`,ga=$localize`:␟4eddf658b618fd0379be40aff7be5889c37e0acb␟2794481383337799153:Filter by resource type`,ma=$localize`:␟e4bc0a718dd945e7242e230772c371d963128d11␟2132886845235480834:Resource type`,va=$localize`:␟dbabb7796d887e4a7d1ad0b7884045d61164b936␟6997386739786701973:${"\ufffd#9\ufffd"}:START_TAG_SPAN:delete${"\ufffd/#9\ufffd"}:CLOSE_TAG_SPAN: Remove filter`;let za=(()=>{class e{constructor(e,t,r,a,i,o,c,n,s){this.route=e,this.router=t,this.auth=r,this.net=a,this.pcrud=i,this.store=o,this.toast=c,this.patronValidator=n,this.resourceValidator=s,this.subscriptions=[],this.startingTab="patron",this.startingPickupOrgs={primaryOrgId:this.auth.user().ws_ou(),includeDescendants:!0},this.store.getItem("eg.booking.manage.selected_org_family").then(e=>{e&&(this.startingPickupOrgs=e)})}ngOnInit(){this.filters=new a.j({pickupLibraries:new a.g(this.startingPickupOrgs),patronBarcode:new a.g("",[],[this.patronValidator.validate]),resourceBarcode:new a.g("",[],[this.resourceValidator.validate]),resourceType:new a.g(null)}),this.subscriptions.push(this.pickupLibraries.valueChanges.pipe().subscribe(()=>this.reservationsGrid.reloadGrid())),this.subscriptions.push(this.patronBarcode.statusChanges.pipe(Object(n.a)(300),Object(s.a)(e=>"VALID"===e?this.net.request("open-ils.actor","open-ils.actor.get_barcodes",this.auth.token(),this.auth.user().ws_ou(),"actor",this.patronBarcode.value.trim()).pipe(Object(lt.a)(),Object(m.a)(e=>this.router.navigate(["/staff","booking","manage_reservations","by_patron",e[0].id]))):(this.toast.danger("No patron found with this barcode"),Object(c.a)()))).subscribe()),this.subscriptions.push(this.resourceBarcode.statusChanges.pipe(Object(n.a)(300),Object(m.a)(e=>{"VALID"===e&&(this.resourceBarcode.value?this.router.navigate(["/staff","booking","manage_reservations","by_resource",this.resourceBarcode.value]):this.removeFilters())})).subscribe()),this.subscriptions.push(this.resourceType.valueChanges.pipe(Object(m.a)(e=>{e?this.router.navigate(["/staff","booking","manage_reservations","by_resource_type",e.id]):this.removeFilters()})).subscribe()),this.subscriptions.push(this.pickupLibraries.valueChanges.pipe(Object(m.a)(e=>this.store.setItem("eg.booking.manage.selected_org_family",e))).subscribe()),this.removeFilters=()=>{this.router.navigate(["/staff","booking","manage_reservations"])},this.route.paramMap.pipe(Object(s.a)(e=>(this.patronId=e.has("patron_id")?+e.get("patron_id"):null,this.filters.patchValue({resourceBarcode:e.get("resource_barcode")},{emitEvent:!1}),this.filters.patchValue({resourceType:{id:+e.get("resource_type_id")}},{emitEvent:!1}),this.patronId?this.pcrud.search("au",{id:this.patronId},{limit:1,flesh:1,flesh_fields:{au:["card"]}}).pipe(Object(m.a)(e=>{this.filters.patchValue({patronBarcode:e.card().barcode()})},e=>{console.debug(e)})):this.resourceBarcode.value?(this.startingTab="resource",this.pcrud.search("brsrc",{barcode:this.resourceBarcode.value},{limit:1}).pipe(Object(m.a)(e=>{this.resourceId=e.id()},e=>{this.resourceId=-1,this.toast.danger("No resource found with this barcode")}))):this.resourceType.value?(this.startingTab="type",Object(c.a)(null)):Object(c.a)(null)))).subscribe()}get pickupLibraries(){return this.filters.get("pickupLibraries")}get patronBarcode(){return this.filters.get("patronBarcode")}get resourceBarcode(){return this.filters.get("resourceBarcode")}get resourceType(){return this.filters.get("resourceType")}get pickupLibrariesForGrid(){return this.pickupLibraries.value?this.pickupLibraries.value.orgIds:[this.auth.user().ws_ou()]}get resourceTypeForGrid(){return this.resourceType.value?this.resourceType.value.id:null}ngOnDestroy(){this.subscriptions.forEach(e=>{e.unsubscribe()})}}return e.\u0275fac=function(t){return new(t||e)(f.Lb(o.a),f.Lb(o.c),f.Lb(b.a),f.Lb(l.b),f.Lb(h.a),f.Lb(qt.a),f.Lb(u.a),f.Lb(ft.a),f.Lb(g))},e.\u0275cmp=f.Fb({type:e,selectors:[["eg-manage-reservations"]],viewQuery:function(e,t){var r;1&e&&(f.Ic(ia,!0),f.Ic(oa,!0)),2&e&&(f.yc(r=f.gc())&&(t.filterTabs=r.first),f.yc(r=f.gc())&&(t.reservationsGrid=r.first))},decls:25,vars:6,consts:[[6,"bannerText"],[6,"prefix","suffix"],[1,"row",3,"formGroup"],[1,"col-sm-3"],["formControlName","pickupLibraries",6,"labelText"],[1,"col-sm-6","offset-sm-3"],[1,"card"],[1,"card-header"],[1,"mt-1",3,"activeId"],["filterTabs",""],["id","patron"],["ngbTabTitle",""],["ngbTabContent",""],["id","resource"],["id","type"],["persistSuffix","manage",3,"patron","resourceBarcode","resourceType","pickupLibIds"],["reservationsGrid",""],["class","material-icons",4,"ngIf"],[1,"material-icons"],[1,"m-2"],[1,"input-group","m-2"],[1,"input-group-prepend"],["for","patron-barcode-value",1,"input-group-text"],["type","text","id","patron-barcode-value","formControlName","patronBarcode",1,"form-control"],[1,"input-group-button"],["class","btn btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-warning",3,"click"],["for","resource-barcode-value",1,"input-group-text"],["type","text","id","resource-barcode-value","formControlName","resourceBarcode",1,"form-control"],["for","resource-type-value",1,"input-group-text"],["domId","resource-type-value","formControlName","resourceType","idlClass","brt",3,"asyncSupportsEmptyTermClick"]],template:function(e,t){1&e&&(f.Rb(0,"eg-staff-banner",0),f.Xb(1,ca),f.Qb(),f.Rb(2,"eg-title",1),f.Xb(3,na),f.Qb(),f.Rb(4,"form",2),f.Rb(5,"div",3),f.Rb(6,"eg-org-family-select",4),f.Xb(7,sa),f.Qb(),f.Qb(),f.Rb(8,"div",5),f.Rb(9,"div",6),f.Rb(10,"h2",7),f.Vb(11,ba),f.Qb(),f.Rb(12,"ngb-tabset",8,9),f.Rb(14,"ngb-tab",10),f.Kc(15,Ra,3,1,"ng-template",11),f.Kc(16,Oa,8,1,"ng-template",12),f.Qb(),f.Rb(17,"ngb-tab",13),f.Kc(18,Sa,3,1,"ng-template",11),f.Kc(19,xa,8,1,"ng-template",12),f.Qb(),f.Rb(20,"ngb-tab",14),f.Kc(21,ka,3,1,"ng-template",11),f.Kc(22,Ta,10,1,"ng-template",12),f.Qb(),f.Qb(),f.Qb(),f.Qb(),f.Qb(),f.Mb(23,"eg-reservations-grid",15,16)),2&e&&(f.xb(4),f.oc("formGroup",t.filters),f.xb(8),f.oc("activeId",t.startingTab),f.xb(11),f.oc("patron",t.patronId)("resourceBarcode",t.resourceBarcode.value)("resourceType",t.resourceTypeForGrid)("pickupLibIds",t.pickupLibrariesForGrid))},directives:[Ee.a,Ke.a,a.J,a.u,a.k,Wt.a,a.t,a.i,ht.W,ht.T,ht.V,ht.U,Fe,E.v,a.c,vt.a],encapsulation:2}),e})();var Ca=r("pLZG"),$a=r("W4aW");const La=["readyGrid"],Ba=["pickedUpGrid"],Da=["bannerText",$localize`:␟e7ca59649dc2e9f5630ea74d25e1bff8d142bc90␟2315905323650055729:Booking Pickup`],ja=["prefix",$localize`:␟6c088e91256dd14ed45f9b23c7f33bf6987c9694␟847964475497879979:Booking`,"suffix",$localize`:␟269c40d042d45e3dfd68187c8019fc8034963257␟6541976377673512417:Pickup`];var Pa,Va,Aa,Na;function Xa(e,t){if(1&e){const e=f.Sb();f.Rb(0,"div"),f.Rb(1,"h2",9),f.Vb(2,Va),f.Qb(),f.Rb(3,"div",10),f.Rb(4,"input",11),f.fc("change",(function(){return f.Bc(e),f.hc().handleShowCapturedChange()})),f.Qb(),f.Rb(5,"label",12),f.Vb(6,Aa),f.Qb(),f.Qb(),f.Rb(7,"eg-reservations-grid",13,14),f.fc("onPickup",(function(){return f.Bc(e),f.zc(12).reloadGrid()})),f.Qb(),f.Rb(9,"h2",15),f.Vb(10,Na),f.Qb(),f.Mb(11,"eg-reservations-grid",16,17),f.Qb()}if(2&e){const e=f.hc();f.xb(4),f.oc("checked",e.onlyShowCaptured),f.xb(3),f.oc("patron",e.patronId)("onlyCaptured",e.onlyShowCaptured),f.xb(4),f.oc("patron",e.patronId)}}Pa=$localize`:␟a5af88d641d9f4f325017b9951c6afed7477566d␟4713151336247961822:Patron barcode`,Va=$localize`:␟77ed0667dcca4e14d0b4b335c9d64b4bf9ca30e3␟5757754182476419353:Ready for pickup`,Aa=$localize`:␟4133f0bb4b1ff9c5e5e82bd5edab2f4dd75441e5␟1191710559689808761:Show only captured resources`,Na=$localize`:␟301b7f6a77d54d9ca0661c6be145bf41420e21d2␟5080686756796487332:Already picked up`;let Ga=(()=>{class e{constructor(e,t,r,a,i,o,c){this.pcrud=e,this.patron=t,this.pbv=r,this.route=a,this.router=i,this.store=o,this.toast=c,this.subscriptions=[],this.onlyShowCaptured=!0}ngOnInit(){this.findPatron=new a.j({patronBarcode:new a.g(null,[a.H.required],[this.pbv.validate])}),this.route.paramMap.pipe(Object(Ca.a)(e=>e.has("patron_id")),Object(s.a)(e=>(this.patronId=+e.get("patron_id"),this.pcrud.search("au",{id:this.patronId},{limit:1,flesh:1,flesh_fields:{au:["card"]}})))).subscribe(e=>{this.findPatron.patchValue({patronBarcode:e.card().barcode()},{emitEvent:!1}),this.readyGrid.reloadGrid(),this.pickedUpGrid.reloadGrid()}),this.subscriptions.push(this.patronBarcode.valueChanges.pipe(Object(n.a)(1500),Object(s.a)(e=>"INVALID"===this.patronBarcode.status?(this.toast.danger("No patron found with this barcode"),Object(c.a)()):this.patron.bcSearch(e).pipe(Object(lt.a)(),Object(m.a)(e=>{this.router.navigate(["/staff","booking","pickup","by_patron",e[0].id])})))).subscribe()),this.store.getItem("eg.booking.pickup.ready.only_show_captured").then(e=>{null!=e&&(this.onlyShowCaptured=e)}),this.handleShowCapturedChange=()=>{this.onlyShowCaptured=!this.onlyShowCaptured,this.readyGrid.reloadGrid(),this.store.setItem("eg.booking.pickup.ready.only_show_captured",this.onlyShowCaptured)}}get patronBarcode(){return this.findPatron.get("patronBarcode")}ngOnDestroy(){this.subscriptions.forEach(e=>{e.unsubscribe()})}}return e.\u0275fac=function(t){return new(t||e)(f.Lb(h.a),f.Lb($a.a),f.Lb(ft.a),f.Lb(o.a),f.Lb(o.c),f.Lb(qt.a),f.Lb(u.a))},e.\u0275cmp=f.Fb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var r;1&e&&(f.Sc(La,!0),f.Sc(Ba,!0)),2&e&&(f.yc(r=f.gc())&&(t.readyGrid=r.first),f.yc(r=f.gc())&&(t.pickedUpGrid=r.first))},decls:12,vars:2,consts:[[6,"bannerText"],[6,"prefix","suffix"],[1,"row",3,"formGroup"],[1,"col-md-4"],[1,"input-group","flex-nowrap"],[1,"input-group-prepend"],["for","patron-barcode",1,"input-group-text"],["type","text","id","patron-barcode","formControlName","patronBarcode",1,"form-control"],[4,"ngIf"],[1,"text-center"],[1,"form-check"],["type","checkbox","id","only-show-captured",1,"form-check-input",3,"checked","change"],["for","only-show-captured",1,"form-check-label"],["status","pickupReady","persistSuffix","pickup.ready",3,"patron","onlyCaptured","onPickup"],["readyGrid",""],[1,"text-center","mt-2"],["status","pickedUp","persistSuffix","pickup.picked_up",3,"patron"],["pickedUpGrid",""]],template:function(e,t){1&e&&(f.Rb(0,"eg-staff-banner",0),f.Xb(1,Da),f.Qb(),f.Rb(2,"eg-title",1),f.Xb(3,ja),f.Qb(),f.Rb(4,"form",2),f.Rb(5,"div",3),f.Rb(6,"div",4),f.Rb(7,"div",5),f.Rb(8,"label",6),f.Vb(9,Pa),f.Qb(),f.Mb(10,"input",7),f.Qb(),f.Qb(),f.Qb(),f.Qb(),f.Kc(11,Xa,13,4,"div",8)),2&e&&(f.xb(4),f.oc("formGroup",t.findPatron),f.xb(7),f.oc("ngIf",t.patronId))},directives:[Ee.a,Ke.a,a.J,a.u,a.k,a.c,a.t,a.i,E.v,Fe],encapsulation:2}),e})();const Ma=["confirmCancelReservationDialog"],Fa=["pullList"],Ea=["bannerText",$localize`:␟cb4c1051d9bc99fb38413eef51dc4461736a35b2␟3297294381498669224:Booking Pull List`],Ka=["prefix",$localize`:␟6c088e91256dd14ed45f9b23c7f33bf6987c9694␟847964475497879979:Booking`,"suffix",$localize`:␟35f5f744ebf130353e283dd54e6397b0569b9e9f␟8548816089773833615:Pull List`];var qa,Ua;qa=$localize`:␟376f43683bb4bdea25afad31cf5eedaaca44cac4␟8841522253323890487:Library:`,Ua=$localize`:␟5e495b390d27bb30b4ef8208854cecd9b6308ae6␟8635138750344109825:Number of days to fetch:`;const Ha=["label",$localize`:␟864a74fcf43e35646fa5b4044996dce75d9224b0␟4631443662332502920:Cancel Selected`],Ja=["label",$localize`:␟1de6b559c8ef8d3c9a044d0f8944e2ad3907eab7␟2449572130417759292:View Item Status`],Wa=["label",$localize`:␟38125d8aada23aff979f4b47323f42654b83ae14␟7116064472023363630:View Reservations for This Resource`],Za=["label",$localize`:␟38e0f1b01151d87bc0ee6824e9926a32822d918f␟5744668833711468792:Print Pull List`],Ya=["label",$localize`:␟45cc8ca94b5a50842a9a8ef804a5ab089a38ae5c␟8040881171107393560:ID`],ei=["label",$localize`:␟9572de8e7e649983ea8dc8932f8f1e1b32587307␟1292831281473912533:Shelving location`],ti=["label",$localize`:␟711618da7e334df6719a35d3fe5492def987d04e␟2561573928784395901:Call number`],ri=["label",$localize`:␟fcb85937bc59b43ab112052b8651a87f5211e8c7␟6545562865777998484:Call number sortkey`],ai=["label",$localize`:␟d81e7544c57020f4d7355d9aa1a6aaf8f6e37962␟3011112932753861347:Barcode`],ii=["label",$localize`:␟c5d87900cd77f8d9143a0ba50f627b78257afb77␟3330087854613419811:Title or name`],oi=["label",$localize`:␟9eb0a383285724233ae15702aa27f6af073883f1␟1066761790814313272:Reservation start time`],ci=["label",$localize`:␟e09fa8fdfd69f7e3fb94931164ff8c56d72424db␟8345622575076961548:Reservation end time`],ni=["label",$localize`:␟608e773333d59a85d7d46e8ace5362c5d3e9ce2b␟1997357726019367256:Patron first name`],si=["label",$localize`:␟d7161c0d41747a7b99a785f09b33f7267207c8b0␟6560034673377734179:Patron last name`];let bi=(()=>{class e{constructor(e,t,r,a,i){this.auth=e,this.net=t,this.org=r,this.pcrud=a,this.actions=i,this.dataSource=new x.c,this.noSelectedRows=e=>0===e.length,this.notOneResourceSelected=e=>this.actions.notOneUniqueSelected(e.map(e=>{if(e.current_resource)return e.current_resource.id})),this.notOneCatalogedItemSelected=e=>this.actions.notOneUniqueSelected(e.filter(e=>e.current_resource&&e.call_number).map(e=>e.current_resource.id())),this.cancelSelected=e=>{this.cancelReservationDialog.open(e.map(e=>e.reservations[0].id()))},this.fleshResource$=e=>"t"===e.target_resource_type.catalog_item()?this.pcrud.search("acp",{barcode:e.current_resource.barcode()},{limit:1,flesh:1,flesh_fields:{acp:["call_number","location"]}}).pipe(Object(v.a)(t=>(e.call_number=t.call_number().label(),e.call_number_sortkey=t.call_number().label_sortkey(),e.shelving_location=t.location().name(),Object(c.a)(e)))):Object(c.a)(e),this.viewByResource=e=>{this.actions.manageReservationsByResource(e[0].current_resource.barcode())},this.viewItemStatus=e=>{this.actions.viewItemStatus(e[0].current_resource.barcode())}}ngOnInit(){this.currentOrg=this.auth.user().ws_ou(),this.pullListCriteria=new a.j({daysHence:new a.g(5,[a.H.required,a.H.min(1)])}),this.pullListCriteria.valueChanges.subscribe(()=>this.pullList.reload()),this.disableOrgs=()=>this.org.filterList({canHaveVolumes:!1},!0),this.handleOrgChange=e=>{this.currentOrg=e.id(),this.pullList.reload()},this.dataSource.getRows=e=>this.net.request("open-ils.booking","open-ils.booking.reservations.get_pull_list",this.auth.token(),null,86400*this.daysHence.value,this.currentOrg).pipe(Object(s.a)(e=>Object(O.a)(e)),Object(v.a)(e=>this.fleshResource$(e)))}get daysHence(){return this.pullListCriteria.get("daysHence")}}return e.\u0275fac=function(t){return new(t||e)(f.Lb(b.a),f.Lb(l.b),f.Lb(w.a),f.Lb(h.a),f.Lb(R))},e.\u0275cmp=f.Fb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var r;1&e&&(f.Ic(Ma,!0),f.Ic(Fa,!0)),2&e&&(f.yc(r=f.gc())&&(t.cancelReservationDialog=r.first),f.yc(r=f.gc())&&(t.pullList=r.first))},decls:49,vars:15,consts:[[6,"bannerText"],[6,"prefix","suffix"],[1,"row",3,"formGroup"],[1,"col-md-4"],[1,"input-group"],[1,"input-group-prepend"],["for","ou",1,"input-group-text"],["domId","ou",3,"applyDefault","disableOrgs","hideOrgs","onChange"],["for","days-hence",1,"input-group-text"],["type","number","min","1","formControlName","daysHence",1,"form-control"],["persistKey","booking.pull_list",3,"dataSource","useLocalSort","disablePaging","sortable"],["pullList",""],[3,"disableOnRows","onClick",6,"label"],[3,"onClick",6,"label"],["name","id","path","current_resource.id",3,"hidden","index",6,"label"],["path","shelving_location",6,"label"],["path","call_number",6,"label"],["path","call_number_sortkey",6,"label"],["name","barcode","path","current_resource.barcode",6,"label"],["name","title","path","target_resource_type.name",6,"label"],["datatype","timestamp","path","reservations.0.start_time",3,"datePlusTime",6,"label"],["datatype","timestamp","path","reservations.0.end_time",3,"datePlusTime",6,"label"],["path","reservations.0.usr.first_given_name",6,"label"],["path","reservations.0.usr.family_name",6,"label"],[3,"onSuccessfulCancel"],["confirmCancelReservationDialog",""]],template:function(e,t){if(1&e){const e=f.Sb();f.Rb(0,"eg-staff-banner",0),f.Xb(1,Ea),f.Qb(),f.Rb(2,"eg-title",1),f.Xb(3,Ka),f.Qb(),f.Rb(4,"form",2),f.Rb(5,"div",3),f.Rb(6,"div",4),f.Rb(7,"div",5),f.Rb(8,"label",6),f.Vb(9,qa),f.Qb(),f.Qb(),f.Rb(10,"eg-org-select",7),f.fc("onChange",(function(e){return t.handleOrgChange(e)})),f.Qb(),f.Qb(),f.Qb(),f.Rb(11,"div",3),f.Rb(12,"div",4),f.Rb(13,"div",5),f.Rb(14,"label",8),f.Vb(15,Ua),f.Qb(),f.Qb(),f.Mb(16,"input",9),f.Qb(),f.Qb(),f.Qb(),f.Rb(17,"eg-grid",10,11),f.Rb(19,"eg-grid-toolbar-action",12),f.Xb(20,Ha),f.fc("onClick",(function(e){return t.cancelSelected(e)})),f.Qb(),f.Rb(21,"eg-grid-toolbar-action",12),f.Xb(22,Ja),f.fc("onClick",(function(e){return t.viewItemStatus(e)})),f.Qb(),f.Rb(23,"eg-grid-toolbar-action",12),f.Xb(24,Wa),f.fc("onClick",(function(e){return t.viewByResource(e)})),f.Qb(),f.Rb(25,"eg-grid-toolbar-action",13),f.Xb(26,Za),f.fc("onClick",(function(){return f.Bc(e),f.zc(18).print()})),f.Qb(),f.Rb(27,"eg-grid-column",14),f.Xb(28,Ya),f.Qb(),f.Rb(29,"eg-grid-column",15),f.Xb(30,ei),f.Qb(),f.Rb(31,"eg-grid-column",16),f.Xb(32,ti),f.Qb(),f.Rb(33,"eg-grid-column",17),f.Xb(34,ri),f.Qb(),f.Rb(35,"eg-grid-column",18),f.Xb(36,ai),f.Qb(),f.Rb(37,"eg-grid-column",19),f.Xb(38,ii),f.Qb(),f.Rb(39,"eg-grid-column",20),f.Xb(40,oi),f.Qb(),f.Rb(41,"eg-grid-column",21),f.Xb(42,ci),f.Qb(),f.Rb(43,"eg-grid-column",22),f.Xb(44,ni),f.Qb(),f.Rb(45,"eg-grid-column",23),f.Xb(46,si),f.Qb(),f.Qb(),f.Rb(47,"eg-cancel-reservation-dialog",24,25),f.fc("onSuccessfulCancel",(function(){return f.Bc(e),f.zc(18).reload()})),f.Qb()}2&e&&(f.xb(4),f.oc("formGroup",t.pullListCriteria),f.xb(6),f.oc("applyDefault",!0)("disableOrgs",t.disableOrgs())("hideOrgs",t.disableOrgs()),f.xb(7),f.oc("dataSource",t.dataSource)("useLocalSort",!0)("disablePaging",!0)("sortable",!0),f.xb(2),f.oc("disableOnRows",t.noSelectedRows),f.xb(2),f.oc("disableOnRows",t.notOneCatalogedItemSelected),f.xb(2),f.oc("disableOnRows",t.notOneResourceSelected),f.xb(4),f.oc("hidden",!0)("index",!0),f.xb(12),f.oc("datePlusTime",!0),f.xb(2),f.oc("datePlusTime",!0))},directives:[Ee.a,Ke.a,a.J,a.u,a.k,gt.a,a.z,a.c,a.t,a.i,I.a,F.a,K.a,G],encapsulation:2}),e})();const li=["tabs"],di=["bannerText",$localize`:␟e11f99702f8c0992a4133ebe9bfd4720c4060845␟1061258723489098351:Booking Return`],ui=["prefix",$localize`:␟6c088e91256dd14ed45f9b23c7f33bf6987c9694␟847964475497879979:Booking`,"suffix",$localize`:␟4d1d4f8c3875d65fd8c775d6ee617c1b2f41f6df␟7286475218857509962:Return`],fi=["title",$localize`:␟8ba1170b00c83cc9a469b91dcc09812db222205d␟6824381776715042241:By patron`],pi=["title",$localize`:␟0100ad490e00378cf0dfeff0126e593047302187␟4981478075863616748:By resource`];var hi;hi=$localize`:␟a5af88d641d9f4f325017b9951c6afed7477566d␟4713151336247961822:Patron barcode`;const gi=["placeholder",$localize`:␟a5af88d641d9f4f325017b9951c6afed7477566d␟4713151336247961822:Patron barcode`];var mi,vi,yi;function Ri(e,t){if(1&e){const e=f.Sb();f.Rb(0,"div"),f.Rb(1,"h2",15),f.Vb(2,mi),f.Qb(),f.Rb(3,"eg-reservations-grid",16,17),f.fc("onReturn",(function(){return f.Bc(e),f.hc(2).refreshGrids()})),f.Qb(),f.Rb(5,"h2",15),f.Vb(6,vi),f.Qb(),f.Mb(7,"eg-reservations-grid",18,19),f.Qb()}if(2&e){const e=f.hc(2);f.xb(3),f.oc("patron",e.patronId),f.xb(4),f.oc("patron",e.patronId)}}function _i(e,t){if(1&e&&(f.Rb(0,"div",8),f.Rb(1,"div",9),f.Rb(2,"div",10),f.Rb(3,"div",11),f.Rb(4,"label",12),f.Vb(5,hi),f.Qb(),f.Rb(6,"input",13),f.Xb(7,gi),f.Qb(),f.Qb(),f.Qb(),f.Qb(),f.Qb(),f.Kc(8,Ri,9,2,"div",14)),2&e){const e=f.hc();f.xb(8),f.oc("ngIf",e.patronId)}}mi=$localize`:␟549ec1a4264029854234043b70e2b7d6e647ecc2␟8409957462768659984:Ready for return`,vi=$localize`:␟fa0cb127bb164be043dfff5ab97e1af07a168b71␟2847903893966657597:Returned today`,yi=$localize`:␟f0850ec47a55edd1fdc712a23379cfba7be4a231␟3830558080255006527:Resource barcode`;const Oi=["placeholder",$localize`:␟f0850ec47a55edd1fdc712a23379cfba7be4a231␟3830558080255006527:Resource barcode`];var Qi,Si;function Ii(e,t){if(1&e){const e=f.Sb();f.Rb(0,"div"),f.Rb(1,"h2",15),f.Vb(2,Qi),f.Qb(),f.Rb(3,"eg-reservations-grid",22,17),f.fc("onReturn",(function(){return f.Bc(e),f.zc(8).reloadGrid()})),f.Qb(),f.Rb(5,"h2",15),f.Vb(6,Si),f.Qb(),f.Mb(7,"eg-reservations-grid",23,19),f.Qb()}if(2&e){const e=f.hc(2);f.xb(3),f.oc("patron",e.patronId),f.xb(4),f.oc("patron",e.patronId)}}function xi(e,t){if(1&e&&(f.Rb(0,"div",10),f.Rb(1,"div",11),f.Rb(2,"label",20),f.Vb(3,yi),f.Qb(),f.Rb(4,"input",21),f.Xb(5,Oi),f.Qb(),f.Qb(),f.Qb(),f.Kc(6,Ii,9,2,"div",14)),2&e){const e=f.hc();f.xb(6),f.oc("ngIf",e.patronId)}}Qi=$localize`:␟549ec1a4264029854234043b70e2b7d6e647ecc2␟8409957462768659984:Ready for return`,Si=$localize`:␟fa0cb127bb164be043dfff5ab97e1af07a168b71␟2847903893966657597:Returned today`;let wi=(()=>{class e{constructor(e,t,r,a,i,o,c){this.pcrud=e,this.patron=t,this.pbv=r,this.route=a,this.router=i,this.store=o,this.toast=c,this.subscriptions=[],this.handleParams$=e=>(this.patronId=+e.get("patron_id"),this.patronId?this.pcrud.search("au",{id:this.patronId},{limit:1,flesh:1,flesh_fields:{au:["card"]}}).pipe(Object(m.a)(e=>{this.findPatron.patchValue({patronBarcode:e.card().barcode()}),this.refreshGrids()},e=>{console.debug(e)})):Object(O.a)(this.store.getItem("eg.booking.return.tab")).pipe(Object(m.a)(e=>{e&&this.tabs.select(e)}))),this.refreshGrids=()=>{this.grids.forEach(e=>e.reloadGrid())}}ngOnInit(){this.route.paramMap.pipe(Object(s.a)(e=>this.handleParams$(e))).subscribe(),this.findPatron=new a.j({patronBarcode:new a.g(null,[a.H.required],[this.pbv.validate]),resourceBarcode:new a.g(null,[a.H.required])}),this.subscriptions.push(this.patronBarcode.valueChanges.pipe(Object(n.a)(1500),Object(s.a)(e=>"INVALID"===this.patronBarcode.status?(this.toast.danger("No patron found with this barcode"),Object(c.a)()):this.patron.bcSearch(e).pipe(Object(lt.a)(),Object(m.a)(e=>{this.router.navigate(["/staff","booking","return","by_patron",e[0].id])})))).subscribe()),this.subscriptions.push(this.resourceBarcode.valueChanges.pipe(Object(n.a)(1500),Object(s.a)(e=>"INVALID"!==this.resourceBarcode.status?this.pcrud.search("brsrc",{barcode:e},{order_by:{curr_rsrcs:"pickup_time DESC"},limit:1,flesh:1,flesh_fields:{brsrc:["curr_rsrcs"]},select:{curr_rsrcs:{return_time:null,pickup_time:{"!=":null}}}}).pipe(Object(m.a)(e=>{e.curr_rsrcs()[0].usr()&&(this.patronId=e.curr_rsrcs()[0].usr(),this.refreshGrids())})):Object(c.a)())).subscribe()),this.noSelectedRows=e=>0===e.length,this.handleTabChange=e=>{this.store.setItem("eg.booking.return.tab",e.nextId).then(()=>{this.router.navigate(["/staff","booking","return"]),this.findPatron.patchValue({resourceBarcode:""}),this.patronId=null})}}get patronBarcode(){return this.findPatron.get("patronBarcode")}get resourceBarcode(){return this.findPatron.get("resourceBarcode")}ngOnDestroy(){this.subscriptions.forEach(e=>{e.unsubscribe()})}}return e.\u0275fac=function(t){return new(t||e)(f.Lb(h.a),f.Lb($a.a),f.Lb(ft.a),f.Lb(o.a),f.Lb(o.c),f.Lb(qt.a),f.Lb(u.a))},e.\u0275cmp=f.Fb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var r;1&e&&(f.Ic(li,!0),f.Sc(Fe,!0)),2&e&&(f.yc(r=f.gc())&&(t.tabs=r.first),f.yc(r=f.gc())&&(t.grids=r))},decls:13,vars:1,consts:[[6,"bannerText"],[6,"prefix","suffix"],[3,"formGroup"],["activeId","patron",3,"tabChange"],["tabs",""],["id","patron",6,"title"],["ngbTabContent",""],["id","resource",6,"title"],[1,"row"],[1,"col-md-4"],[1,"input-group","flex-nowrap"],[1,"input-group-prepend"],["for","patron-barcode",1,"input-group-text"],["type","text","id","patron-barcode","formControlName","patronBarcode",1,"form-control",6,"placeholder"],[4,"ngIf"],[1,"text-center"],["status","returnReady","persistSuffix","return.patron.picked_up",3,"patron","onReturn"],["readyGrid",""],["status","returnedToday","persistSuffix","return.patron.returned",3,"patron"],["returnedGrid",""],["for","resource-barcode",1,"input-group-text"],["type","text","id","resource-barcode","formControlName","resourceBarcode",1,"form-control",6,"placeholder"],["status","returnReady","persistSuffix","return.resource.picked_up",3,"patron","onReturn"],["status","returnedToday","persistSuffix","return.resource.returned",3,"patron"]],template:function(e,t){1&e&&(f.Rb(0,"eg-staff-banner",0),f.Xb(1,di),f.Qb(),f.Rb(2,"eg-title",1),f.Xb(3,ui),f.Qb(),f.Rb(4,"form",2),f.Rb(5,"ngb-tabset",3,4),f.fc("tabChange",(function(e){return t.handleTabChange(e)})),f.Rb(7,"ngb-tab",5),f.Xb(8,fi),f.Kc(9,_i,9,1,"ng-template",6),f.Qb(),f.Rb(10,"ngb-tab",7),f.Xb(11,pi),f.Kc(12,xi,7,1,"ng-template",6),f.Qb(),f.Qb(),f.Qb()),2&e&&(f.xb(4),f.oc("formGroup",t.findPatron))},directives:[Ee.a,Ke.a,a.J,a.u,a.k,ht.W,ht.T,ht.U,a.c,a.t,a.i,E.v,Fe],encapsulation:2}),e})();const ki=[{path:"create_reservation",children:[{path:"",component:aa},{path:"for_patron/:patron_id",component:aa},{path:"for_resource/:resource_barcode",component:aa}]},{path:"manage_reservations",children:[{path:"",component:za},{path:"by_patron/:patron_id",component:za},{path:"by_resource/:resource_barcode",component:za},{path:"by_resource_type/:resource_type_id",component:za}]},{path:"capture",component:it},{path:"pickup",children:[{path:"",component:Ga},{path:"by_patron/:patron_id",component:Ga}]},{path:"pull_list",component:bi},{path:"return",children:[{path:"",component:wi},{path:"by_patron/:patron_id",component:wi}]}];let Ti=(()=>{class e{}return e.\u0275mod=f.Jb({type:e}),e.\u0275inj=f.Ib({factory:function(t){return new(t||e)},providers:[],imports:[[o.g.forChild(ki)],o.g]}),e})();var zi=r("Y/mG"),Ci=r("zF8d"),$i=r("csFu");let Li=(()=>{class e{}return e.\u0275mod=f.Jb({type:e}),e.\u0275inj=f.Ib({factory:function(t){return new(t||e)},imports:[[i.a,Ti,a.D,Ci.a,$i.a,zi.a]]}),e})()}}]);