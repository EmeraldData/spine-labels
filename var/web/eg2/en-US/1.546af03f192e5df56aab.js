(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"9emE":function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var n=i("fXoL"),c=i("1kSV"),o=i("ofXK");const l=["aria-label",$localize`:␟498a88d953342beb9fc3e574107b2f1b6a71132b␟656720496971960532:Show help`],r=["aria-label",$localize`:␟498a88d953342beb9fc3e574107b2f1b6a71132b␟656720496971960532:Show help`];function a(e,t){if(1&e&&(n.Rb(0,"a",5),n.Mc(1),n.Qb()),2&e){const e=n.hc(2);n.pc("href",e.helpLink,n.Ec),n.xb(1),n.Nc(e.helpText)}}function s(e,t){if(1&e&&(n.Rb(0,"span"),n.Mc(1),n.Qb()),2&e){const e=n.hc(2);n.xb(1),n.Nc(e.helpText)}}function d(e,t){if(1&e&&(n.Kc(0,a,2,2,"a",3),n.Kc(1,s,2,1,"span",4)),2&e){const e=n.hc();n.oc("ngIf",e.helpLink.length>=1),n.xb(1),n.oc("ngIf",e.helpLink.length<1)}}let b=(()=>{class e{constructor(){this.helpText="",this.helpLink="",this.placement=""}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.Fb({type:e,selectors:[["eg-help-popover"]],inputs:{helpText:"helpText",helpLink:"helpLink",placement:"placement"},decls:7,vars:2,consts:[["popContent",""],["triggers","click","i","","aria-haspopup","true",1,"btn","btn-sm",3,"placement","ngbPopover",6,"aria-label"],[1,"material-icons",6,"aria-label"],["target","_blank",3,"href",4,"ngIf"],[4,"ngIf"],["target","_blank",3,"href"]],template:function(e,t){if(1&e&&(n.Kc(0,d,2,2,"ng-template",null,0,n.Lc),n.Rb(2,"button",1),n.Xb(3,l),n.Rb(4,"span",2),n.Xb(5,r),n.Mc(6,"live_help"),n.Qb(),n.Qb()),2&e){const e=n.zc(1);n.xb(2),n.pc("placement",t.placement),n.oc("ngbPopover",e)}},directives:[c.M,o.v],styles:[""]}),e})()},EBEo:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i("VEwP"),c=i("pKmL"),o=i("fXoL");let l=(()=>{class e{}return e.\u0275mod=o.Jb({type:e}),e.\u0275inj=o.Ib({factory:function(t){return new(t||e)},providers:[],imports:[[n.a,c.a]]}),e})()},UUQ6:function(e,t,i){"use strict";i.d(t,"a",(function(){return Ie}));var n=i("fXoL"),c=i("wBwE"),o=i("lJxs"),l=i("8PDw"),r=i("iA0r"),a=i("rRT/"),s=i("YRS1"),d=i("tNQm"),b=i("ZvpF"),f=i("oCNH"),h=i("36iw"),u=i("1kSV"),p=i("ofXK"),m=i("3Pt+"),g=i("TxlL"),y=i("9emE"),x=i("LTyc"),O=i("vG6Q"),v=i("wVJ/"),R=i("9rfo");const k=["translator"],I=["successStr"],w=["failStr"],L=["confirmDel"],S=["fmEditForm"],C=["text",$localize`:␟1e7198a92dfc8253681b9e6d19e97df16f350197␟4579403834668086046:Update Succeeded`],$=["text",$localize`:␟8594cbbbf15dab72ec11fc33d97b788a9af85f8c␟4481765966719564255:Update Failed`],F=["dialogTitle",$localize`:␟f716e0d613b06f407449ca588258d6590fd858c0␟5210270493533766316:Delete?`,"dialogBody",$localize`:␟8d86feac6115f29ba96c620368e61b5ec677a8c2␟8634181942942309199:Delete ${"\ufffd0\ufffd"}:INTERPOLATION:?`];var P;P=$localize`:␟60b39a21a09312befaa59a5dcd8a2d024815f308␟2142628387891925342:Record Editor: ${"\ufffd0\ufffd"}:INTERPOLATION:`;const T=["aria-label",$localize`:␟f4e529ae5ffd73001d1ff4bbdeeb0a72e342e5c8␟7819314041543176992:Close`];function V(e,t){if(1&e){const e=n.Sb();n.Pb(0),n.Rb(1,"button",17),n.Xb(2,T),n.fc("click",(function(){return n.Bc(e),n.hc(3).closeEditor()})),n.Rb(3,"span",18),n.Mc(4,"\xd7"),n.Qb(),n.Qb(),n.Ob()}}function Q(e,t){if(1&e&&(n.Rb(0,"div",15),n.Rb(1,"h4",16),n.Vb(2,P),n.Qb(),n.Kc(3,V,5,0,"ng-container",7),n.Qb()),2&e){const e=n.hc(2);n.xb(2),n.Zb(e.recordLabel),n.Wb(2),n.xb(1),n.oc("ngIf",e.isDialog())}}function D(e,t){1&e&&(n.Pb(0),n.Mb(1,"eg-progress-inline"),n.Ob())}function M(e,t){if(1&e&&n.Mb(0,"eg-help-popover",28),2&e){const e=n.hc().$implicit;n.pc("helpText",e.helpTextValue),n.oc("placement","right")}}function E(e,t){1&e&&n.Nb(0)}function K(e,t){if(1&e&&(n.Pb(0),n.Kc(1,E,1,0,"ng-container",29),n.Ob()),2&e){const e=n.hc().$implicit,t=n.hc(3);n.xb(1),n.oc("ngTemplateOutlet",e.template)("ngTemplateOutletContext",t.customTemplateFieldContext(e))}}function z(e,t){if(1&e&&(n.Pb(0),n.Rb(1,"span"),n.Mc(2),n.Qb(),n.Ob()),2&e){const e=n.hc().$implicit,t=n.hc(3);n.xb(2),n.Nc(t.record[e.name]())}}function N(e,t){if(1&e&&(n.Pb(0),n.Rb(1,"span"),n.Mc(2),n.ic(3,"currency"),n.Qb(),n.Ob()),2&e){const e=n.hc().$implicit,t=n.hc(3);n.xb(2),n.Nc(n.jc(3,1,t.record[e.name]()))}}function q(e,t){if(1&e&&(n.Pb(0),n.Rb(1,"span"),n.Mc(2),n.Qb(),n.Ob()),2&e){const e=n.hc(2).$implicit;n.xb(2),n.Nc(e.linkedValues[0].label)}}function B(e,t){if(1&e&&(n.Pb(0),n.Kc(1,q,3,1,"ng-container",7),n.Ob()),2&e){const e=n.hc().$implicit;n.xb(1),n.oc("ngIf",e.linkedValues&&(null==e.linkedValues[0]?null:e.linkedValues[0].label))}}function _(e,t){if(1&e){const e=n.Sb();n.Pb(0),n.Rb(1,"eg-date-select",30),n.fc("onChangeAsIso",(function(t){n.Bc(e);const i=n.hc().$implicit;return n.hc(3).record[i.name](t)})),n.Qb(),n.Ob()}if(2&e){const e=n.hc().$implicit,t=n.hc(3);n.xb(1),n.rc("domId","",t.idPrefix,"-",e.name,""),n.pc("initialIso",t.record[e.name]()),n.oc("readOnly",e.readOnly)}}function A(e,t){if(1&e){const e=n.Sb();n.Pb(0),n.Rb(1,"eg-datetime-select",31),n.fc("onChangeAsIso",(function(t){n.Bc(e);const i=n.hc().$implicit;return n.hc(3).record[i.name](t)})),n.Qb(),n.Ob()}if(2&e){const e=n.hc().$implicit,t=n.hc(3);n.xb(1),n.rc("domId","",t.idPrefix,"-",e.name,""),n.pc("initialIso",t.record[e.name]()),n.oc("showTZ",t.timezone)("timezone",t.timezone)("readOnly",e.readOnly)}}const X=["placeholder",$localize`:␟1dd50e17fd0b751cf1eeee4bd5a0159c1aac1271␟4418856020155978145:${"\ufffd0\ufffd"}:INTERPOLATION:...`];function j(e,t){if(1&e){const e=n.Sb();n.Pb(0),n.Rb(1,"eg-org-select",32),n.Xb(2,X),n.fc("onChange",(function(t){n.Bc(e);const i=n.hc().$implicit;return n.hc(3).record[i.name](t)})),n.Qb(),n.Ob()}if(2&e){const e=n.hc().$implicit,t=n.hc(3);n.xb(1),n.Zb(e.label),n.Wb(2),n.rc("domId","",t.idPrefix,"-",e.name,""),n.oc("limitPerms",t.modePerms[t.mode])("readOnly",e.readOnly)("applyDefault",e.orgDefaultAllowed)("applyOrgId",t.record[e.name]())}}const Z=["placeholder",$localize`:␟1dd50e17fd0b751cf1eeee4bd5a0159c1aac1271␟4418856020155978145:${"\ufffd0\ufffd"}:INTERPOLATION:...`];function J(e,t){if(1&e){const e=n.Sb();n.Pb(0),n.Rb(1,"input",33),n.Xb(2,Z),n.fc("ngModelChange",(function(t){n.Bc(e);const i=n.hc().$implicit;return n.hc(3).record[i.name](t)})),n.Qb(),n.Ob()}if(2&e){const e=n.hc().$implicit,t=n.hc(3);n.xb(1),n.Zb(e.label),n.Wb(2),n.pc("name",e.name),n.rc("id","",t.idPrefix,"-",e.name,""),n.oc("readonly",e.readOnly)("required",e.isRequired())("ngModel",t.record[e.name]())}}const W=["placeholder",$localize`:␟1dd50e17fd0b751cf1eeee4bd5a0159c1aac1271␟4418856020155978145:${"\ufffd0\ufffd"}:INTERPOLATION:...`];function U(e,t){if(1&e){const e=n.Sb();n.Pb(0),n.Rb(1,"input",34),n.Xb(2,W),n.fc("ngModelChange",(function(t){n.Bc(e);const i=n.hc().$implicit;return n.hc(3).record[i.name](t)})),n.Qb(),n.Ob()}if(2&e){const e=n.hc().$implicit,t=n.hc(3);n.xb(1),n.Zb(e.label),n.Wb(2),n.pc("name",e.name),n.rc("id","",t.idPrefix,"-",e.name,""),n.oc("required",e.isRequired())("ngModel",t.record[e.name]())}}const H=["placeholder",$localize`:␟1dd50e17fd0b751cf1eeee4bd5a0159c1aac1271␟4418856020155978145:${"\ufffd0\ufffd"}:INTERPOLATION:...`];function Y(e,t){if(1&e){const e=n.Sb();n.Pb(0),n.Rb(1,"input",35),n.Xb(2,H),n.fc("ngModelChange",(function(t){n.Bc(e);const i=n.hc().$implicit;return n.hc(3).record[i.name](t)})),n.Qb(),n.Ob()}if(2&e){const e=n.hc().$implicit,t=n.hc(3);n.xb(1),n.Zb(e.label),n.Wb(2),n.pc("name",e.name),n.rc("id","",t.idPrefix,"-",e.name,""),n.oc("required",e.isRequired())("ngModel",t.record[e.name]())}}const G=["placeholder",$localize`:␟1dd50e17fd0b751cf1eeee4bd5a0159c1aac1271␟4418856020155978145:${"\ufffd0\ufffd"}:INTERPOLATION:...`];function ee(e,t){if(1&e){const e=n.Sb();n.Pb(0),n.Rb(1,"input",36),n.Xb(2,G),n.fc("ngModelChange",(function(t){n.Bc(e);const i=n.hc().$implicit;return n.hc(3).record[i.name](t)})),n.Qb(),n.Ob()}if(2&e){const e=n.hc().$implicit,t=n.hc(3);n.xb(1),n.Zb(e.label),n.Wb(2),n.rc("id","",t.idPrefix,"-",e.name,""),n.pc("name",e.name),n.oc("required",e.isRequired())("ngModel",t.record[e.name]())}}function te(e,t){if(1&e){const e=n.Sb();n.Pb(0),n.Rb(1,"input",37),n.fc("ngModelChange",(function(t){n.Bc(e);const i=n.hc().$implicit;return n.hc(3).record[i.name](t)})),n.Qb(),n.Ob()}if(2&e){const e=n.hc().$implicit,t=n.hc(3);n.xb(1),n.pc("name",e.name),n.rc("id","",t.idPrefix,"-",e.name,""),n.oc("disabled",e.readOnly)("ngModel",t.record[e.name]())}}const ie=["title",$localize`:␟5cc9f5e1684fb46d7ffd4c52e5fa394e88f4ad00␟8333608125215290754:Open user record in new tab`];function ne(e,t){if(1&e&&(n.Pb(0),n.Rb(1,"a",38),n.Mc(2),n.Rb(3,"span",39),n.Xb(4,ie),n.Mc(5,"open_in_new"),n.Qb(),n.Qb(),n.Ob()),2&e){const e=n.hc(2).$implicit;n.xb(1),n.qc("href","/eg/staff/circ/patron/",e.linkedValues[0].id,"/checkout",n.Ec),n.xb(1),n.Oc("",e.linkedValues[0].label," ")}}function ce(e,t){if(1&e&&(n.Pb(0),n.Kc(1,ne,6,2,"ng-container",7),n.Ob()),2&e){const e=n.hc().$implicit;n.xb(1),n.oc("ngIf",e.linkedValues)}}const oe=["placeholder",$localize`:␟1dd50e17fd0b751cf1eeee4bd5a0159c1aac1271␟4418856020155978145:${"\ufffd0\ufffd"}:INTERPOLATION:...`];function le(e,t){if(1&e){const e=n.Sb();n.Pb(0),n.Rb(1,"eg-combobox",40),n.Xb(2,oe),n.fc("onChange",(function(t){n.Bc(e);const i=n.hc().$implicit;return n.hc(3).record[i.name](t?t.id:null)})),n.Qb(),n.Ob()}if(2&e){const e=n.hc().$implicit,t=n.hc(3);n.xb(1),n.Zb(e.label),n.Wb(2),n.rc("id","",t.idPrefix,"-",e.name,""),n.pc("name",e.name),n.oc("required",e.isRequired())("entries",e.linkedValues)("asyncDataSource",e.linkedValuesSource)("selectedId",t.record[e.name]())}}const re=["title",$localize`:␟e5b9218a6c766b23fc18899f8dc559cc4f7e7621␟1613971242435858090:Translate`];function ae(e,t){if(1&e){const e=n.Sb();n.Rb(0,"div",41),n.Rb(1,"a",42),n.Xb(2,re),n.fc("click",(function(){n.Bc(e);const t=n.hc().$implicit;return n.hc(3).openTranslator(t.name)})),n.Rb(3,"button",43),n.Rb(4,"span",44),n.Mc(5,"translate"),n.Qb(),n.Qb(),n.Qb(),n.Qb()}}function se(e,t){if(1&e&&(n.Rb(0,"div",20),n.Rb(1,"div",21),n.Rb(2,"label",22),n.Mc(3),n.Qb(),n.Kc(4,M,1,2,"eg-help-popover",23),n.Qb(),n.Rb(5,"div",24),n.Pb(6,25),n.Kc(7,K,2,2,"ng-container",26),n.Kc(8,z,3,1,"ng-container",26),n.Kc(9,N,4,3,"ng-container",26),n.Kc(10,B,2,1,"ng-container",26),n.Kc(11,_,2,4,"ng-container",26),n.Kc(12,A,2,6,"ng-container",26),n.Kc(13,j,3,7,"ng-container",26),n.Kc(14,J,3,7,"ng-container",26),n.Kc(15,U,3,6,"ng-container",26),n.Kc(16,Y,3,6,"ng-container",26),n.Kc(17,ee,3,6,"ng-container",26),n.Kc(18,te,2,5,"ng-container",26),n.Kc(19,ce,2,1,"ng-container",26),n.Kc(20,le,3,8,"ng-container",26),n.Ob(),n.Qb(),n.Kc(21,ae,6,0,"div",27),n.Qb()),2&e){const e=t.$implicit,i=n.hc(3);n.xb(2),n.rc("for","",i.idPrefix,"-",e.name,""),n.xb(1),n.Nc(e.label),n.xb(1),n.oc("ngIf",e.helpText),n.xb(2),n.oc("ngSwitch",i.inputType(e)),n.xb(1),n.oc("ngSwitchCase","template"),n.xb(1),n.oc("ngSwitchCase","readonly"),n.xb(1),n.oc("ngSwitchCase","readonly-money"),n.xb(1),n.oc("ngSwitchCase","readonly-list"),n.xb(1),n.oc("ngSwitchCase","timestamp"),n.xb(1),n.oc("ngSwitchCase","timestamp-timepicker"),n.xb(1),n.oc("ngSwitchCase","org_unit"),n.xb(1),n.oc("ngSwitchCase","money"),n.xb(1),n.oc("ngSwitchCase","int"),n.xb(1),n.oc("ngSwitchCase","float"),n.xb(1),n.oc("ngSwitchCase","text"),n.xb(1),n.oc("ngSwitchCase","bool"),n.xb(1),n.oc("ngSwitchCase","readonly-au"),n.xb(1),n.oc("ngSwitchCase","list"),n.xb(1),n.oc("ngIf",e.i18n&&!e.readOnly)}}function de(e,t){if(1&e&&(n.Pb(0),n.Kc(1,se,22,20,"div",19),n.Ob()),2&e){const e=n.hc(2);n.xb(1),n.oc("ngForOf",e.fields)}}function be(e,t){if(1&e){const e=n.Sb();n.Rb(0,"button",45),n.fc("click",(function(){n.Bc(e);const i=t.$implicit,c=n.hc(2);return i.actionClick.emit({action:i.key,record:c.record})})),n.Mc(1),n.Qb()}if(2&e){const e=t.$implicit;n.Bb("btn ",e.buttonCss,""),n.oc("disabled",e.disabled),n.xb(1),n.Oc(" ",e.label," ")}}var fe,he,ue,pe;function me(e,t){if(1&e){const e=n.Sb();n.Rb(0,"button",48),n.fc("click",(function(){return n.Bc(e),n.hc(3).closeEditor()})),n.Vb(1,fe),n.Qb()}}function ge(e,t){if(1&e){const e=n.Sb();n.Rb(0,"button",49),n.fc("click",(function(){return n.Bc(e),n.hc(3).cancel()})),n.Vb(1,he),n.Qb()}}function ye(e,t){if(1&e&&(n.Pb(0),n.Kc(1,me,2,0,"button",46),n.Kc(2,ge,2,0,"button",47),n.Ob()),2&e){const e=n.hc(2);n.xb(1),n.oc("ngIf","view"==e.mode),n.xb(1),n.oc("ngIf","view"!=e.mode)}}function xe(e,t){if(1&e){const e=n.Sb();n.Pb(0),n.Rb(1,"button",50),n.fc("click",(function(){return n.Bc(e),n.hc(2).remove()})),n.Vb(2,ue),n.Qb(),n.Ob()}if(2&e){const e=n.hc(2);n.xb(1),n.oc("disabled",e.record&&e.record.isnew())}}function Oe(e,t){if(1&e){const e=n.Sb();n.Rb(0,"button",51),n.fc("click",(function(){return n.Bc(e),n.hc(2).save()})),n.Vb(1,pe),n.Qb()}if(2&e){n.hc();const e=n.zc(3);n.oc("disabled",e.invalid)}}function ve(e,t){if(1&e&&(n.Kc(0,Q,4,2,"div",8),n.Rb(1,"div",9),n.Rb(2,"form",10,11),n.Kc(4,D,2,0,"ng-container",7),n.Kc(5,de,2,1,"ng-container",7),n.Qb(),n.Qb(),n.Rb(6,"div",12),n.Kc(7,be,2,5,"button",13),n.Kc(8,ye,3,2,"ng-container",7),n.Kc(9,xe,3,1,"ng-container",7),n.Kc(10,Oe,2,1,"button",14),n.Qb()),2&e){const e=n.hc();n.oc("ngIf",!e.hideBanner),n.xb(4),n.oc("ngIf",!e.record),n.xb(1),n.oc("ngIf",e.record),n.xb(2),n.oc("ngForOf",e.actions),n.xb(1),n.oc("ngIf",e.isDialog()),n.xb(1),n.oc("ngIf",e.showDelete&&"view"!=e.mode),n.xb(1),n.oc("ngIf","view"!=e.mode)}}function Re(e,t){1&e&&n.Nb(0)}function ke(e,t){if(1&e&&(n.Pb(0),n.Kc(1,Re,1,0,"ng-container",52),n.Ob()),2&e){n.hc();const e=n.zc(12);n.xb(1),n.oc("ngTemplateOutlet",e)}}fe=$localize`:␟f4e529ae5ffd73001d1ff4bbdeeb0a72e342e5c8␟7819314041543176992:Close`,he=$localize`:␟d7b35c384aecd25a516200d6921836374613dfe7␟2159130950882492111:Cancel`,ue=$localize`:␟826b25211922a1b46436589233cb6f1a163d89b7␟7022070615528435141:Delete`,pe=$localize`:␟52c9a103b812f258bcddc3d90a6e3f46871d25fe␟3768927257183755959:Save`;let Ie=(()=>{class e extends a.a{constructor(e,t,i,c,o,l){super(e),this.modal=e,this.idl=t,this.auth=i,this.toast=c,this.format=o,this.pcrud=l,this.timezone=this.format.wsOrgTimezone,this.fieldOptions={},this.hiddenFieldsList=[],this.readonlyFieldsList=[],this.requiredFieldsList=[],this.datetimeFieldsList=[],this.orgDefaultAllowedList=[],this.displayMode="dialog",this.recordSaved=new n.n,this.recordDeleted=new n.n,this.recordCanceled=new n.n,this.recordError=new n.n,this.pkeyIsEditable=!1,this.mode="create",this._recordId=null,this._record=null,this.actions=[]}set recordId(e){e?e!==this._recordId&&(this._recordId=e,this._record=null,this.handleRecordChange()):this._recordId=null}get recordId(){return this._recordId}set record(e){e?this.idl.pkeyMatches(this.record,e)||(this._record=e,this._recordId=null,this.handleRecordChange()):this._record=null}get record(){return this._record}ngOnInit(){this.fieldOptions||(this.fieldOptions={}),this.listifyInputs(),this.idlDef=this.idl.classes[this.idlClass],this.recordLabel=this.idlDef.label,this.idPrefix="fm-editor-"+Math.floor(1e5*Math.random()),this.isDialog()?this.onOpen$.subscribe(()=>this.initRecord()):this.initRecord(),this.initDone=!0}handleRecordChange(){this.initDone&&!this.isDialog()&&this.initRecord()}open(e){return e||(e={}),e.beforeDismiss=()=>(this.record=void 0,!0),super.open(e)}isDialog(){return"dialog"===this.displayMode}isDirty(){return!!this.fmEditForm&&this.fmEditForm.dirty}setRecord(e){console.warn('fm-editor:setRecord() is deprecated. Use editor.record = abc or [record]="abc" instead'),this.record=e}listifyInputs(){this.hiddenFields&&(this.hiddenFieldsList=this.hiddenFields.split(/,/)),this.readonlyFields&&(this.readonlyFieldsList=this.readonlyFields.split(/,/)),this.requiredFields&&(this.requiredFieldsList=this.requiredFields.split(/,/)),this.datetimeFields&&(this.datetimeFieldsList=this.datetimeFields.split(/,/)),this.orgDefaultAllowed&&(this.orgDefaultAllowedList=this.orgDefaultAllowed.split(/,/))}initRecord(){const e=this.idlDef.permacrud||{};if(this.modePerms={view:e.retrieve?e.retrieve.perms:[],create:e.create?e.create.perms:[],update:e.update?e.update.perms:[]},this.pkeyIsEditable=!("pkey_sequence"in this.idlDef),"update"===this.mode||"view"===this.mode){let e;if(this.record&&null===this.recordId)e=Promise.resolve(this.record);else{if(!this.recordId)return Promise.resolve();e=this.pcrud.retrieve(this.idlClass,this.recordId).toPromise()}return e.then(e=>e?(this._record=e,this.convertDatatypesToJs(),this.getFieldList()):Promise.reject(`No '${this.idlClass}'\n                        record found with id ${this.recordId}`))}return this.record||(this._record=this.defaultNewRecord?this.idl.clone(this.defaultNewRecord):this.idl.create(this.idlClass)),this._recordId=null,this.getFieldList()}convertDatatypesToJs(){this.idlDef.fields.forEach(e=>{"bool"===e.datatype&&("t"===this.record[e.name]()?this.record[e.name](!0):"f"===this.record[e.name]()&&this.record[e.name](!1))})}convertDatatypesToIdl(e){this.idlDef.fields.filter(e=>!e.virtual).forEach(t=>{if("bool"===t.datatype)!0===e[t.name]()?e[t.name]("t"):e[t.name]("f");else if("org_unit"===t.datatype){const i=e[t.name]();i&&"object"==typeof i&&e[t.name](i.id())}})}flattenLinkedValues(e,t){const i=e.class,n=this.idl.classes[i].pkey,c=(this.fieldOptions[e.name]||{}).linkedSearchField||this.idl.getClassSelector(i)||n;return t.map(e=>{if(void 0!==e)return{id:e[n](),label:e[c]()}})}getFieldList(){const e=this.idlDef.fields.filter(e=>!e.virtual&&!this.hiddenFieldsList.includes(e.name));return Promise.all(e.map(e=>this.constructOneField(e))).then(()=>{if(!this.fieldOrder)return void(this.fields=e.sort((e,t)=>e.label<t.label?-1:1));let t=[];const i=this.fieldOrder.split(/,/);i.forEach(i=>{const n=e.filter(e=>e.name===i)[0];n&&t.push(n)});const n=e.filter(e=>!i.includes(e.name));n.sort((e,t)=>e.label<t.label?-1:1),t=t.concat(n),this.fields=t})}constructOneField(e){let t=null;const i=this.fieldOptions[e.name]||{};if(e.readOnly="view"===this.mode||(i.isReadonlyOverride?!i.isReadonlyOverride(e.name,this.record):!0===i.isReadonly||this.readonlyFieldsList.includes(e.name)),e.isRequired=i.isRequiredOverride?()=>i.isRequiredOverride(e.name,this.record):()=>e.required||i.isRequired||this.requiredFieldsList.includes(e.name),i.customValues)e.linkedValues=i.customValues;else if("link"===e.datatype&&e.readOnly){const n=this.record[e.name]();if(n){const c=i.linkedSearchField||this.idl.getClassSelector(e.class);c&&c!==e.name?t=this.pcrud.retrieve(e.class,n).toPromise().then(t=>{e.linkedValues=this.flattenLinkedValues(e,Array(t))}):e.linkedValues=[{id:n,name:n}]}}else"link"===e.datatype?t=this.wireUpCombobox(e):"timestamp"===e.datatype?e.datetime=this.datetimeFieldsList.includes(e.name):"org_unit"===e.datatype&&(e.orgDefaultAllowed=this.orgDefaultAllowedList.includes(e.name));return i.customTemplate&&(e.template=i.customTemplate.template,e.context=i.customTemplate.context),i.helpText&&(e.helpText=i.helpText,e.helpText.current().then(t=>e.helpTextValue=t)),t||Promise.resolve()}wireUpCombobox(e){const t=this.fieldOptions[e.name]||{};this.preloadLinkedValues&&("preloadLinkedValues"in t||(t.preloadLinkedValues=!0));const i=t.linkedSearchField||this.idl.getClassSelector(e.class);if(i||t.preloadLinkedValues||console.warn(`Class ${e.class} has no selector.\n                Pre-fetching all rows for combobox`),t.preloadLinkedValues||!i)return this.pcrud.retrieveAll(e.class,{},{atomic:!0}).toPromise().then(t=>{e.linkedValues=this.flattenLinkedValues(e,t)});e.linkedValuesSource=t=>{const n={},c={order_by:{}};return n[i]={ilike:`%${t}%`},c.order_by[e.class]=i,this.pcrud.search(e.class,n,c).pipe(Object(o.a)(t=>this.flattenLinkedValues(e,[t])[0]))};const n=this.record[e.name]();return null!=n?this.pcrud.retrieve(e.class,n).toPromise().then(t=>{e.linkedValues=this.flattenLinkedValues(e,Array(t))}):Promise.resolve()}customTemplateFieldContext(e){return Object.assign({record:this.record,field:e},e.context||{})}save(){const e=this.idl.clone(this.record);this.preSave&&this.preSave(this.mode,e),this.convertDatatypesToIdl(e),this.pcrud[this.mode]([e]).toPromise().then(e=>{this.recordSaved.emit(e),this.fmEditForm&&this.fmEditForm.form.markAsPristine(),this.successStr.current().then(e=>this.toast.success(e)),this.isDialog()&&(this.record=void 0,this.close(e))},e=>{this.recordError.emit(e),this.failStr.current().then(e=>this.toast.warning(e)),this.isDialog()&&!this.remainOpenOnError&&this.error(e)})}remove(){this.confirmDel.open().subscribe(e=>{if(!e)return;const t=this.idl.clone(this.record);this.pcrud.remove(t).toPromise().then(e=>{this.recordDeleted.emit(e),this.successStr.current().then(e=>this.toast.success(e)),this.isDialog()&&this.close(e)},e=>{this.recordError.emit(e),this.failStr.current().then(e=>this.toast.warning(e)),this.isDialog()&&!this.remainOpenOnError&&this.error(e)})})}cancel(){this.recordCanceled.emit(this.record),this.record=void 0,this.close()}closeEditor(){this.record=void 0,this.close()}inputType(e){return e.template?"template":"timestamp"===e.datatype&&e.datetime?"timestamp-timepicker":"timestamp"===e.datatype||"org_unit"===e.datatype||"bool"===e.datatype?e.datatype:e.readOnly?"money"===e.datatype?"readonly-money":"link"===e.datatype&&"au"===e.class?"readonly-au":"link"===e.datatype||e.linkedValues?"readonly-list":"readonly":"id"!==e.datatype||this.pkeyIsEditable?"int"===e.datatype||"float"===e.datatype||"money"===e.datatype?e.datatype:"link"===e.datatype||e.linkedValues?"list":"text":"readonly"}openTranslator(e){this.translator.fieldName=e,this.translator.idlObject=this.record,this.translator.open().subscribe(t=>{t&&this.record[e](t)})}}return e.\u0275fac=function(t){return new(t||e)(n.Lb(u.s),n.Lb(c.a),n.Lb(l.a),n.Lb(s.a),n.Lb(b.a),n.Lb(r.a))},e.\u0275cmp=n.Fb({type:e,selectors:[["eg-fm-record-editor"]],viewQuery:function(e,t){var i;1&e&&(n.Ic(k,!0),n.Ic(I,!0),n.Ic(w,!0),n.Ic(L,!0),n.Sc(S,!0)),2&e&&(n.yc(i=n.gc())&&(t.translator=i.first),n.yc(i=n.gc())&&(t.successStr=i.first),n.yc(i=n.gc())&&(t.failStr=i.first),n.yc(i=n.gc())&&(t.confirmDel=i.first),n.yc(i=n.gc())&&(t.fmEditForm=i.first))},inputs:{idlClass:"idlClass",fieldOptions:"fieldOptions",defaultNewRecord:"defaultNewRecord",hiddenFieldsList:"hiddenFieldsList",hiddenFields:"hiddenFields",readonlyFieldsList:"readonlyFieldsList",readonlyFields:"readonlyFields",requiredFieldsList:"requiredFieldsList",requiredFields:"requiredFields",datetimeFieldsList:"datetimeFieldsList",datetimeFields:"datetimeFields",orgDefaultAllowedList:"orgDefaultAllowedList",orgDefaultAllowed:"orgDefaultAllowed",recordLabel:"recordLabel",preloadLinkedValues:"preloadLinkedValues",displayMode:"displayMode",hideBanner:"hideBanner",remainOpenOnError:"remainOpenOnError",mode:"mode",preSave:"preSave",recordId:"recordId",record:"record",fieldOrder:"fieldOrder",showDelete:"showDelete"},outputs:{recordSaved:"recordSaved",recordDeleted:"recordDeleted",recordCanceled:"recordCanceled",recordError:"recordError"},features:[n.ub],decls:14,vars:2,consts:[["translator",""],[6,"text"],["successStr",""],["failStr",""],[6,"dialogTitle","dialogBody"],["confirmDel",""],["dialogContent",""],[4,"ngIf"],["class","modal-header bg-info",4,"ngIf"],[1,"modal-body"],["role","form",1,"form-validated","common-form","striped-odd"],["fmEditForm","ngForm"],[1,"modal-footer"],["type","button",3,"class","disabled","click",4,"ngFor","ngForOf"],["type","button","class","btn btn-info",3,"disabled","click",4,"ngIf"],[1,"modal-header","bg-info"],[1,"modal-title"],["type","button",1,"close",3,"click",6,"aria-label"],["aria-hidden","true"],["class","form-group row",4,"ngFor","ngForOf"],[1,"form-group","row"],[1,"col-lg-3"],[3,"for"],[3,"placement","helpText",4,"ngIf"],[1,"col-lg-9"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","col-lg-1",4,"ngIf"],[3,"placement","helpText"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"domId","readOnly","initialIso","onChangeAsIso"],[3,"showTZ","timezone","domId","readOnly","initialIso","onChangeAsIso"],[3,"domId","limitPerms","readOnly","applyDefault","applyOrgId","onChange",6,"placeholder"],["type","number","step","0.1",1,"form-control",3,"name","id","readonly","required","ngModel","ngModelChange",6,"placeholder"],["type","number",1,"form-control",3,"name","id","required","ngModel","ngModelChange",6,"placeholder"],["type","number","step","0.1",1,"form-control",3,"name","id","required","ngModel","ngModelChange",6,"placeholder"],["type","text",1,"form-control",3,"id","name","required","ngModel","ngModelChange",6,"placeholder"],["type","checkbox",1,"form-check-input",3,"name","id","disabled","ngModel","ngModelChange"],["target","_blank",3,"href"],[1,"material-icons",6,"title"],[3,"id","name","required","entries","asyncDataSource","selectedId","onChange",6,"placeholder"],[1,"col-lg-1"],[3,"click",6,"title"],[1,"btn","btn-outline-info","mat-icon-in-button"],[1,"material-icons"],["type","button",3,"disabled","click"],["type","button","class","btn btn-success",3,"click",4,"ngIf"],["type","button","class","btn btn-warning ml-2",3,"click",4,"ngIf"],["type","button",1,"btn","btn-success",3,"click"],["type","button",1,"btn","btn-warning","ml-2",3,"click"],["type","button",1,"btn","btn-warning",3,"disabled","click"],["type","button",1,"btn","btn-info",3,"disabled","click"],[4,"ngTemplateOutlet"]],template:function(e,t){1&e&&(n.Mb(0,"eg-translate",null,0),n.Rb(2,"eg-string",1,2),n.Xb(4,C),n.Qb(),n.Rb(5,"eg-string",1,3),n.Xb(7,$),n.Qb(),n.Rb(8,"eg-confirm-dialog",4,5),n.Xb(10,F),n.Qb(),n.Kc(11,ve,11,7,"ng-template",null,6,n.Lc),n.Kc(13,ke,2,1,"ng-container",7)),2&e&&(n.xb(8),n.Zb(t.recordLabel),n.Wb(10),n.xb(5),n.oc("ngIf",!t.isDialog()))},directives:[f.a,d.a,h.a,p.v,m.J,m.u,m.v,p.u,g.a,p.z,p.A,y.a,p.C,x.a,O.a,v.a,m.z,m.c,m.E,m.t,m.w,m.a,R.a],pipes:[p.d],styles:['input[type="checkbox"][_ngcontent-%COMP%] {margin-left: 0px;}']}),e})()},oCNH:function(e,t,i){"use strict";i.d(t,"a",(function(){return $}));var n,c=i("wBwE"),o=i("YRS1"),l=i("A9LY"),r=i("8PDw"),a=i("iA0r"),s=i("rRT/"),d=i("fXoL"),b=i("1kSV"),f=i("ofXK"),h=i("3Pt+");n=$localize`:␟e7404d7f6493de9fb61a0f427a4e99deac5c6429␟3880981592087246043: ${"\ufffd0\ufffd"}:INTERPOLATION: `;const u=["aria-label",$localize`:␟f4e529ae5ffd73001d1ff4bbdeeb0a72e342e5c8␟7819314041543176992:Close`];var p,m,g,y,x,O;p=$localize`:␟c2d0ac9f528bbd5f53fd34269fde8b59e029621b␟4391289919356861627:Apply`,m=$localize`:␟d7b35c384aecd25a516200d6921836374613dfe7␟2159130950882492111:Cancel`,g=$localize`:␟87b5a4b1c81f74c0937d7ee1f9714d6fe67270ec␟1301244316831267771:Field Name`,y=$localize`:␟d7c560dbef136b3d3c2ea5704465e851468bb478␟3486823319169991405:Current Value`,x=$localize`:␟18670d6d5fc8c5452c1b8f1b6dff87fa14fb44ad␟8591080221781472156:Select Locale`,O=$localize`:␟def41e21488e39dc665a7d4f2324cb06705d09e6␟6870893562392932905:Translation`;const v=["placeholder",$localize`:␟6a6eec3bcda3f746bb63b4d0b1957598524c574f␟4295587384096251683:Translation...`];function R(e,t){if(1&e&&(d.Rb(0,"option",18),d.Mc(1),d.Qb()),2&e){const e=t.$implicit;d.pc("value",e.code()),d.xb(1),d.Oc(" ",e.name()," ")}}function k(e,t){if(1&e){const e=d.Sb();d.Rb(0,"div",11),d.Rb(1,"div",12),d.Rb(2,"label",13),d.Vb(3,g),d.Qb(),d.Mb(4,"input",14),d.Qb(),d.Rb(5,"div",12),d.Rb(6,"label",13),d.Vb(7,y),d.Qb(),d.Mb(8,"input",14),d.Qb(),d.Rb(9,"div",12),d.Rb(10,"label",13),d.Vb(11,x),d.Qb(),d.Rb(12,"select",15),d.fc("change",(function(t){return d.Bc(e),d.hc(2).localeChanged(t)}))("ngModelChange",(function(t){return d.Bc(e),d.hc(2).selectedLocale=t})),d.Kc(13,R,2,2,"option",16),d.Qb(),d.Qb(),d.Rb(14,"div",12),d.Rb(15,"label",13),d.Vb(16,O),d.Qb(),d.Rb(17,"input",17),d.Xb(18,v),d.fc("keyup.enter",(function(){return d.Bc(e),d.hc(2).translate()}))("ngModelChange",(function(t){return d.Bc(e),d.hc(2).translatedValue=t})),d.Qb(),d.Qb(),d.Qb()}if(2&e){const e=d.hc(2);d.xb(4),d.pc("value",e.idlClassDef.field_map[e.field].label),d.oc("disabled",!0),d.xb(4),d.pc("value",e.idlObj[e.field]()),d.oc("disabled",!0),d.xb(4),d.oc("ngModel",e.selectedLocale),d.xb(1),d.oc("ngForOf",e.locales),d.xb(4),d.oc("ngModel",e.translatedValue)}}var I,w;function L(e,t){if(1&e){const e=d.Sb();d.Rb(0,"button",9),d.fc("click",(function(){return d.Bc(e),d.hc(2).prevString()})),d.Vb(1,I),d.Qb()}}function S(e,t){if(1&e){const e=d.Sb();d.Rb(0,"button",19),d.fc("click",(function(){return d.Bc(e),d.hc(2).nextString()})),d.Vb(1,w),d.Qb()}}function C(e,t){if(1&e){const e=d.Sb();d.Rb(0,"div",1),d.Rb(1,"h4",2),d.Vb(2,n),d.Qb(),d.Rb(3,"button",3),d.Xb(4,u),d.fc("click",(function(){return d.Bc(e),d.hc().close()})),d.Rb(5,"span",4),d.Mc(6,"\xd7"),d.Qb(),d.Qb(),d.Qb(),d.Kc(7,k,19,7,"div",5),d.Rb(8,"div",6),d.Kc(9,L,2,0,"button",7),d.Kc(10,S,2,0,"button",8),d.Rb(11,"button",9),d.fc("click",(function(){return d.Bc(e),d.hc().translate()})),d.Vb(12,p),d.Qb(),d.Rb(13,"button",10),d.fc("click",(function(){return d.Bc(e),d.hc().close()})),d.Vb(14,m),d.Qb(),d.Qb()}if(2&e){const e=d.hc();d.xb(2),d.Zb(e.idlClassDef.label),d.Wb(2),d.xb(5),d.oc("ngIf",e.idlObj),d.xb(2),d.oc("ngIf",e.prevString),d.xb(1),d.oc("ngIf",e.nextString)}}I=$localize`:␟1d9758dbdcd86c054fa553f0f9ac7b9080013f35␟346828805070618953:Prev String`,w=$localize`:␟3d9b6270d3dadd974741f5fec63bc3cfe7fc883f␟1076462705547011441:Next String`;let $=(()=>{class e extends s.a{constructor(e,t,i,n,c,o,l){super(e),this.modal=e,this.renderer=t,this.idl=i,this.toast=n,this.locale=c,this.pcrud=o,this.auth=l}set idlObject(e){e&&(this.idlObj=e,this.idlClassDef=this.idl.classes[e.classname],this.fetchTranslation())}set fieldName(e){this.field=e}ngOnInit(){this.selectedLocale=this.locale.currentLocaleCode(),this.locales=[],this.locale.supportedLocales().subscribe(e=>this.locales.push(e)),this.onOpen$.subscribe(()=>{const e=this.renderer.selectRootElement("#translation-input");e&&(e.focus(),e.select())})}localeChanged(e){this.fetchTranslation()}fetchTranslation(){const e=this.existingTranslation;e&&e.fq_field()===this.fqField()&&e.identity_value()===this.identValue()||(this.translatedValue="",this.existingTranslation=null,this.pcrud.search("i18n",{translation:this.selectedLocale,fq_field:this.fqField(),identity_value:this.identValue()}).subscribe(e=>{this.existingTranslation=e,this.translatedValue=e.string(),console.debug("found existing translation ",e)}))}fqField(){return this.idlClassDef.classname+"."+this.field}identValue(){return this.idlObj[this.idlClassDef.pkey||"id"]()}translate(){if(!this.translatedValue)return;let e;if(this.existingTranslation)return e=this.existingTranslation,e.string(this.translatedValue),void this.pcrud.update(e).toPromise().then(e=>{this.nextString||this.close(this.translatedValue)},e=>console.error(e));e=this.idl.create("i18n"),e.fq_field(this.fqField()),e.identity_value(this.identValue()),e.translation(this.selectedLocale),e.string(this.translatedValue),this.pcrud.create(e).toPromise().then(e=>{this.nextString||this.close(this.translatedValue)},e=>console.error("Translation creation failed"))}}return e.\u0275fac=function(t){return new(t||e)(d.Lb(b.s),d.Lb(d.D),d.Lb(c.a),d.Lb(o.a),d.Lb(l.a),d.Lb(a.a),d.Lb(r.a))},e.\u0275cmp=d.Fb({type:e,selectors:[["eg-translate"]],inputs:{idlObject:"idlObject",fieldName:"fieldName"},features:[d.ub],decls:2,vars:0,consts:[["dialogContent",""],[1,"modal-header","bg-info"],[1,"modal-title"],["type","button",1,"close",3,"click",6,"aria-label"],["aria-hidden","true"],["class","modal-body form-common form-validated",4,"ngIf"],[1,"modal-footer"],["class","btn btn-info",3,"click",4,"ngIf"],["class","btn btn-info mr-3",3,"click",4,"ngIf"],[1,"btn","btn-info",3,"click"],[1,"btn","btn-warning","ml-2",3,"click"],[1,"modal-body","form-common","form-validated"],[1,"form-group","row"],[1,"col-lg-4","text-right","font-weight-bold"],["type","text",1,"form-control","col-lg-7",3,"disabled","value"],[1,"form-control","col-lg-7",3,"ngModel","change","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["id","translation-input","type","text","required","",1,"form-control","col-lg-7",3,"ngModel","keyup.enter","ngModelChange",6,"placeholder"],[3,"value"],[1,"btn","btn-info","mr-3",3,"click"]],template:function(e,t){1&e&&d.Kc(0,C,15,4,"ng-template",null,0,d.Lc)},directives:[f.v,h.F,h.t,h.w,f.u,h.c,h.E,h.y,h.I],encapsulation:2}),e})()},zF8d:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("VEwP"),c=i("MZHd"),o=i("r2N+"),l=i("9RLy"),r=i("EBEo"),a=i("fXoL");let s=(()=>{class e{}return e.\u0275mod=a.Jb({type:e}),e.\u0275inj=a.Ib({factory:function(t){return new(t||e)},providers:[],imports:[[n.a,c.a,l.a,r.a,o.a]]}),e})()}}]);