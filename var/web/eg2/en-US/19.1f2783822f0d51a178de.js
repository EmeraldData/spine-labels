(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"5LKR":function(e,t,c){"use strict";c.r(t),c.d(t,"VandelayModule",(function(){return Ka}));var i=c("zF8d"),o=c("MZHd"),a=c("MhCk"),r=c("tk/3"),n=c("tNs6"),s=c("9eSZ"),b=c("tyNb"),l=c("IzEk"),d=c("HDdC"),u=c("vkgz"),f=c("Iab2"),h=c("wBwE"),p=c("cm5s"),m=c("Osig"),g=c("8PDw"),v=c("iA0r"),R=c("wN9v"),y=c("EQDH"),Q=c("fXoL");class S{constructor(){this.recordIds=[],this.overlayMap={}}}let T=(()=>{class e{constructor(e,t,c,i,o,a,r,n){this.http=e,this.idl=t,this.org=c,this.evt=i,this.net=o,this.auth=a,this.pcrud=r,this.perm=n,this.attrDefs={},this.allQueues={},this.matchSets={},this.importSelection=null,this.queuePageOffset=0}getAttrDefs(e){if(this.attrDefs[e])return Promise.resolve(this.attrDefs[e]);const t="bib"===e?"vqbrad":"vqarad",c={};return c[t]="id",this.pcrud.retrieveAll(t,{order_by:c},{atomic:!0}).toPromise().then(t=>(this.attrDefs[e]=t,t))}getMergeProfiles(){if(this.mergeProfiles)return Promise.resolve(this.mergeProfiles);const e=this.org.ancestors(this.auth.user().ws_ou(),!0);return this.pcrud.search("vmp",{owner:e},{order_by:{vmp:["name"]}},{atomic:!0}).toPromise().then(e=>(this.mergeProfiles=e,e))}getAllQueues(e){return this.allQueues[e]?Promise.resolve(this.allQueues[e]):(this.allQueues[e]=[],this.net.request("open-ils.vandelay",`open-ils.vandelay.${e}_queue.owner.retrieve`,this.auth.token()).pipe(Object(u.a)(t=>this.allQueues[e].push(t))).toPromise().then(()=>this.allQueues[e]))}getBibSources(){return this.bibSources?Promise.resolve(this.bibSources):this.pcrud.retrieveAll("cbs",{order_by:{cbs:"id"}},{atomic:!0}).toPromise().then(e=>(this.bibSources=e,e))}getItemImportDefs(){if(this.importItemAttrDefs)return Promise.resolve(this.importItemAttrDefs);const e=this.org.ancestors(this.auth.user().ws_ou(),!0);return this.pcrud.search("viiad",{owner:e},{},{atomic:!0}).toPromise().then(e=>(this.importItemAttrDefs=e,e))}getMatchSets(e){const t=e.match(/bib/)?"biblio":"authority";if(this.matchSets[e])return Promise.resolve(this.matchSets[e]);this.matchSets[e]=[];const c=this.org.ancestors(this.auth.user().ws_ou(),!0);return this.pcrud.search("vms",{owner:c,mtype:t},{},{atomic:!0}).toPromise().then(t=>(this.matchSets[e]=t,t))}getBibBuckets(){return this.bibBuckets?Promise.resolve(this.bibBuckets):this.net.request("open-ils.actor","open-ils.actor.container.retrieve_by_class",this.auth.token(),this.auth.user().id(),"biblio","staff_client").toPromise().then(e=>(this.bibBuckets=e,e))}getCopyStatuses(){return this.copyStatuses?Promise.resolve(this.copyStatuses):this.pcrud.retrieveAll("ccs",{},{atomic:!0}).toPromise().then(e=>(this.copyStatuses=e,e))}getBibTrashGroups(){if(this.bibTrashGroups)return Promise.resolve(this.bibTrashGroups);const e=this.org.ancestors(this.auth.user().ws_ou(),!0);return this.pcrud.search("vibtg",{always_apply:"f",owner:e},{vibtg:["label"]},{atomic:!0}).toPromise().then(e=>(this.bibTrashGroups=e,e))}createQueue(e,t,c,i,o){const a=`open-ils.vandelay.${t}_queue.create`;let r=t;return t.match(/bib_acq/)&&(r="acq"),new Promise((t,n)=>{this.net.request("open-ils.vandelay",a,this.auth.token(),e,null,r,i,c,o).subscribe(e=>{const c=this.evt.parse(e);c?n(c):(this.allQueues[r].push(e),t(e.id()))})})}getQueuedRecords(e,t,c,i){const o=t.match(/bib/)?"bib":"auth";let a=`open-ils.vandelay.${o}_queue.records.retrieve`;return i&&(a=`open-ils.vandelay.${o}_queue.records.matches.retrieve`),this.net.request("open-ils.vandelay",a,this.auth.token(),e,c)}exportQueue(e,t){let c=`/exporter?type=${e.queue_type().match(/auth/)?"auth":"bib"}&queueid=${e.id()}`,i=e.name();t&&(c+="&nonimported=1",i+="_nonimported"),i+=".mrc",this.http.get(c,{responseType:"text"}).subscribe(e=>{Object(f.saveAs)(new Blob([e],{type:"application/octet-stream"}),i)},e=>{console.error(e)})}pollSessionTracker(e){return new d.a(t=>{this.getNextSessionTracker(e,t)})}getNextSessionTracker(e,t){this.pcrud.retrieve("vst",e).subscribe(c=>{c&&"active"===c.state()?(t.next(c),setTimeout(()=>this.getNextSessionTracker(e,t),2e3)):(console.debug(`Vandelay session tracker ${e} is ${c.state()}`),t.complete())})}}return e.\u0275fac=function(t){return new(t||e)(Q.cc(r.a),Q.cc(h.a),Q.cc(p.a),Q.cc(y.a),Q.cc(m.b),Q.cc(g.a),Q.cc(v.a),Q.cc(R.a))},e.\u0275prov=Q.Hb({token:e,factory:e.\u0275fac}),e})();var I=c("ufrD"),x=c("ofXK");const M=["bannerText",$localize`:␟a475ff384053ff7a32ae2967b82ac5981c6573fb␟7127631923545498385:MARC Batch Import/Export`];var _,w,q,k,$,C,P,O;_=$localize`:␟5f19586aba912ec6eb123ec5ab609a3bcc073066␟7462301153729425254:Export`,w=$localize`:␟a059709f71aa4c0ac219e160e78a738682ca6a36␟1071721880474488785:Import`,q=$localize`:␟33c9f745939b0d86d03498fd2d2f4dd6e0c205c1␟6258392308436869469:Inspect Queue`,k=$localize`:␟2860115a1e6d819d62c0719e9a8c9bce73276aea␟6016919302319054660:Record Display Attributes`,$=$localize`:␟8d9c33d1a9ae8d49fe1bc1a42b7bea14c4284e46␟6133176751816119376:Merge / Overlay Profiles`,C=$localize`:␟711e33e56ad2a7cf4eb9565a9a886bc63c9d4923␟7429507876509930103:Record Match Sets`,P=$localize`:␟505a75115d8db9b7d542987a9ee2b62c0f29bae5␟4484002883341717770:Holdings Import Profiles`,O=$localize`:␟801b13b6c9c1aca459bfdbde4eebae98294f26d0␟4094264464599909023:Recent Imports`;const z=function(e){return{active:e}};let L=(()=>{class e{constructor(e,t,c){this.router=e,this.route=t,this.vandelay=c,this.router.events.subscribe(e=>{e instanceof b.b&&this.route.firstChild.url.pipe(Object(l.a)(1)).subscribe(e=>this.tab=e[0].path)})}ngOnInit(){}ngAfterViewInit(){}}return e.\u0275fac=function(t){return new(t||e)(Q.Lb(b.c),Q.Lb(b.a),Q.Lb(T))},e.\u0275cmp=Q.Fb({type:e,selectors:[["ng-component"]],decls:28,vars:24,consts:[[6,"bannerText"],[1,"nav","nav-pills","nav-fill","pb-4"],[1,"nav-item"],["routerLink","/staff/cat/vandelay/export",1,"nav-link",3,"ngClass"],["routerLink","/staff/cat/vandelay/import",1,"nav-link",3,"ngClass"],["routerLink","/staff/cat/vandelay/queue",1,"nav-link",3,"ngClass"],["routerLink","/staff/cat/vandelay/display_attrs/bib",1,"nav-link",3,"ngClass"],["routerLink","/staff/cat/vandelay/merge_profiles",1,"nav-link",3,"ngClass"],["routerLink","/staff/cat/vandelay/match_sets",1,"nav-link",3,"ngClass"],["routerLink","/staff/cat/vandelay/holdings_profiles",1,"nav-link",3,"ngClass"],["routerLink","/staff/cat/vandelay/active_imports",1,"nav-link",3,"ngClass"]],template:function(e,t){1&e&&(Q.Rb(0,"eg-staff-banner",0),Q.Xb(1,M),Q.Qb(),Q.Rb(2,"ul",1),Q.Rb(3,"li",2),Q.Rb(4,"a",3),Q.Vb(5,_),Q.Qb(),Q.Qb(),Q.Rb(6,"li",2),Q.Rb(7,"a",4),Q.Vb(8,w),Q.Qb(),Q.Qb(),Q.Rb(9,"li",2),Q.Rb(10,"a",5),Q.Vb(11,q),Q.Qb(),Q.Qb(),Q.Rb(12,"li",2),Q.Rb(13,"a",6),Q.Vb(14,k),Q.Qb(),Q.Qb(),Q.Rb(15,"li",2),Q.Rb(16,"a",7),Q.Vb(17,$),Q.Qb(),Q.Qb(),Q.Rb(18,"li",2),Q.Rb(19,"a",8),Q.Vb(20,C),Q.Qb(),Q.Qb(),Q.Rb(21,"li",2),Q.Rb(22,"a",9),Q.Vb(23,P),Q.Qb(),Q.Qb(),Q.Rb(24,"li",2),Q.Rb(25,"a",10),Q.Vb(26,O),Q.Qb(),Q.Qb(),Q.Qb(),Q.Mb(27,"router-outlet")),2&e&&(Q.xb(4),Q.oc("ngClass",Q.uc(8,z,"export"==t.tab)),Q.xb(3),Q.oc("ngClass",Q.uc(10,z,"import"==t.tab)),Q.xb(3),Q.oc("ngClass",Q.uc(12,z,"queue"==t.tab)),Q.xb(3),Q.oc("ngClass",Q.uc(14,z,"display_attrs"==t.tab)),Q.xb(3),Q.oc("ngClass",Q.uc(16,z,"merge_profiles"==t.tab)),Q.xb(3),Q.oc("ngClass",Q.uc(18,z,"match_sets"==t.tab)),Q.xb(3),Q.oc("ngClass",Q.uc(20,z,"holdings_profiles"==t.tab)),Q.xb(3),Q.oc("ngClass",Q.uc(22,z,"active_imports"==t.tab)))},directives:[I.a,b.f,x.s,b.h],encapsulation:2}),e})();var A=c("YRS1"),E=c("9rfo"),N=c("TxlL"),V=c("/xpB"),B=c("OsfI"),D=c("ib0n"),K=c("3Pt+");const F=["fileSelector"],G=["uploadProgress"],X=["enqueueProgress"],U=["importProgress"],j=["formTemplateSelector"],H=["recordTypeSelector"],W=["bibSourceSelector"],Z=["matchSetSelector"],Y=["holdingsProfileSelector"],J=["mergeProfileSelector"],ee=["fallThruMergeProfileSelector"],te=["dupeQueueAlert"],ce=["dialogBody",$localize`:␟04eea7dffe349bd912b01307a237c29c761cbd37␟7104752350726805592:A queue with the requested name already exists.`];var ie,oe;ie=$localize`:␟6cfbddb49bd7a2f8bd958ce05df1cc7b12fc4671␟9132085355571475770:MARC File Upload`,oe=$localize`:␟55e228b9ec86fb3264ea602320b644d0a91887ec␟1330632113855375197:Apply/Create Form Template`;const ae=["placeholder",$localize`:␟da2c4b6ab0e0832236adf798bf75e682870a46d4␟4547870067621520299:Apply or Create Form Template...`];var re,ne,se,be;re=$localize`:␟ea5df22a71f3a6a8e5ea52920009813148812688␟929520182362570400:Save As New Template`,ne=$localize`:␟5dafaa3fd26f5f29769424b5d66901df1d65e528␟4751682848426835730:Mark Template as Default`,se=$localize`:␟ddf5a8a3268f51e0c1c483f97f1a6fcc3cf30340␟924243138802371969:Delete Template`,be=$localize`:␟22b4baa904a080d93fc448a598525f05416c3b2c␟4177485269724254591:Record Type`;const le=["placeholder",$localize`:␟93b36d2aa562a4bb0f9a886c70ec505b009d4b93␟98786726684338554:Record Type...`],de=["entryLabel",$localize`:␟2710225b69c049667d54bc702843eae5f0a02ec4␟8694819155917457551:Bibliographic Records`],ue=["entryLabel",$localize`:␟eec7f1a5a08478c5f0529db364b9e2322eef0265␟4110915884252778137:Authority Records`],fe=["entryLabel",$localize`:␟62e81d0e2533d2b36dfb06460b78e490ffa7636d␟3318020178988016163:Acquisitions Records`];var he;he=$localize`:␟ec4c78f1deec979a555fb836bb6da36a1fcbfe6c␟7430242638032305529:Select a Record Source`;const pe=["placeholder",$localize`:␟c974632f4886ef20b0adef0c5c5326462011c89c␟1429034438254494791:Record Source...`];var me;me=$localize`:␟9ca20dfcf722295c8de9d283dafba5af4e95e599␟694007245748166156:Select or Create a Queue`;const ge=["placeholder",$localize`:␟e91dcd7639df7d2963895fecf3d3675a9aa22ee7␟5630749362851202314:Select or Create a Queue...`];var ve;ve=$localize`:␟55988f10a143d787aa62b05ea442bf7ffb17266a␟3398635036125420199:Limit Matches to Bucket`;const Re=["placeholder",$localize`:␟441a393c148dd851bfe39cebf66c324a114447a2␟4995022551252324903:Buckets...`];var ye;ye=$localize`:␟2cd4359f3b7c155126c284ba48dc255988e45bb0␟8884235213206010922:Record Match Set`;const Qe=["placeholder",$localize`:␟cd7161d65ac964deaddf2b07942cf7b5844c4499␟1624733012442922386:Match Set...`];var Se,Te;Se=$localize`:␟5ee14c6ced6c3a4381d9eeff06e27053c19567fc␟496698161010466709:Import Non-Matching Records`,Te=$localize`:␟19844764ac0f032738d67ae0d686fd837185aeb2␟8141913488117669086:Holdings Import Profile`;const Ie=["placeholder",$localize`:␟eb3a1cf02e37cef3e74779e7ea560fc5e88f5bd3␟3777444077447238843:Holdings Import Profile...`];var xe,Me;xe=$localize`:␟f36d08526f6a04e3c99292516ba5edece4fecee4␟8893940836017220358:Merge On Exact Match (901c)`,Me=$localize`:␟0f191eedc47cd9590990a38f1baa6d7feb4cbbde␟4132378244234912215:Merge Profile`;const _e=["placeholder",$localize`:␟fed0681b6cadc6b259cff3ad129c47c0e30e2506␟6589050397899766986:Merge Profile...`];var we,qe;we=$localize`:␟cbe287c6a23d1cf76d1175860787bd785d60688f␟5512315529166472042:Merge On Single Match`,qe=$localize`:␟87021cf790496ab60cc86ce59352ba454acf94d1␟1451388557064086582: Insufficient Quality Fall-Through Profile `;const ke=["placeholder",$localize`:␟97b3c27eb3de63f296e5dc932fd939e6607f6c02␟6007088160714857137:Fall-Through Merge Profile...`];var $e,Ce,Pe,Oe;$e=$localize`:␟1f41debd8af960e07bb08ef216b2471b24e91a3d␟6033581449985318523:Merge On Best Match`,Ce=$localize`:␟8430ba1b3500596c4fa776f217a6c887af8f21d6␟135910617425680633: Best/Single Match Minimum Quality Ratio `,Pe=$localize`:␟d1b37bfb517e2e70649fb090302e3e6768158006␟1734658841086341891: Auto-overlay In-process Acquisitions Items `,Oe=$localize`:␟7d67c7bf43999512919ae2a86d62683327be9715␟6074056360409942623:Optional Session Name:`;const ze=["placeholder",$localize`:␟daa721d2d8be9b8af89b5df34a25f90f046cc908␟6713766618547544063:Session Name...`];var Le,Ae,Ee,Ne,Ve,Be,De,Ke,Fe,Ge,Xe,Ue,je,He;function We(e,t){if(1&e&&(Q.Rb(0,"div",68),Q.Rb(1,"button",69),Q.Rb(2,"span",70),Q.Mc(3,"arrow_back"),Q.Qb(),Q.Rb(4,"span"),Q.Vb(5,Fe),Q.Qb(),Q.Qb(),Q.Qb()),2&e){const e=Q.hc(2);Q.xb(1),Q.rc("routerLink","/staff/cat/vandelay/queue/",e.recordType,"/",e.selectedQueue.id,"")}}function Ze(e,t){if(1&e&&(Q.Rb(0,"div",66),Q.Kc(1,We,6,2,"div",67),Q.Qb()),2&e){const e=Q.hc();Q.xb(1),Q.oc("ngIf",e.selectedQueue)}}function Ye(e,t){1&e&&(Q.Rb(0,"div",5),Q.Rb(1,"span",72),Q.Vb(2,Ge),Q.Qb(),Q.Qb())}function Je(e,t){if(1&e&&(Q.Rb(0,"option",75),Q.Mc(1),Q.Qb()),2&e){const e=t.$implicit;Q.pc("value",e.id()),Q.xb(1),Q.Nc(e.label())}}function et(e,t){if(1&e){const e=Q.Sb();Q.Rb(0,"div",5),Q.Rb(1,"select",73),Q.fc("ngModelChange",(function(t){return Q.Bc(e),Q.hc(2).selectedTrashGroups=t})),Q.Kc(2,Je,2,2,"option",74),Q.Qb(),Q.Qb()}if(2&e){const e=Q.hc(2);Q.xb(1),Q.oc("ngModel",e.selectedTrashGroups),Q.xb(1),Q.oc("ngForOf",e.bibTrashGroups)}}function tt(e,t){if(1&e&&(Q.Pb(0),Q.Kc(1,Ye,3,0,"div",71),Q.Kc(2,et,3,2,"div",71),Q.Ob()),2&e){const e=Q.hc();Q.xb(1),Q.oc("ngIf",0==e.bibTrashGroups.length),Q.xb(1),Q.oc("ngIf",e.bibTrashGroups.length)}}function ct(e,t){if(1&e){const e=Q.Sb();Q.Rb(0,"div",4),Q.Rb(1,"div",5),Q.Rb(2,"label",76),Q.Vb(3,Xe),Q.Qb(),Q.Qb(),Q.Rb(4,"div",5),Q.Rb(5,"input",77,78),Q.fc("change",(function(t){return Q.Bc(e),Q.hc().fileSelected(t)})),Q.Qb(),Q.Qb(),Q.Qb()}}function it(e,t){if(1&e&&(Q.Rb(0,"span"),Q.Vb(1,je),Q.Qb()),2&e){const e=Q.hc(2);Q.xb(1),Q.Zb(e.importSelection().recordIds.length),Q.Wb(1)}}function ot(e,t){if(1&e&&(Q.Rb(0,"span"),Q.Vb(1,He),Q.Qb()),2&e){const e=Q.hc(2);Q.xb(1),Q.Zb(e.importSelection().queue.name()),Q.Wb(1)}}function at(e,t){if(1&e){const e=Q.Sb();Q.Rb(0,"div",4),Q.Rb(1,"div",5),Q.Rb(2,"label"),Q.Mc(3,"Import Selected"),Q.Qb(),Q.Qb(),Q.Rb(4,"div",5),Q.Kc(5,it,2,1,"span",55),Q.Kc(6,ot,2,1,"span",55),Q.Qb(),Q.Rb(7,"div",5),Q.Rb(8,"button",79),Q.fc("click",(function(){return Q.Bc(e),Q.hc().clearSelection()})),Q.Vb(9,Ue),Q.Qb(),Q.Qb(),Q.Qb()}if(2&e){const e=Q.hc();Q.xb(5),Q.oc("ngIf",!e.importSelection().importQueue),Q.xb(1),Q.oc("ngIf",e.importSelection().importQueue)}}Le=$localize`:␟0022bb3c7d99ffc118e1184ba4dd40dd7b2d53b6␟3792339000621505128: Auto-overlay On-order Cataloging Items `,Ae=$localize`:␟dd5cb2315071f7aaf1155b1a9f24d4a021e658c5␟5412071504233639596:Remove MARC Field Groups`,Ee=$localize`:␟0c2494c3e811905e97459537317ec63f8c457435␟945332359235727772: Use Org Unit Matching in Copy to Determine Best Match `,Ne=$localize`:␟4b3972c3e9485218508a95f7a4ce7758e3f09ced␟6932865105766151309:Upload`,Ve=$localize`:␟73cc119a0d129117105bd1e87687ba5a98689b10␟4146759437902554818:Upload Progress`,Be=$localize`:␟909af1752a47500aa976307e95d2c2bfd59e4731␟409647756283979918:Enqueue Progress`,De=$localize`:␟84131d82d1a93c0fddfae19e77a8c345f871147a␟4211111309632890253:Import Progress`,Ke=$localize`:␟bbc99ddf25c6183812693d3eaa0a28d64d86f332␟3391680224336643433:Go To Queue`,Fe=$localize`:␟374a4f9c3f483fa60dec4fba02f81b2c51743515␟2769384034706317195:Return to Queue`,Ge=$localize`:␟f4bcec0021afe0b9b85ff3ed058d45f395de786e␟7548907624430313932:No Groups Configured`,Xe=$localize`:␟ace1f1f15d8bc172c06eebeac5c3279525369ee5␟7494825093762139901:File to Upload:`,Ue=$localize`:␟acfb1c728023ed8e9641b9c960611790f9d51b9e␟6643491865635415566: Clear Selection `,je=$localize`:␟4dde76c5fab0c0e0f221339d93f6c8802f09b7cb␟3789568336896215449: Importing ${"\ufffd0\ufffd"}:INTERPOLATION: Record(s)`,He=$localize`:␟fc25dd296a7d9e841b76cc316a63c58ceaccd982␟8847263831331692548: Importing Queue ${"\ufffd0\ufffd"}:INTERPOLATION:`;const rt=["recordType","selectedBibSource","selectedMatchSet","mergeOnExact","importNonMatching","mergeOnBestMatch","mergeOnSingleMatch","autoOverlayAcqCopies","autoOverlayOnOrderCopies","autoOverlayOrgUnitCopies","selectedHoldingsProfile","selectedMergeProfile","selectedFallThruMergeProfile","selectedTrashGroups","minQualityRatio"];let nt=(()=>{class e{constructor(e,t,c,i,o,a,r,n){this.http=e,this.toast=t,this.evt=c,this.net=i,this.auth=o,this.org=a,this.store=r,this.vandelay=n,this.applyDefaults()}applyDefaults(){if(this.minQualityRatio=0,this.selectedBibSource=1,this.recordType="bib",this.bibTrashGroups=[],this.formTemplates={},this.vandelay.importSelection){if(!this.vandelay.importSelection.queue)return void(this.vandelay.importSelection=null);const e=this.vandelay.importSelection.queue;this.recordType=e.queue_type(),this.selectedMatchSet=e.match_set(),this.startQueueId=e.id(),"bib"===this.recordType&&(this.selectedBucket=e.match_bucket(),this.selectedHoldingsProfile=e.item_attr_def())}}ngOnInit(){}ngAfterViewInit(){this.loadStartupData()}ngOnDestroy(){this.clearSelection()}importSelection(){return this.vandelay.importSelection}loadStartupData(){const e=[this.vandelay.getMergeProfiles(),this.vandelay.getAllQueues("bib"),this.vandelay.getAllQueues("authority"),this.vandelay.getMatchSets("bib"),this.vandelay.getMatchSets("authority"),this.vandelay.getBibBuckets(),this.vandelay.getBibSources(),this.vandelay.getItemImportDefs(),this.vandelay.getBibTrashGroups().then(e=>this.bibTrashGroups=e),this.org.settings(["vandelay.default_match_set"]).then(e=>this.defaultMatchSet=e["vandelay.default_match_set"]),this.loadTemplates()];return Promise.all(e)}loadTemplates(){this.store.getItem("eg.cat.vandelay.import.templates").then(e=>{this.formTemplates=e||{},Object.keys(this.formTemplates).forEach(e=>{this.formTemplates[e].default&&(this.selectedTemplate=e)})})}formatTemplateEntries(){const e=[];return Object.keys(this.formTemplates||{}).forEach(t=>e.push({id:t,label:t})),e}formatEntries(e){const t=this.recordType;let c;switch(e){case"bibSources":return(this.vandelay.bibSources||[]).map(e=>({id:e.id(),label:e.source()}));case"bibBuckets":c=this.vandelay.bibBuckets;break;case"activeQueues":c=(this.vandelay.allQueues[t]||[]).filter(e=>"f"===e.complete());break;case"matchSets":c=this.vandelay.matchSets[t];break;case"importItemDefs":c=this.vandelay.importItemAttrDefs;break;case"mergeProfiles":c=this.vandelay.mergeProfiles}return(c||[]).map(e=>({id:e.id(),label:e.name()}))}selectEntry(e,t){const c=e?e.id:null;switch(t){case"recordType":this.recordType=c;break;case"bibSources":this.selectedBibSource=c;break;case"bibBuckets":this.selectedBucket=c;break;case"matchSets":this.selectedMatchSet=c;break;case"importItemDefs":this.selectedHoldingsProfile=c;break;case"mergeProfiles":this.selectedMergeProfile=c;break;case"FallThruMergeProfile":this.selectedFallThruMergeProfile=c}}fileSelected(e){this.selectedFile=e.target.files[0]}hasNeededData(){return this.vandelay.importSelection?this.importActionSelected():this.selectedQueue&&Boolean(this.recordType)&&Boolean(this.selectedFile)}importActionSelected(){return this.importNonMatching||this.mergeOnExact||this.mergeOnSingleMatch||this.mergeOnBestMatch}upload(){this.sessionKey=null,this.showProgress=!0,this.isUploading=!0,this.uploadComplete=!1,this.resetProgressBars(),this.resolveQueue().then(e=>(this.activeQueueId=e,this.uploadFile()),e=>Promise.reject("queue create failed")).then(e=>this.processSpool(),e=>Promise.reject("process spool failed")).then(e=>this.importRecords(),e=>Promise.reject("import records failed")).then(e=>{this.isUploading=!1,this.uploadComplete=!0},e=>{console.log("file upload failed: ",e),this.isUploading=!1,this.resetProgressBars()})}resetProgressBars(){this.uploadProgress.update({value:0,max:1}),this.enqueueProgress.update({value:0,max:1}),this.importProgress.update({value:0,max:1})}resolveQueue(){return this.selectedQueue.freetext?this.vandelay.createQueue(this.selectedQueue.label,this.recordType,this.selectedHoldingsProfile,this.selectedMatchSet,this.selectedBucket).then(e=>e,e=>{const t=this.evt.parse(e);return t&&(t.textcode.match(/QUEUE_EXISTS/)?this.dupeQueueAlert.open():alert(t)),Promise.reject("Queue Create Failed")}):Promise.resolve(this.selectedQueue.id)}uploadFile(){if(this.vandelay.importSelection)return Promise.resolve();const e=new FormData;e.append("ses",this.auth.token()),e.append("marc_upload",this.selectedFile,this.selectedFile.name),this.selectedBibSource&&e.append("bib_source",""+this.selectedBibSource);const t=new r.d("POST","/vandelay-upload",e,{reportProgress:!0,responseType:"text"});return this.http.request(t).pipe(Object(u.a)(e=>{e.type===r.c.UploadProgress?this.uploadProgress.update({value:e.loaded,max:e.total}):e instanceof r.e&&(this.sessionKey=e.body,console.log("Vandelay file uploaded OK with key "+this.sessionKey))},e=>{console.error(e),this.toast.danger(e.error)})).toPromise()}processSpool(){if(this.vandelay.importSelection)return Promise.resolve();let e=this.recordType;"authority"===this.recordType&&(e="auth");const t=`open-ils.vandelay.${e}.process_spool`;return new Promise((e,c)=>{this.net.request("open-ils.vandelay",t,this.auth.token(),this.sessionKey,this.activeQueueId,null,null,this.selectedBibSource,this.sessionName||null,!0).subscribe(t=>{const i=this.evt.parse(t);if(i)return console.error(i),c();this.vandelay.pollSessionTracker(t.id()).subscribe(e=>{this.enqueueProgress.update({max:null,value:e.actions_performed()})},e=>{console.log(e),c()},()=>{this.enqueueProgress.update({max:1,value:1}),e()})})})}importRecords(){if(!this.importActionSelected())return Promise.resolve();const e=this.vandelay.importSelection;return e&&!e.importQueue?this.importRecordQueue(e.recordIds):this.importRecordQueue()}importRecordQueue(e){const t="bib"===this.recordType?"bib":"auth";let c=`open-ils.vandelay.${t}_queue.import`;const i=this.compileImportOptions();let o=this.activeQueueId;return e&&e.length&&(c=`open-ils.vandelay.${t}_record.list.import`,o=e),new Promise((e,t)=>{this.net.request("open-ils.vandelay",c,this.auth.token(),o,i).subscribe(c=>{const i=this.evt.parse(c);if(i)return console.error(i),t();this.vandelay.pollSessionTracker(c.id()).subscribe(e=>{this.importProgress.update({max:e.total_actions(),value:e.actions_performed()})},e=>{console.log(e),t()},()=>{this.importProgress.update({max:1,value:1}),e()})})})}compileImportOptions(){const e={session_key:this.sessionKey,import_no_match:this.importNonMatching,auto_overlay_exact:this.mergeOnExact,auto_overlay_best_match:this.mergeOnBestMatch,auto_overlay_1match:this.mergeOnSingleMatch,opp_acq_copy_overlay:this.autoOverlayAcqCopies,opp_oo_cat_copy_overlay:this.autoOverlayOnOrderCopies,auto_overlay_org_unit_copies:this.autoOverlayOrgUnitCopies,merge_profile:this.selectedMergeProfile,fall_through_merge_profile:this.selectedFallThruMergeProfile,strip_field_groups:this.selectedTrashGroups,match_quality_ratio:this.minQualityRatio,exit_early:!0};return this.vandelay.importSelection&&(e.overlay_map=this.vandelay.importSelection.overlayMap),e}clearSelection(){this.vandelay.importSelection=null,this.startQueueId=null}openQueue(){console.log("opening queue "+this.activeQueueId)}saveTemplate(){const e={};return rt.forEach(t=>e[t]=this[t]),console.debug("Saving import profile",e),this.formTemplates[this.selectedTemplate]=e,this.store.setItem("eg.cat.vandelay.import.templates",this.formTemplates)}markTemplateDefault(){return Object.keys(this.formTemplates).forEach(e=>delete this.formTemplates.default),this.formTemplates[this.selectedTemplate].default=!0,this.store.setItem("eg.cat.vandelay.import.templates",this.formTemplates)}templateSelectorChange(e){if(!e)return void(this.selectedTemplate="");if(this.selectedTemplate=e.label,e.freetext)return;const t=this.formTemplates[e.id];rt.forEach(e=>this[e]=t[e]),this.recordTypeSelector.applyEntryId(this.recordType),this.bibSourceSelector.applyEntryId(this.selectedBibSource),this.matchSetSelector.applyEntryId(this.selectedMatchSet),this.holdingsProfileSelector.applyEntryId(this.selectedHoldingsProfile),this.mergeProfileSelector.applyEntryId(this.selectedMergeProfile),this.fallThruMergeProfileSelector.applyEntryId(this.selectedFallThruMergeProfile)}deleteTemplate(){return delete this.formTemplates[this.selectedTemplate],this.formTemplateSelector.selected=null,this.store.setItem("eg.cat.vandelay.import.templates",this.formTemplates)}}return e.\u0275fac=function(t){return new(t||e)(Q.Lb(r.a),Q.Lb(A.a),Q.Lb(y.a),Q.Lb(m.b),Q.Lb(g.a),Q.Lb(p.a),Q.Lb(B.a),Q.Lb(T))},e.\u0275cmp=Q.Fb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var c;1&e&&(Q.Sc(F,!0),Q.Ic(G,!0),Q.Ic(X,!0),Q.Ic(U,!0),Q.Ic(j,!0),Q.Ic(H,!0),Q.Ic(W,!0),Q.Ic(Z,!0),Q.Ic(Y,!0),Q.Ic(J,!0),Q.Ic(ee,!0),Q.Ic(te,!0)),2&e&&(Q.yc(c=Q.gc())&&(t.fileSelector=c.first),Q.yc(c=Q.gc())&&(t.uploadProgress=c.first),Q.yc(c=Q.gc())&&(t.enqueueProgress=c.first),Q.yc(c=Q.gc())&&(t.importProgress=c.first),Q.yc(c=Q.gc())&&(t.formTemplateSelector=c.first),Q.yc(c=Q.gc())&&(t.recordTypeSelector=c.first),Q.yc(c=Q.gc())&&(t.bibSourceSelector=c.first),Q.yc(c=Q.gc())&&(t.matchSetSelector=c.first),Q.yc(c=Q.gc())&&(t.holdingsProfileSelector=c.first),Q.yc(c=Q.gc())&&(t.mergeProfileSelector=c.first),Q.yc(c=Q.gc())&&(t.fallThruMergeProfileSelector=c.first),Q.yc(c=Q.gc())&&(t.dupeQueueAlert=c.first))},decls:172,vars:52,consts:[["class","row mb-3",4,"ngIf"],[6,"dialogBody"],["dupeQueueAlert",""],[1,"common-form","striped-odd","form-validated","ml-3","mr-3"],[1,"row"],[1,"col-lg-3"],["for","template-select"],["id","template-select",3,"allowFreeText","startId","startIdFiresOnChange","entries","onChange",6,"placeholder"],["formTemplateSelector",""],[1,"col-lg-6"],[1,"btn","btn-success",3,"disabled","click"],[1,"btn","btn-outline-primary","ml-3",3,"disabled","click"],[1,"btn","btn-danger","ml-3",3,"disabled","click"],["for","type-select"],["id","type-select",3,"disabled","required","startId","onChange",6,"placeholder"],["recordTypeSelector",""],["entryId","bib",6,"entryLabel"],["entryId","authority",6,"entryLabel"],["entryId","bib-acq",6,"entryLabel"],["for","source-select"],["id","source-select",3,"entries","startId","onChange",6,"placeholder"],["bibSourceSelector",""],["for","queue-select"],["id","queue-select",3,"entries","startId","startIdFiresOnChange","disabled","required","allowFreeText","onChange",6,"placeholder"],["for","bucket-select"],["id","bucket-select",3,"entries","startId","disabled","onChange",6,"placeholder"],["for","match-set-select"],["id","match-set-select",3,"entries","disabled","startId","onChange",6,"placeholder"],["matchSetSelector",""],["for","import-non-matching"],["type","checkbox","id","import-non-matching",1,"form-check-input",3,"ngModel","ngModelChange"],["for","item-import-def"],["id","item-import-def",3,"entries","startId","disabled","onChange",6,"placeholder"],["holdingsProfileSelector",""],["for","merge-on-exact"],["type","checkbox","id","merge-on-exact",1,"form-check-input",3,"ngModel","ngModelChange"],["for","merge-profiles"],["id","merge-profiles",3,"entries","onChange",6,"placeholder"],["mergeProfileSelector",""],["for","merge-on-single"],["type","checkbox","id","merge-on-single",1,"form-check-input",3,"ngModel","ngModelChange"],["for","insuff-merge-profiles"],["id","insuff-merge-profiles",3,"entries","onChange",6,"placeholder"],["fallThruMergeProfileSelector",""],["for","merge-on-best"],["type","checkbox","id","merge-on-best",1,"form-check-input",3,"ngModel","ngModelChange"],["for","min-quality-ratio"],["type","number","step","0.1","id","min-quality-ratio",1,"form-control",3,"ngModel","ngModelChange"],["for","auto-overlay-acq-copies"],["type","checkbox","id","auto-overlay-acq-copies",1,"form-check-input",3,"disabled","ngModel","ngModelChange"],["for","session-name"],["type","text","name","session-name",1,"form-control",3,"ngModel","ngModelChange",6,"placeholder"],["for","auto-overlay-on-order-copies"],["type","checkbox","id","auto-overlay-on-order-copies",1,"form-check-input",3,"disabled","ngModel","ngModelChange"],["for","marc-remove-groups"],[4,"ngIf"],["for","auto-overlay-org-unit-copies"],["type","checkbox","id","auto-overlay-org-unit-copies",1,"form-check-input",3,"disabled","ngModel","ngModelChange"],["class","row",4,"ngIf"],[1,"col-lg-6","offset-lg-3"],[1,"btn","btn-success","btn-lg","btn-block","font-weight-bold",3,"disabled","click"],[1,"row",3,"hidden"],["uploadProgress",""],["enqueueProgress",""],["importProgress",""],[1,"btn","btn-info","btn-lg","btn-block","font-weight-bold",3,"routerLink"],[1,"row","mb-3"],["class","col-lg-2",4,"ngIf"],[1,"col-lg-2"],[1,"btn","btn-info","label-with-material-icon",3,"routerLink"],[1,"material-icons"],["class","col-lg-3",4,"ngIf"],[1,"font-italic"],["multiple","","id","marc-remove-groups","size","3",1,"form-control",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["for","upload-file"],["id","upload-file","required","","type","file",1,"form-control",3,"change"],["fileSelector",""],[1,"btn","btn-outline-info","ml-2",3,"click"]],template:function(e,t){1&e&&(Q.Kc(0,Ze,2,1,"div",0),Q.Rb(1,"eg-alert-dialog",1,2),Q.Xb(3,ce),Q.Qb(),Q.Rb(4,"h2"),Q.Vb(5,ie),Q.Qb(),Q.Rb(6,"div",3),Q.Rb(7,"div",4),Q.Rb(8,"div",5),Q.Rb(9,"label",6),Q.Vb(10,oe),Q.Qb(),Q.Qb(),Q.Rb(11,"div",5),Q.Rb(12,"eg-combobox",7,8),Q.Xb(14,ae),Q.fc("onChange",(function(e){return t.templateSelectorChange(e)})),Q.Qb(),Q.Qb(),Q.Rb(15,"div",9),Q.Rb(16,"button",10),Q.fc("click",(function(){return t.saveTemplate()})),Q.Vb(17,re),Q.Qb(),Q.Rb(18,"button",11),Q.fc("click",(function(){return t.markTemplateDefault()})),Q.Vb(19,ne),Q.Qb(),Q.Rb(20,"button",12),Q.fc("click",(function(){return t.deleteTemplate()})),Q.Vb(21,se),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(22,"div",4),Q.Rb(23,"div",5),Q.Rb(24,"label",13),Q.Vb(25,be),Q.Qb(),Q.Qb(),Q.Rb(26,"div",5),Q.Rb(27,"eg-combobox",14,15),Q.Xb(29,le),Q.fc("onChange",(function(e){return t.selectEntry(e,"recordType")})),Q.Rb(30,"eg-combobox-entry",16),Q.Xb(31,de),Q.Qb(),Q.Rb(32,"eg-combobox-entry",17),Q.Xb(33,ue),Q.Qb(),Q.Rb(34,"eg-combobox-entry",18),Q.Xb(35,fe),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(36,"div",5),Q.Rb(37,"label",19),Q.Vb(38,he),Q.Qb(),Q.Qb(),Q.Rb(39,"div",5),Q.Rb(40,"eg-combobox",20,21),Q.Xb(42,pe),Q.fc("onChange",(function(e){return t.selectEntry(e,"bibSources")})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(43,"div",4),Q.Rb(44,"div",5),Q.Rb(45,"label",22),Q.Vb(46,me),Q.Qb(),Q.Qb(),Q.Rb(47,"div",5),Q.Rb(48,"eg-combobox",23),Q.Xb(49,ge),Q.fc("onChange",(function(e){return t.selectedQueue=e})),Q.Qb(),Q.Qb(),Q.Rb(50,"div",5),Q.Rb(51,"label",24),Q.Vb(52,ve),Q.Qb(),Q.Qb(),Q.Rb(53,"div",5),Q.Rb(54,"eg-combobox",25),Q.Xb(55,Re),Q.fc("onChange",(function(e){return t.selectEntry(e,"bibBuckets")})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(56,"div",4),Q.Rb(57,"div",5),Q.Rb(58,"label",26),Q.Vb(59,ye),Q.Qb(),Q.Qb(),Q.Rb(60,"div",5),Q.Rb(61,"eg-combobox",27,28),Q.Xb(63,Qe),Q.fc("onChange",(function(e){return t.selectEntry(e,"matchSets")})),Q.Qb(),Q.Qb(),Q.Rb(64,"div",5),Q.Rb(65,"label",29),Q.Vb(66,Se),Q.Qb(),Q.Qb(),Q.Rb(67,"div",5),Q.Rb(68,"input",30),Q.fc("ngModelChange",(function(e){return t.importNonMatching=e})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(69,"div",4),Q.Rb(70,"div",5),Q.Rb(71,"label",31),Q.Vb(72,Te),Q.Qb(),Q.Qb(),Q.Rb(73,"div",5),Q.Rb(74,"eg-combobox",32,33),Q.Xb(76,Ie),Q.fc("onChange",(function(e){return t.selectEntry(e,"importItemDefs")})),Q.Qb(),Q.Qb(),Q.Rb(77,"div",5),Q.Rb(78,"label",34),Q.Vb(79,xe),Q.Qb(),Q.Qb(),Q.Rb(80,"div",5),Q.Rb(81,"input",35),Q.fc("ngModelChange",(function(e){return t.mergeOnExact=e})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(82,"div",4),Q.Rb(83,"div",5),Q.Rb(84,"label",36),Q.Vb(85,Me),Q.Qb(),Q.Qb(),Q.Rb(86,"div",5),Q.Rb(87,"eg-combobox",37,38),Q.Xb(89,_e),Q.fc("onChange",(function(e){return t.selectEntry(e,"mergeProfiles")})),Q.Qb(),Q.Qb(),Q.Rb(90,"div",5),Q.Rb(91,"label",39),Q.Vb(92,we),Q.Qb(),Q.Qb(),Q.Rb(93,"div",5),Q.Rb(94,"input",40),Q.fc("ngModelChange",(function(e){return t.mergeOnSingleMatch=e})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(95,"div",4),Q.Rb(96,"div",5),Q.Rb(97,"label",41),Q.Vb(98,qe),Q.Qb(),Q.Qb(),Q.Rb(99,"div",5),Q.Rb(100,"eg-combobox",42,43),Q.Xb(102,ke),Q.fc("onChange",(function(e){return t.selectEntry(e,"FallThruMergeProfile")})),Q.Qb(),Q.Qb(),Q.Rb(103,"div",5),Q.Rb(104,"label",44),Q.Vb(105,$e),Q.Qb(),Q.Qb(),Q.Rb(106,"div",5),Q.Rb(107,"input",45),Q.fc("ngModelChange",(function(e){return t.mergeOnBestMatch=e})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(108,"div",4),Q.Rb(109,"div",5),Q.Rb(110,"label",46),Q.Vb(111,Ce),Q.Qb(),Q.Qb(),Q.Rb(112,"div",5),Q.Rb(113,"input",47),Q.fc("ngModelChange",(function(e){return t.minQualityRatio=e})),Q.Qb(),Q.Qb(),Q.Rb(114,"div",5),Q.Rb(115,"label",48),Q.Vb(116,Pe),Q.Qb(),Q.Qb(),Q.Rb(117,"div",5),Q.Rb(118,"input",49),Q.fc("ngModelChange",(function(e){return t.autoOverlayAcqCopies=e})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(119,"div",4),Q.Rb(120,"div",5),Q.Rb(121,"label",50),Q.Vb(122,Oe),Q.Qb(),Q.Qb(),Q.Rb(123,"div",5),Q.Rb(124,"input",51),Q.Xb(125,ze),Q.fc("ngModelChange",(function(e){return t.sessionName=e})),Q.Qb(),Q.Qb(),Q.Rb(126,"div",5),Q.Rb(127,"label",52),Q.Vb(128,Le),Q.Qb(),Q.Qb(),Q.Rb(129,"div",5),Q.Rb(130,"input",53),Q.fc("ngModelChange",(function(e){return t.autoOverlayOnOrderCopies=e})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(131,"div",4),Q.Rb(132,"div",5),Q.Rb(133,"label",54),Q.Vb(134,Ae),Q.Qb(),Q.Qb(),Q.Kc(135,tt,3,2,"ng-container",55),Q.Rb(136,"div",5),Q.Rb(137,"label",56),Q.Vb(138,Ee),Q.Qb(),Q.Qb(),Q.Rb(139,"div",5),Q.Rb(140,"input",57),Q.fc("ngModelChange",(function(e){return t.autoOverlayOrgUnitCopies=e})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Kc(141,ct,7,0,"div",58),Q.Kc(142,at,10,2,"div",58),Q.Rb(143,"div",4),Q.Rb(144,"div",59),Q.Rb(145,"button",60),Q.fc("click",(function(){return t.upload()})),Q.Vb(146,Ne),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(147,"div",61),Q.Rb(148,"div",5),Q.Rb(149,"label"),Q.Vb(150,Ve),Q.Qb(),Q.Qb(),Q.Rb(151,"div",9),Q.Mb(152,"eg-progress-inline",null,62),Q.Qb(),Q.Qb(),Q.Rb(154,"div",61),Q.Rb(155,"div",5),Q.Rb(156,"label"),Q.Vb(157,Be),Q.Qb(),Q.Qb(),Q.Rb(158,"div",9),Q.Mb(159,"eg-progress-inline",null,63),Q.Qb(),Q.Qb(),Q.Rb(161,"div",61),Q.Rb(162,"div",5),Q.Rb(163,"label"),Q.Vb(164,De),Q.Qb(),Q.Qb(),Q.Rb(165,"div",9),Q.Mb(166,"eg-progress-inline",null,64),Q.Qb(),Q.Qb(),Q.Rb(168,"div",61),Q.Rb(169,"div",59),Q.Rb(170,"button",65),Q.Vb(171,Ke),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb()),2&e&&(Q.oc("ngIf",t.importSelection()),Q.xb(12),Q.oc("allowFreeText",!0)("startId",t.selectedTemplate)("startIdFiresOnChange",!0)("entries",t.formatTemplateEntries()),Q.xb(4),Q.oc("disabled",!t.selectedTemplate),Q.xb(2),Q.oc("disabled",!t.selectedTemplate),Q.xb(2),Q.oc("disabled",!t.selectedTemplate),Q.xb(7),Q.oc("disabled",t.importSelection())("required",!0)("startId",t.recordType),Q.xb(13),Q.oc("entries",t.formatEntries("bibSources"))("startId",t.selectedBibSource),Q.xb(8),Q.oc("entries",t.formatEntries("activeQueues"))("startId",t.startQueueId)("startIdFiresOnChange",!0)("disabled",t.startQueueId)("required",!0)("allowFreeText",!0),Q.xb(6),Q.oc("entries",t.formatEntries("bibBuckets"))("startId",t.selectedBucket)("disabled",t.selectedQueue&&!t.selectedQueue.freetext||t.importSelection()),Q.xb(7),Q.oc("entries",t.formatEntries("matchSets"))("disabled",t.selectedQueue&&!t.selectedQueue.freetext||t.importSelection())("startId",t.selectedMatchSet||t.defaultMatchSet),Q.xb(7),Q.oc("ngModel",t.importNonMatching),Q.xb(6),Q.oc("entries",t.formatEntries("importItemDefs"))("startId",t.selectedHoldingsProfile)("disabled",t.selectedQueue&&!t.selectedQueue.freetext||t.importSelection()),Q.xb(7),Q.oc("ngModel",t.mergeOnExact),Q.xb(6),Q.oc("entries",t.formatEntries("mergeProfiles")),Q.xb(7),Q.oc("ngModel",t.mergeOnSingleMatch),Q.xb(6),Q.oc("entries",t.formatEntries("mergeProfiles")),Q.xb(7),Q.oc("ngModel",t.mergeOnBestMatch),Q.xb(6),Q.oc("ngModel",t.minQualityRatio),Q.xb(5),Q.oc("disabled","authority"==t.recordType)("ngModel",t.autoOverlayAcqCopies),Q.xb(6),Q.oc("ngModel",t.sessionName),Q.xb(6),Q.oc("disabled","authority"==t.recordType)("ngModel",t.autoOverlayOnOrderCopies),Q.xb(5),Q.oc("ngIf","authority"!=t.recordType),Q.xb(5),Q.oc("disabled","authority"==t.recordType)("ngModel",t.autoOverlayOrgUnitCopies),Q.xb(1),Q.oc("ngIf",!t.importSelection()),Q.xb(1),Q.oc("ngIf",t.importSelection()),Q.xb(3),Q.oc("disabled",t.isUploading||!t.hasNeededData()),Q.xb(2),Q.oc("hidden",!t.showProgress||t.importSelection()),Q.xb(7),Q.oc("hidden",!t.showProgress||t.importSelection()),Q.xb(7),Q.oc("hidden",!t.showProgress),Q.xb(7),Q.oc("hidden",!t.uploadComplete),Q.xb(2),Q.rc("routerLink","/staff/cat/vandelay/queue/",t.recordType,"/",t.activeQueueId,""))},directives:[x.v,V.a,E.a,D.a,K.a,K.t,K.w,K.z,K.c,N.a,b.d,K.G,x.u,K.y,K.I],encapsulation:2}),e})();var st=c("LMfH"),bt=c("1kSV");const lt=["fileSelector"],dt=["exportProgress"];var ut,ft,ht,pt,mt,gt,vt,Rt,yt,Qt,St,Tt,It,xt,Mt,_t,wt;function qt(e,t){if(1&e&&(Q.Pb(0),Q.Rb(1,"div",24),Q.Vb(2,Mt),Q.Qb(),Q.Rb(3,"div"),Q.Rb(4,"a",25),Q.Rb(5,"button",26),Q.Vb(6,_t),Q.Qb(),Q.Qb(),Q.Qb(),Q.Ob()),2&e){const e=Q.hc();Q.xb(2),Q.Zb(e.basketRecords.length),Q.Wb(2)}}ut=$localize`:␟18e97c3234dba787368bc7ed79a573971764ed32␟480925552307435874:Export Records`,ft=$localize`:␟22b4baa904a080d93fc448a598525f05416c3b2c␟4177485269724254591:Record Type`,ht=$localize`:␟2710225b69c049667d54bc702843eae5f0a02ec4␟8694819155917457551:Bibliographic Records`,pt=$localize`:␟eec7f1a5a08478c5f0529db364b9e2322eef0265␟4110915884252778137:Authority Records`,mt=$localize`:␟7887bd1706414ade07cb814bc172ef5bd1298dbe␟5208361607635352078:Record Format`,gt=$localize`:␟ddd9040c27b8ef54b8a18f1abe14f02d269447e3␟3689387874991556338:MARC21`,vt=$localize`:␟414ba7c1623505e87f1f0455558a9a9c11a63ba6␟5235713269145497020:UNIMARC`,Rt=$localize`:␟220712b38f87abea1f28cd841ffa8ef7eb421b86␟8374741519465656622:MARC XML`,yt=$localize`:␟f240e1a240b808daf83e3e3a47290cd28527e47f␟7347864158996474413:Evergreen Record Entry`,Qt=$localize`:␟20cf5d84f3244e9b23df92208d563f3668f4fdfa␟1612906545020933349:Record Encoding`,St=$localize`:␟33f4217a212e489ad71a466dd7a6c6f5b6cbcdb4␟6217331796106505872:UTF-8`,Tt=$localize`:␟3dcf08ecfe735fbbba5f094a30304f0823dd2a74␟2714907034084985818:MARC8`,It=$localize`:␟24e5322133e0b45f1d9b8ab5ea62effa83e8ac04␟8599522739582396846: Include holdings in Bibliographic Records `,xt=$localize`:␟5f19586aba912ec6eb123ec5ab609a3bcc073066␟7462301153729425254:Export`,Mt=$localize`:␟78e221ddceb0dbbfb7287a701a66d1972dfbd41c␟3640148217939834121: Exporting ${"\ufffd0\ufffd"}:INTERPOLATION: Records from Catalog Basket. `,_t=$localize`:␟9de94c031ab7c4426dddc70f5be1992a0f964e78␟421774935510939502:Return to Catalog`,wt=$localize`:␟407edd36343f64319b4f907969fd7af43336a326␟4238405499150954755:Use Field Number`;const kt=["placeholder",$localize`:␟f63731317a0ddeeee7ba35efc3000455ba7cf18e␟5219633489091459178:Starts at 0...`];var $t,Ct,Pt;function Ot(e,t){if(1&e){const e=Q.Sb();Q.Rb(0,"div",1),Q.Rb(1,"div",2),Q.Rb(2,"label",32),Q.Vb(3,wt),Q.Qb(),Q.Qb(),Q.Rb(4,"div",2),Q.Rb(5,"input",33),Q.Xb(6,kt),Q.fc("ngModelChange",(function(t){return Q.Bc(e),Q.hc(2).fieldNumber=t})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(7,"div",1),Q.Rb(8,"div",2),Q.Rb(9,"label",34),Q.Vb(10,$t),Q.Qb(),Q.Qb(),Q.Rb(11,"div",2),Q.Rb(12,"input",35,36),Q.fc("change",(function(t){return Q.Bc(e),Q.hc(2).fileSelected(t)})),Q.Qb(),Q.Qb(),Q.Qb()}if(2&e){const e=Q.hc(2);Q.xb(5),Q.oc("ngModel",e.fieldNumber)}}function zt(e,t){if(1&e){const e=Q.Sb();Q.Rb(0,"div",1),Q.Rb(1,"div",2),Q.Rb(2,"label",37),Q.Vb(3,Ct),Q.Qb(),Q.Qb(),Q.Rb(4,"div",2),Q.Rb(5,"input",38),Q.fc("ngModelChange",(function(t){return Q.Bc(e),Q.hc(2).recordId=t})),Q.Qb(),Q.Qb(),Q.Qb()}if(2&e){const e=Q.hc(2);Q.xb(5),Q.oc("ngModel",e.recordId)}}function Lt(e,t){if(1&e){const e=Q.Sb();Q.Rb(0,"div",1),Q.Rb(1,"div",2),Q.Rb(2,"label",39),Q.Vb(3,Pt),Q.Qb(),Q.Qb(),Q.Rb(4,"div",2),Q.Rb(5,"input",40),Q.fc("ngModelChange",(function(t){return Q.Bc(e),Q.hc(2).bucketId=t})),Q.Qb(),Q.Qb(),Q.Qb()}if(2&e){const e=Q.hc(2);Q.xb(5),Q.oc("ngModel",e.bucketId)}}function At(e,t){if(1&e){const e=Q.Sb();Q.Pb(0),Q.Rb(1,"div",1),Q.Rb(2,"label"),Q.Mc(3,"Select a Record Source"),Q.Qb(),Q.Qb(),Q.Rb(4,"ngb-accordion",27),Q.fc("panelChange",(function(t){return Q.Bc(e),Q.hc().sourceChange(t)})),Q.Rb(5,"ngb-panel",28),Q.Kc(6,Ot,14,1,"ng-template",29),Q.Qb(),Q.Rb(7,"ngb-panel",30),Q.Kc(8,zt,6,1,"ng-template",29),Q.Qb(),Q.Rb(9,"ngb-panel",31),Q.Kc(10,Lt,6,1,"ng-template",29),Q.Qb(),Q.Qb(),Q.Ob()}2&e&&(Q.xb(4),Q.oc("closeOthers",!0))}$t=$localize`:␟ed26a35faf03da76a7e2d4819a3fcbeb1ee8c2c7␟6463661030456875296:From CSV file`,Ct=$localize`:␟9d32401749378ad8eda12a3c49cfbbb70bb0dae4␟2486844773394769749:Record ID`,Pt=$localize`:␟45e0e280c78cb41a78807c84c9f05d2f919ca82b␟4925143400354152180:Bucket ID`;let Et=(()=>{class e{constructor(e,t,c,i,o,a){this.renderer=e,this.route=t,this.http=c,this.toast=i,this.auth=o,this.basket=a,this.recordSource="csv",this.recordType="biblio",this.recordFormat="USMARC",this.recordEncoding="UTF-8",this.includeHoldings=!1,this.basketRecords=[]}ngOnInit(){const e=this.route.snapshot.url.length;e>0&&"basket"===this.route.snapshot.url[e-1].path&&(this.exportingBasket=!0,this.basket.getRecordIds().then(e=>this.basketRecords=e))}ngAfterViewInit(){this.exportingBasket||this.renderer.selectRootElement("#csv-input").focus()}sourceChange(e){this.recordSource=e.panelId,this.exportingBasket||e.nextState&&setTimeout(()=>{this.renderer.selectRootElement(`#${this.recordSource}-input`).focus()})}fileSelected(e){this.selectedFile=e.target.files[0]}hasNeededData(){return Boolean(this.selectedFile||this.recordId||this.bucketId||this.exportingBasket&&this.basketRecords.length>0)}exportRecords(){this.isExporting=!0,this.exportProgress.update({value:0});const e=new FormData;if(e.append("ses",this.auth.token()),e.append("rectype",this.recordType),e.append("encoding",this.recordEncoding),e.append("format",this.recordFormat),this.includeHoldings&&e.append("holdings","1"),this.exportingBasket)this.basketRecords.forEach(t=>e.append("id",""+t));else switch(this.recordSource){case"csv":e.append("idcolumn",""+this.fieldNumber),e.append("idfile",this.selectedFile,this.selectedFile.name);break;case"record-id":e.append("id",""+this.recordId);break;case"bucket-id":e.append("containerid",""+this.bucketId)}this.sendExportRequest(e)}sendExportRequest(e){const t=`export.${this.recordType}.${this.recordEncoding}.${this.recordFormat}`,c=new r.d("POST","/exporter",e,{reportProgress:!0,responseType:"text"});this.http.request(c).subscribe(e=>{console.debug(e),e.type===r.c.DownloadProgress?this.exportProgress.update({value:e.loaded}):e instanceof r.e&&(Object(f.saveAs)(new Blob([e.body],{type:"application/octet-stream"}),t),this.isExporting=!1)},e=>{console.error(e),this.toast.danger(e.error),this.isExporting=!1})}}return e.\u0275fac=function(t){return new(t||e)(Q.Lb(Q.D),Q.Lb(b.a),Q.Lb(r.a),Q.Lb(A.a),Q.Lb(g.a),Q.Lb(st.a))},e.\u0275cmp=Q.Fb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var c;1&e&&(Q.Sc(lt,!0),Q.Ic(dt,!0)),2&e&&(Q.yc(c=Q.gc())&&(t.fileSelector=c.first),Q.yc(c=Q.gc())&&(t.exportProgress=c.first))},decls:56,vars:9,consts:[[1,"common-form","striped-even","form-validated"],[1,"row"],[1,"col-lg-6"],[4,"ngIf"],["for","record-type"],["id","record-type",1,"form-control",3,"disabled","ngModel","ngModelChange"],["value","biblio"],["value","authority"],["for","record-format"],["id","record-format",1,"form-control",3,"ngModel","ngModelChange"],["value","USMARC"],["value","UNIMARC"],["value","XML"],["value","BRE"],["for","record-encoding"],["id","record-encoding",1,"form-control",3,"ngModel","ngModelChange"],["value","UTF-8"],["value","MARC8"],["for","include-holdings"],["type","checkbox","id","include-holdings",1,"form-check-input",3,"ngModel","ngModelChange"],[1,"col-lg-10","offset-lg-1"],[1,"btn","btn-success","btn-lg","btn-block","font-weight-bold",3,"disabled","click"],[1,"row",3,"hidden"],["exportProgress",""],[1,"alert","alert-info"],["routerLink","/staff/catalog/search","queryParamsHandling","merge"],[1,"btn","btn-info"],["activeIds","csv",3,"closeOthers","panelChange"],["id","csv","title","CSV File"],["ngbPanelContent",""],["id","record-id","title","Record ID"],["id","bucket-id","title","Bucket"],["for","csv-input"],["id","csv-input","type","number",1,"form-control",3,"ngModel","ngModelChange",6,"placeholder"],["for","use-csv-file"],["id","use-csv-file","type","file",1,"form-control",3,"change"],["fileSelector",""],["for","record-id-input"],["id","record-id-input","type","number",1,"form-control",3,"ngModel","ngModelChange"],["for","bucket-id-input"],["id","bucket-id-input","type","number",1,"form-control",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(Q.Rb(0,"h2"),Q.Vb(1,ut),Q.Qb(),Q.Rb(2,"div",0),Q.Rb(3,"div",1),Q.Rb(4,"div",2),Q.Kc(5,qt,7,1,"ng-container",3),Q.Kc(6,At,11,1,"ng-container",3),Q.Qb(),Q.Rb(7,"div",2),Q.Rb(8,"div",1),Q.Rb(9,"div",2),Q.Rb(10,"label",4),Q.Vb(11,ft),Q.Qb(),Q.Qb(),Q.Rb(12,"div",2),Q.Rb(13,"select",5),Q.fc("ngModelChange",(function(e){return t.recordType=e})),Q.Rb(14,"option",6),Q.Vb(15,ht),Q.Qb(),Q.Rb(16,"option",7),Q.Vb(17,pt),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(18,"div",1),Q.Rb(19,"div",2),Q.Rb(20,"label",8),Q.Vb(21,mt),Q.Qb(),Q.Qb(),Q.Rb(22,"div",2),Q.Rb(23,"select",9),Q.fc("ngModelChange",(function(e){return t.recordFormat=e})),Q.Rb(24,"option",10),Q.Vb(25,gt),Q.Qb(),Q.Rb(26,"option",11),Q.Vb(27,vt),Q.Qb(),Q.Rb(28,"option",12),Q.Vb(29,Rt),Q.Qb(),Q.Rb(30,"option",13),Q.Vb(31,yt),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(32,"div",1),Q.Rb(33,"div",2),Q.Rb(34,"label",14),Q.Vb(35,Qt),Q.Qb(),Q.Qb(),Q.Rb(36,"div",2),Q.Rb(37,"select",15),Q.fc("ngModelChange",(function(e){return t.recordEncoding=e})),Q.Rb(38,"option",16),Q.Vb(39,St),Q.Qb(),Q.Rb(40,"option",17),Q.Vb(41,Tt),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(42,"div",1),Q.Rb(43,"div",2),Q.Rb(44,"label",18),Q.Vb(45,It),Q.Qb(),Q.Qb(),Q.Rb(46,"div",2),Q.Rb(47,"input",19),Q.fc("ngModelChange",(function(e){return t.includeHoldings=e})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(48,"div",1),Q.Rb(49,"div",20),Q.Rb(50,"button",21),Q.fc("click",(function(){return t.exportRecords()})),Q.Vb(51,xt),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(52,"div",22),Q.Rb(53,"div",20),Q.Mb(54,"eg-progress-inline",null,23),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb()),2&e&&(Q.xb(5),Q.oc("ngIf",t.exportingBasket),Q.xb(1),Q.oc("ngIf",!t.exportingBasket),Q.xb(7),Q.oc("disabled",t.exportingBasket)("ngModel",t.recordType),Q.xb(10),Q.oc("ngModel",t.recordFormat),Q.xb(14),Q.oc("ngModel",t.recordEncoding),Q.xb(10),Q.oc("ngModel",t.includeHoldings),Q.xb(3),Q.oc("disabled",t.isExporting||!t.hasNeededData()),Q.xb(2),Q.oc("hidden",!t.isExporting))},directives:[x.v,K.F,K.t,K.w,K.y,K.I,K.a,N.a,b.f,bt.a,bt.H,bt.I,K.z,K.c],encapsulation:2}),e})();var Nt=c("LRne"),Vt=c("9Zsr"),Bt=c("MWGh"),Dt=c("QGNW");const Kt=["bibQueueGrid"],Ft=["authQueueGrid"];var Gt,Xt;Gt=$localize`:␟2657bc443b72ee1d8a44fb1c1d22c61e94009f96␟4880675643394572320:Select a Queue To Inspect`,Xt=$localize`:␟d87d1141bb4941ebbd66659530aaa766cd3aeeeb␟5124352070970013794:Queue Type`;const Ut=["placeholder",$localize`:␟1fdac0d02e7679f643cd0d4ec63e8b6630c2f2be␟599085713224827484:Queue Type...`],jt=["entryLabel",$localize`:␟2710225b69c049667d54bc702843eae5f0a02ec4␟8694819155917457551:Bibliographic Records`],Ht=["entryLabel",$localize`:␟eec7f1a5a08478c5f0529db364b9e2322eef0265␟4110915884252778137:Authority Records`],Wt=["entryLabel",$localize`:␟62e81d0e2533d2b36dfb06460b78e490ffa7636d␟3318020178988016163:Acquisitions Records`],Zt=["label",$localize`:␟96e678d5f4bfe1a041ecfcd34804efa5e100d5e8␟5167284364083276913:Delete Selected`];function Yt(e,t){if(1&e){const e=Q.Sb();Q.Rb(0,"eg-grid",9,10),Q.fc("onRowActivate",(function(t){return Q.Bc(e),Q.hc().rowActivated(t)})),Q.Rb(2,"eg-grid-toolbar-action",11),Q.Xb(3,Zt),Q.Qb(),Q.Qb()}if(2&e){const e=Q.hc();Q.oc("dataSource",e.queueSource),Q.xb(2),Q.oc("action",e.deleteSelected)}}const Jt=["label",$localize`:␟96e678d5f4bfe1a041ecfcd34804efa5e100d5e8␟5167284364083276913:Delete Selected`];function ec(e,t){if(1&e){const e=Q.Sb();Q.Rb(0,"eg-grid",12,13),Q.fc("onRowActivate",(function(t){return Q.Bc(e),Q.hc().rowActivated(t)})),Q.Rb(2,"eg-grid-toolbar-action",11),Q.Xb(3,Jt),Q.Qb(),Q.Qb()}if(2&e){const e=Q.hc();Q.oc("dataSource",e.queueSource),Q.xb(2),Q.oc("action",e.deleteSelected)}}let tc=(()=>{class e{constructor(e,t,c,i,o){this.router=e,this.route=t,this.net=c,this.auth=i,this.vandelay=o,this.queueType="bib",this.queueSource=new Bt.c,this.vandelay.queuePageOffset=0,this.queueSource.getRows=e=>this.loadQueues(e),this.deleteSelected=e=>{const t=`open-ils.vandelay.${this.queueType}_queue.delete`,c=e.slice(0),i=e=>{const o=c[e];return o?this.net.request("open-ils.vandelay",t,this.auth.token(),o.id()).toPromise().then(()=>i(++e)):(this.currentGrid().reload(),Promise.resolve())};i(0)}}currentGrid(){return this.bibQueueGrid||this.authQueueGrid}rowActivated(e){const t=`/staff/cat/vandelay/queue/${this.queueType}/${e.id()}`;this.router.navigate([t])}queueTypeChanged(e){e.id!==this.queueType&&(this.queueType=e.id,this.queueSource.reset())}loadQueues(e){if(!this.queueType)return Object(Nt.a)();const t=this.queueType.match(/bib/)?"bib":"authority";return this.net.request("open-ils.vandelay",`open-ils.vandelay.${t}_queue.owner.retrieve`,this.auth.token(),null,null,{offset:e.offset,limit:e.limit})}}return e.\u0275fac=function(t){return new(t||e)(Q.Lb(b.c),Q.Lb(b.a),Q.Lb(m.b),Q.Lb(g.a),Q.Lb(T))},e.\u0275cmp=Q.Fb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var c;1&e&&(Q.Sc(Kt,!0),Q.Sc(Ft,!0)),2&e&&(Q.yc(c=Q.gc())&&(t.bibQueueGrid=c.first),Q.yc(c=Q.gc())&&(t.authQueueGrid=c.first))},decls:18,vars:3,consts:[[1,"import-form"],[1,"row","flex"],[1,"col-lg-3"],[3,"startId","onChange",6,"placeholder"],["entryId","bib",6,"entryLabel"],["entryId","auth",6,"entryLabel"],["entryId","bib-acq",6,"entryLabel"],["persistKey","cat.vandelay.queue.list.bib","idlClass","vbq",3,"dataSource","onRowActivate",4,"ngIf"],["persistKey","cat.vandelay.queue.list.auth","idlClass","vaq",3,"dataSource","onRowActivate",4,"ngIf"],["persistKey","cat.vandelay.queue.list.bib","idlClass","vbq",3,"dataSource","onRowActivate"],["bibQueueGrid",""],[3,"action",6,"label"],["persistKey","cat.vandelay.queue.list.auth","idlClass","vaq",3,"dataSource","onRowActivate"],["authQueueGrid",""]],template:function(e,t){1&e&&(Q.Rb(0,"div",0),Q.Rb(1,"h2"),Q.Vb(2,Gt),Q.Qb(),Q.Rb(3,"div",1),Q.Rb(4,"div"),Q.Rb(5,"label"),Q.Vb(6,Xt),Q.Qb(),Q.Qb(),Q.Rb(7,"div",2),Q.Rb(8,"eg-combobox",3),Q.Xb(9,Ut),Q.fc("onChange",(function(e){return t.queueTypeChanged(e)})),Q.Rb(10,"eg-combobox-entry",4),Q.Xb(11,jt),Q.Qb(),Q.Rb(12,"eg-combobox-entry",5),Q.Xb(13,Ht),Q.Qb(),Q.Rb(14,"eg-combobox-entry",6),Q.Xb(15,Wt),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Kc(16,Yt,4,2,"eg-grid",7),Q.Kc(17,ec,4,2,"eg-grid",8)),2&e&&(Q.xb(8),Q.oc("startId",t.queueType),Q.xb(8),Q.oc("ngIf","bib"==t.queueType),Q.xb(1),Q.oc("ngIf","auth"==t.queueType))},directives:[E.a,D.a,x.v,Vt.a,Dt.a],encapsulation:2}),e})();var cc=c("pLZG"),ic=c("lJxs"),oc=c("36iw"),ac=c("KBUj"),rc=c("gtj8"),nc=c("t7hH"),sc=c("1tmW");const bc=["queueGrid"],lc=["confirmDelDlg"],dc=["progressDlg"],uc=["dialogTitle",$localize`:␟29b400b6a289f96e2c12310dfa8c7d4c35842e92␟9020659224075678329:Deleting Queue...`],fc=["label",$localize`:␟0a78e9a8cf4bfcbb5775fbf8a0f296f2bc695f8c␟1882394482686151262:Records With Matches`],hc=["label",$localize`:␟eabb21a230e034647ac399d04c2ef6db4d3cbac3␟7525571605567175349:Non-Imported Records`],pc=["label",$localize`:␟503bb199bd83d69e3da48c3720235d0512776e77␟3630213385744665909:Records with Import Errors`],mc=["label",$localize`:␟01aa5508abb4473531a18c605c1c41ae4b6074d0␟1567940090040631427:Matches`],gc=["label",$localize`:␟73d3389b908a73c51282efb89ac1649b86773e72␟3178045094493611068:Import Errors`],vc=["label",$localize`:␟f87d40f29094711a544dc929c36062d47fdde257␟6508550799282505553:Import Date`],Rc=["label",$localize`:␟00dc66679846161b71803c568d7eb3c4fd37faab␟5545330649753964818:Imported As`],yc=["dialogTitle",$localize`:␟a6ecf76f074e2098ee024b6c2586a0475a2d6dd3␟6208564441860154239:Confirm Delete`,"dialogBody",$localize`:␟17409570cce2703a910c18367486465fa0e1e567␟428285900604048070:Delete Queue ${"\ufffd0\ufffd"}:INTERPOLATION:?`];var Qc,Sc,Tc,Ic,xc,Mc,_c,wc,qc,kc,$c,Cc,Pc,Oc,zc,Lc;function Ac(e,t){if(1&e){const e=Q.Sb();Q.Pb(0),Q.Rb(1,"eg-confirm-dialog",14,15),Q.Xb(3,yc),Q.Qb(),Q.Rb(4,"h2"),Q.Vb(5,Qc),Q.Qb(),Q.Rb(6,"div",16),Q.Rb(7,"div",17),Q.Rb(8,"div",18),Q.Rb(9,"h5",19),Q.Vb(10,Sc),Q.Qb(),Q.Rb(11,"ul",20),Q.Rb(12,"li",21),Q.Rb(13,"div",22),Q.Rb(14,"div",23),Q.Vb(15,Tc),Q.Qb(),Q.Rb(16,"div",24),Q.Mc(17),Q.Qb(),Q.Rb(18,"div",23),Q.Vb(19,Ic),Q.Qb(),Q.Rb(20,"div",24),Q.Mc(21),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(22,"li",21),Q.Rb(23,"div",22),Q.Rb(24,"div",23),Q.Vb(25,xc),Q.Qb(),Q.Rb(26,"div",24),Q.Mc(27),Q.Qb(),Q.Rb(28,"div",23),Q.Vb(29,Mc),Q.Qb(),Q.Rb(30,"div",24),Q.Mc(31),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(32,"li",21),Q.Rb(33,"div",22),Q.Rb(34,"div",23),Q.Vb(35,_c),Q.Qb(),Q.Rb(36,"div",24),Q.Mc(37),Q.Qb(),Q.Rb(38,"div",23),Q.Vb(39,wc),Q.Qb(),Q.Rb(40,"div",24),Q.Mc(41),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(42,"div",17),Q.Rb(43,"div",18),Q.Rb(44,"h5",19),Q.Vb(45,qc),Q.Qb(),Q.Rb(46,"ul",20),Q.Rb(47,"li",21),Q.Rb(48,"div",22),Q.Rb(49,"div",24),Q.Rb(50,"a",25),Q.fc("click",(function(){return Q.Bc(e),Q.hc().importSelected()})),Q.Vb(51,kc),Q.Qb(),Q.Qb(),Q.Rb(52,"div",24),Q.Rb(53,"a",25),Q.fc("click",(function(){return Q.Bc(e),Q.hc().importAll()})),Q.Vb(54,$c),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(55,"li",21),Q.Rb(56,"div",22),Q.Rb(57,"div",24),Q.Rb(58,"a",26),Q.Vb(59,Cc),Q.Qb(),Q.Qb(),Q.Rb(60,"div",24),Q.Rb(61,"a",25),Q.fc("click",(function(){return Q.Bc(e),Q.hc().exportNonImported()})),Q.Vb(62,Pc),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(63,"li",21),Q.Rb(64,"div",22),Q.Mb(65,"eg-bucket-dialog",27,28),Q.Rb(67,"div",24),Q.Rb(68,"a",25),Q.fc("click",(function(){return Q.Bc(e),Q.zc(66).open({size:"lg"})})),Q.Vb(69,Oc),Q.Qb(),Q.Qb(),Q.Rb(70,"div",24),Q.Rb(71,"a",25),Q.fc("click",(function(){return Q.Bc(e),Q.hc().deleteQueue()})),Q.Vb(72,zc),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Ob()}if(2&e){const e=Q.hc();Q.xb(1),Q.Zb(e.queueSummary.queue.name()),Q.Wb(3),Q.xb(4),Q.Zb(e.queueSummary.queue.name()),Q.Wb(5),Q.xb(12),Q.Nc(e.queueSummary.total),Q.xb(4),Q.Nc(e.queueSummary.total_items),Q.xb(6),Q.Nc(e.queueSummary.imported),Q.xb(4),Q.Nc(e.queueSummary.total_items_imported),Q.xb(6),Q.Nc(e.queueSummary.rec_import_errors),Q.xb(4),Q.Nc(e.queueSummary.item_import_errors),Q.xb(17),Q.rc("routerLink","/staff/cat/vandelay/queue/",e.queueType,"/",e.queueId,"/items"),Q.xb(7),Q.oc("fromBibQueue",e.queueId)}}Qc=$localize`:␟157a86fb2e0c5f02349edce8640879a8a140f4a7␟5608932092911404340:Queue ${"\ufffd0\ufffd"}:INTERPOLATION:`,Sc=$localize`:␟3ca3e4c0af43f86ebb2082cac33245ec9c9f8d4e␟2474002261461160761:Queue Summary`,Tc=$localize`:␟b7c34b1c232bc87b268521011cd651204223c979␟7531608978652511286:Records in Queue:`,Ic=$localize`:␟559edcbf0d86b98c9bc2c2e58ed7b5ea8c482da2␟2271727768080020920:Items in Queue:`,xc=$localize`:␟46f90585367d9b5396ae8516a1502c48beb5a49c␟5509308810295369192:Records Imported:`,Mc=$localize`:␟8a314e706bc1cfaecc140bfdea4727f4c987baee␟4241644089838175022:Items Imported:`,_c=$localize`:␟2ed64d9cca9f7e509920371d379e025c359942a6␟511384143060628012:Records Import Failures:`,wc=$localize`:␟9c66d77a95c5cf8d9c734679d0d8230292c9f7d5␟4600410363255351895:Item Import Failures:`,qc=$localize`:␟5497f85d0fbe04f0dff31e28d38f1e794c51c3ba␟8369695152832245136:Queue Actions`,kc=$localize`:␟91d7010311cbf30d69325b6f6f28aa54a5296617␟1921956417267900346:Import Selected Records`,$c=$localize`:␟6a1bcf85c91198140268db35428deddcf1b522bd␟29803394889881820:Import All Records`,Cc=$localize`:␟8e71db9f7ff5a685c6df3f47c682609fc9f36682␟589171631704099427: View Import Items `,Pc=$localize`:␟126eac883bee433e4bb443284eabc660e1833a07␟1678593155983852726:Export Non-Imported Records`,Oc=$localize`:␟a22737263526463b92ba75bd1ee8df5477c0fa64␟2008976702756637105: Copy Queue To Bucket `,zc=$localize`:␟45f9ece097becf93a1f49d007956b57e6e9329a2␟8271254426186080620:Delete Queue`,Lc=$localize`:␟2805f845172b5cb33214e7be5220d0f26488731f␟8154757963416326069: (${"\ufffd0\ufffd"}:INTERPOLATION:) ${"\ufffd1\ufffd"}:INTERPOLATION_1: `;const Ec=function(e){return{"font-weight-bold":e}};function Nc(e,t){if(1&e&&(Q.Rb(0,"a",29),Q.Vb(1,Lc),Q.Qb()),2&e){const e=t.row,c=Q.hc();Q.sc("routerLink","/staff/cat/vandelay/queue/",c.queueType,"/",c.queueId,"/record/",e.id,"/matches"),Q.oc("ngClass",Q.uc(6,Ec,c.hasOverlayTarget(e.id))),Q.xb(1),Q.Zb(e.matches.length)(c.hasOverlayTarget(e.id)?"*":""),Q.Wb(1)}}function Vc(e,t){if(1&e&&(Q.Rb(0,"div"),Q.Rb(1,"b",30),Q.Mc(2),Q.Qb(),Q.Qb()),2&e){const e=Q.hc().row;Q.xb(1),Q.pc("title",e.error_detail),Q.xb(1),Q.Nc(e.import_error)}}function Bc(e,t){if(1&e&&(Q.Rb(0,"div"),Q.Rb(1,"b",31),Q.Mc(2),Q.Qb(),Q.Qb()),2&e){const e=Q.hc().row;Q.xb(2),Q.Oc("Items (",e.error_items.length,")")}}function Dc(e,t){if(1&e&&(Q.Kc(0,Vc,3,2,"div",2),Q.Kc(1,Bc,3,1,"div",2)),2&e){const e=t.row;Q.oc("ngIf",e.error_detail),Q.xb(1),Q.oc("ngIf",e.error_items.length)}}function Kc(e,t){if(1&e&&(Q.Rb(0,"a",26),Q.Mc(1),Q.Qb()),2&e){const e=Q.hc().row;Q.qc("routerLink","/staff/catalog/record/",e.imported_as,""),Q.xb(1),Q.Oc(" ",e.imported_as," ")}}function Fc(e,t){if(1&e&&(Q.Rb(0,"a",26),Q.Mc(1),Q.Qb()),2&e){const e=Q.hc().row;Q.qc("routerLink","/staff/cat/authority/edit/",e.imported_as,""),Q.xb(1),Q.Oc(" ",e.imported_as," ")}}function Gc(e,t){if(1&e&&(Q.Kc(0,Kc,2,2,"a",32),Q.Kc(1,Fc,2,2,"a",32)),2&e){const e=Q.hc();Q.oc("ngIf","bib"==e.queueType),Q.xb(1),Q.oc("ngIf","auth"==e.queueType)}}let Xc=(()=>{class e{constructor(e,t,c,i,o,a){this.router=e,this.route=t,this.evt=c,this.net=i,this.auth=o,this.vandelay=a,this.filters={matches:!1,nonImported:!1,withErrors:!1},this.route.paramMap.subscribe(e=>{this.queueType=e.get("qtype"),this.queueId=+e.get("id")}),this.queueSource=new Bt.c,this.queueSource.getRows=e=>(this.vandelay.queuePageOffset=e.offset,this.loadQueueRecords(e)),this.cellTextGenerator={"+matches":e=>e.matches.length+"",import_error:e=>null==e.import_error?"":e.import_error,imported_as:e=>e.imported_as+""}}ngOnInit(){}limitToMatches(e){this.filters.matches=e,this.queueGrid.reload()}limitToNonImported(e){this.filters.nonImported=e,this.queueGrid.reload()}limitToImportErrors(e){this.filters.withErrors=e,this.queueGrid.reload()}queuePageOffset(){return this.vandelay.queuePageOffset}ngAfterViewInit(){this.queueType&&(this.applyQueueType(),this.queueId&&this.loadQueueSummary())}openRecord(e){"auth"===this.queueType&&(this.queueType="authority"),this.router.navigate([`/staff/cat/vandelay/queue/${this.queueType}/${this.queueId}/record/${e.id}/marc`])}applyQueueType(){this.queuedRecClass=this.queueType.match(/bib/)?"vqbr":"vqar",this.vandelay.getAttrDefs(this.queueType).then(e=>{this.attrDefs=e,e.forEach(e=>{const t=new Bt.a;t.name=e.code(),t.label=e.description(),t.datatype="string",this.queueGrid.context.columnSet.add(t)}),this.queueGrid.context.applyGridConfig()})}qtypeShort(){return"bib"===this.queueType?"bib":"auth"}loadQueueSummary(){const e=`open-ils.vandelay.${this.qtypeShort()}_queue.summary.retrieve`;return this.net.request("open-ils.vandelay",e,this.auth.token(),this.queueId).toPromise().then(e=>this.queueSummary=e)}loadQueueRecords(e){return this.vandelay.getQueuedRecords(this.queueId,this.queueType,{clear_marc:!0,offset:e.offset,limit:e.limit,flesh_import_items:!0,non_imported:this.filters.nonImported,with_import_error:this.filters.withErrors},this.filters.matches).pipe(Object(cc.a)(e=>{const t=this.evt.parse(e);return!t||(console.error(t),!1)}),Object(ic.a)(e=>{const t={id:e.id(),import_error:e.import_error(),error_detail:e.error_detail(),import_time:e.import_time(),imported_as:e.imported_as(),import_items:[],error_items:[],matches:e.matches()};return"bib"===this.queueType&&(t.import_items=e.import_items(),t.error_items=e.import_items().filter(e=>e.import_error())),e.attributes().forEach(e=>{const c=this.attrDefs.filter(t=>t.id()===e.field())[0];t[c.code()]=e.attr_value()}),t}))}findOrCreateImportSelection(){let e=this.vandelay.importSelection;return e||(e=new S,this.vandelay.importSelection=e),e.queue=this.queueSummary.queue,e}hasOverlayTarget(e){return this.vandelay.importSelection&&Boolean(this.vandelay.importSelection.overlayMap[e])}importSelected(){const e=this.queueGrid.context.getSelectedRows();e.length&&(this.findOrCreateImportSelection().recordIds=e.map(e=>e.id),console.log("importing: ",this.vandelay.importSelection),this.router.navigate(["/staff/cat/vandelay/import"]))}importAll(){this.findOrCreateImportSelection().importQueue=!0,this.router.navigate(["/staff/cat/vandelay/import"])}deleteQueue(){this.confirmDelDlg.open().subscribe(e=>{e&&(this.progressDlg.open(),this.net.request("open-ils.vandelay",`open-ils.vandelay.${this.qtypeShort()}_queue.delete`,this.auth.token(),this.queueId).toPromise().then(e=>{const t=this.evt.parse(e);if(t)return new Error(t.toString());this.router.navigate(["/staff/cat/vandelay/queue"])},e=>console.error("queue deletion failed!",e)).finally(()=>this.progressDlg.close()))})}exportNonImported(){this.vandelay.exportQueue(this.queueSummary.queue,!0)}}return e.\u0275fac=function(t){return new(t||e)(Q.Lb(b.c),Q.Lb(b.a),Q.Lb(y.a),Q.Lb(m.b),Q.Lb(g.a),Q.Lb(T))},e.\u0275cmp=Q.Fb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var c;1&e&&(Q.Ic(bc,!0),Q.Sc(lc,!0),Q.Ic(dc,!0)),2&e&&(Q.yc(c=Q.gc())&&(t.queueGrid=c.first),Q.yc(c=Q.gc())&&(t.confirmDelDlg=c.first),Q.yc(c=Q.gc())&&(t.progressDlg=c.first))},decls:27,vars:10,consts:[[6,"dialogTitle"],["progressDlg",""],[4,"ngIf"],["matchesTmpl",""],["errorsTmpl",""],["importedAsTmpl",""],["hideFields","language,pagination,price,rec_identifier,eg_tcn_source,eg_identifier,item_barcode,zsource",3,"dataSource","persistKey","pageOffset","cellTextGenerator","onRowActivate"],["queueGrid",""],[3,"onChange",6,"label"],["name","id",3,"index","hidden"],["name","+matches",3,"cellTemplate",6,"label"],["name","import_error",3,"cellTemplate",6,"label"],["name","import_time","datatype","timestamp",6,"label"],["name","imported_as",3,"cellTemplate",6,"label"],[6,"dialogTitle","dialogBody"],["confirmDelDlg",""],[1,"row","pb-2"],[1,"col-lg-6"],[1,"card","tight-card"],[1,"card-header"],[1,"list-group","list-group-flush"],[1,"list-group-item"],[1,"d-flex"],[1,"flex-3"],[1,"flex-1"],[3,"routerLink","click"],[3,"routerLink"],["bucketClass","biblio",3,"fromBibQueue"],["bucketDialog",""],[3,"ngClass","routerLink"],[1,"text-danger",3,"title"],[1,"text-danger"],[3,"routerLink",4,"ngIf"]],template:function(e,t){if(1&e&&(Q.Rb(0,"eg-progress-dialog",0,1),Q.Xb(2,uc),Q.Qb(),Q.Kc(3,Ac,73,11,"ng-container",2),Q.Kc(4,Nc,2,8,"ng-template",null,3,Q.Lc),Q.Kc(6,Dc,2,2,"ng-template",null,4,Q.Lc),Q.Kc(8,Gc,2,2,"ng-template",null,5,Q.Lc),Q.Rb(10,"eg-grid",6,7),Q.fc("onRowActivate",(function(e){return t.openRecord(e)})),Q.Rb(12,"eg-grid-toolbar-checkbox",8),Q.Xb(13,fc),Q.fc("onChange",(function(e){return t.limitToMatches(e)})),Q.Qb(),Q.Rb(14,"eg-grid-toolbar-checkbox",8),Q.Xb(15,hc),Q.fc("onChange",(function(e){return t.limitToNonImported(e)})),Q.Qb(),Q.Rb(16,"eg-grid-toolbar-checkbox",8),Q.Xb(17,pc),Q.fc("onChange",(function(e){return t.limitToImportErrors(e)})),Q.Qb(),Q.Mb(18,"eg-grid-column",9),Q.Rb(19,"eg-grid-column",10),Q.Xb(20,mc),Q.Qb(),Q.Rb(21,"eg-grid-column",11),Q.Xb(22,gc),Q.Qb(),Q.Rb(23,"eg-grid-column",12),Q.Xb(24,vc),Q.Qb(),Q.Rb(25,"eg-grid-column",13),Q.Xb(26,Rc),Q.Qb(),Q.Qb()),2&e){const e=Q.zc(5),c=Q.zc(7),i=Q.zc(9);Q.xb(3),Q.oc("ngIf",t.queueSummary&&t.queueSummary.queue),Q.xb(7),Q.qc("persistKey","cat.vandelay.queue.",t.queueType,""),Q.oc("dataSource",t.queueSource)("pageOffset",t.queuePageOffset())("cellTextGenerator",t.cellTextGenerator),Q.xb(8),Q.oc("index",!0)("hidden",!0),Q.xb(1),Q.oc("cellTemplate",e),Q.xb(2),Q.oc("cellTemplate",c),Q.xb(4),Q.oc("cellTemplate",i)}},directives:[ac.a,x.v,Vt.a,rc.a,nc.a,oc.a,b.f,sc.a,x.s],encapsulation:2}),e})();var Uc=c("2XLs"),jc=c("1kwX"),Hc=c("XKii");const Wc=["bibGrid"],Zc=["authGrid"];var Yc;function Jc(e,t){if(1&e&&(Q.Rb(0,"a",3),Q.Vb(1,Yc),Q.Qb()),2&e){const e=t.row;Q.qc("routerLink","/staff/catalog/record/",e.eg_record,"/marc_view"),Q.xb(1),Q.Zb(e.eg_record),Q.Wb(1)}}Yc=$localize`:␟793c78e0a09f97897a6f3c65cdb639a86854e99b␟2848728555152418189: ${"\ufffd0\ufffd"}:INTERPOLATION: `;const ei=["title",$localize`:␟cc1dfb8e2817f2c65f6f47a3b0f3b1b3f13f4842␟2311844454751353739:Selected Merge Target`];function ti(e,t){1&e&&(Q.Pb(0),Q.Rb(1,"span",4),Q.Xb(2,ei),Q.Mc(3,"check_circle"),Q.Qb(),Q.Ob())}function ci(e,t){if(1&e&&Q.Kc(0,ti,4,0,"ng-container",2),2&e){const e=t.row,c=Q.hc();Q.oc("ngIf",c.isOverlayTarget(e.id))}}const ii=["label",$localize`:␟055d3652624214c21c0f3b6dfdf45a0e53b1d1d7␟855207132910434481:Match ID`],oi=["label",$localize`:␟5523d44508263003c74514d04541640b85288875␟8716765185236736617:Merge Target`],ai=["label",$localize`:␟9d32401749378ad8eda12a3c49cfbbb70bb0dae4␟2486844773394769749:Record ID`],ri=["label",$localize`:␟35ad1066bf71ee42ba9dbfdd894259e8ae943f68␟8161758389312054973:Match Score`],ni=["label",$localize`:␟2f43ed7d83fe3110486cebd8fe192b726f5dae10␟8089089064997894421:Matched Record Quality`],si=["label",$localize`:␟4a824ce0d95d48f850498948bff60fd97e4bf08e␟9005274713894949331:Queued Record Quality`],bi=["label",$localize`:␟fdf7cbdc140d0aab0f0b6c06065a0fd448ed6a2e␟5701618810648052610:Title`],li=["label",$localize`:␟a20424156b8816671f61879f0574a4f27d7b16b9␟1043390381565182083:Creator`],di=["label",$localize`:␟cd3d7a06941c95922503ba1840df687ba08a1bfe␟1793697473153040314:Create Date`],ui=["label",$localize`:␟91444811128782dee281d41b12cd7e8f60df4673␟3742657416068781599:Editor`],fi=["label",$localize`:␟f42381c8acecc5884b77363ce533535cae614d8f␟8633314934880892066:Edit Date`];function hi(e,t){if(1&e){const e=Q.Sb();Q.Pb(0),Q.Rb(1,"eg-grid",5,6),Q.fc("onRowClick",(function(t){return Q.Bc(e),Q.hc().matchRowClick(t)})),Q.Rb(3,"eg-grid-column",7),Q.Xb(4,ii),Q.Qb(),Q.Rb(5,"eg-grid-column",8),Q.Xb(6,oi),Q.Qb(),Q.Rb(7,"eg-grid-column",9),Q.Xb(8,ai),Q.Qb(),Q.Rb(9,"eg-grid-column",10),Q.Xb(10,ri),Q.Qb(),Q.Rb(11,"eg-grid-column",11),Q.Xb(12,ni),Q.Qb(),Q.Rb(13,"eg-grid-column",12),Q.Xb(14,si),Q.Qb(),Q.Rb(15,"eg-grid-column",13),Q.Xb(16,bi),Q.Qb(),Q.Rb(17,"eg-grid-column",14),Q.Xb(18,li),Q.Qb(),Q.Rb(19,"eg-grid-column",15),Q.Xb(20,di),Q.Qb(),Q.Rb(21,"eg-grid-column",16),Q.Xb(22,ui),Q.Qb(),Q.Rb(23,"eg-grid-column",17),Q.Xb(24,fi),Q.Qb(),Q.Qb(),Q.Ob()}if(2&e){const e=Q.hc(),t=Q.zc(3),c=Q.zc(1);Q.xb(1),Q.oc("dataSource",e.bibDataSource)("cellTextGenerator",e.cellTextGenerator)("disableSelect",!0)("disableMultiSelect",!0),Q.xb(2),Q.oc("index",!0)("hidden",!0),Q.xb(2),Q.oc("cellTemplate",t),Q.xb(2),Q.oc("cellTemplate",c)}}const pi=["label",$localize`:␟055d3652624214c21c0f3b6dfdf45a0e53b1d1d7␟855207132910434481:Match ID`];function mi(e,t){if(1&e&&(Q.Pb(0),Q.Rb(1,"eg-grid",18,19),Q.Rb(3,"eg-grid-column",7),Q.Xb(4,pi),Q.Qb(),Q.Qb(),Q.Ob()),2&e){const e=Q.hc();Q.xb(1),Q.oc("dataSource",e.authDataSource),Q.xb(2),Q.oc("index",!0)("hidden",!0)}}let gi=(()=>{class e{constructor(e,t,c,i,o,a,r,n){this.router=e,this.route=t,this.evt=c,this.net=i,this.auth=o,this.pcrud=a,this.bib=r,this.vandelay=n,this.bibDataSource=new Bt.c,this.authDataSource=new Bt.c,this.bibDataSource.getRows=e=>this.getBibMatchRows(e),this.cellTextGenerator={selected:e=>this.isOverlayTarget(e.id)+"",eg_record:e=>e.eg_record+""},this.matchRowClick=e=>{this.toggleMergeTarget(e.id)}}toggleMergeTarget(e){if(this.isOverlayTarget(e))delete this.vandelay.importSelection.overlayMap[this.recordId];else{let t=this.vandelay.importSelection;t||(t=new S,this.vandelay.importSelection=t),t.overlayMap[this.recordId]=this.matchMap[e].eg_record()}}isOverlayTarget(e){const t=this.vandelay.importSelection;return!!t&&t.overlayMap[this.recordId]===this.matchMap[e].eg_record()}ngOnInit(){}getBibMatchRows(e){return new d.a(e=>{this.getQueuedRecord().then(()=>{const t=this.queuedRecord.matches(),c=[];this.matchMap={},t.forEach(e=>{this.matchMap[e.id()]=e,c.includes(e.eg_record())||c.push(e.eg_record())});const i={};this.bib.getBibSummaries(c).subscribe(e=>i[e.id]=e,e=>{},()=>{t.forEach(t=>{const c={id:t.id(),eg_record:t.eg_record(),bre_quality:t.quality(),vqbr_quality:this.queuedRecord.quality(),match_score:t.match_score(),bib_summary:i[t.eg_record()]};e.next(c)}),e.complete()})})})}getQueuedRecord(){if(this.queuedRecord)return Promise.resolve("");const e="bib"===this.queueType?"vqbr":"vqar",t={flesh:1,flesh_fields:{}};return t.flesh_fields[e]=["matches"],this.pcrud.retrieve(e,this.recordId,t).toPromise().then(e=>this.queuedRecord=e)}}return e.\u0275fac=function(t){return new(t||e)(Q.Lb(b.c),Q.Lb(b.a),Q.Lb(y.a),Q.Lb(m.b),Q.Lb(g.a),Q.Lb(v.a),Q.Lb(Hc.a),Q.Lb(T))},e.\u0275cmp=Q.Fb({type:e,selectors:[["eg-queued-record-matches"]],viewQuery:function(e,t){var c;1&e&&(Q.Sc(Wc,!0),Q.Sc(Zc,!0)),2&e&&(Q.yc(c=Q.gc())&&(t.bibGrid=c.first),Q.yc(c=Q.gc())&&(t.authGrid=c.first))},inputs:{queueType:"queueType",recordId:"recordId"},decls:6,vars:2,consts:[["bibIdTemplate",""],["targetTemplate",""],[4,"ngIf"],[3,"routerLink"],[1,"material-icons",6,"title"],[3,"dataSource","cellTextGenerator","disableSelect","disableMultiSelect","onRowClick"],["bibGrid",""],["name","id",3,"index","hidden",6,"label"],["name","selected",3,"cellTemplate",6,"label"],["name","eg_record",3,"cellTemplate",6,"label"],["name","match_score",6,"label"],["name","bre_quality",6,"label"],["name","vqbr_quality",6,"label"],["path","bib_summary.display.title",6,"label"],["path","bib_summary.record.creator.usrname",6,"label"],["path","bib_summary.record.create_date","datatype","timestamp",6,"label"],["path","bib_summary.record.editor.usrname",6,"label"],["path","bib_summary.record.edit_date","datatype","timestamp",6,"label"],[3,"dataSource"],["authGrid",""]],template:function(e,t){1&e&&(Q.Kc(0,Jc,2,2,"ng-template",null,0,Q.Lc),Q.Kc(2,ci,1,1,"ng-template",null,1,Q.Lc),Q.Kc(4,hi,25,8,"ng-container",2),Q.Kc(5,mi,5,3,"ng-container",2)),2&e&&(Q.xb(4),Q.oc("ngIf","bib"==t.queueType),Q.xb(1),Q.oc("ngIf","authority"==t.queueType))},directives:[x.v,b.f,Vt.a,nc.a],encapsulation:2}),e})();const vi=["itemsGrid"];let Ri=(()=>{class e{constructor(e,t,c,i){this.net=e,this.auth=t,this.pcrud=c,this.vandelay=i,this.gridSource=new Bt.c,this.gridSource.getRows=e=>this.pcrud.search("vii",{record:this.recordId},{order_by:{vii:["id"]}})}}return e.\u0275fac=function(t){return new(t||e)(Q.Lb(m.b),Q.Lb(g.a),Q.Lb(v.a),Q.Lb(T))},e.\u0275cmp=Q.Fb({type:e,selectors:[["eg-queued-record-items"]],viewQuery:function(e,t){var c;1&e&&Q.Ic(vi,!0),2&e&&Q.yc(c=Q.gc())&&(t.itemsGrid=c.first)},inputs:{recordId:"recordId"},decls:2,vars:1,consts:[["showFields","record,import_error,imported_as,import_time,owning_lib,call_number,barcode","persistKey","cat.vandelay.queue.bib.items","idlClass","vii",3,"dataSource"],["itemsGrid",""]],template:function(e,t){1&e&&Q.Mb(0,"eg-grid",0,1),2&e&&Q.oc("dataSource",t.gridSource)},directives:[Vt.a],encapsulation:2}),e})();var yi;yi=$localize`:␟374a4f9c3f483fa60dec4fba02f81b2c51743515␟2769384034706317195:Return to Queue`;const Qi=["title",$localize`:␟bc049c77cfeb03993e9e0e8a3adf2ba524f32397␟2649193269697959741:Queued Record MARC`],Si=["title",$localize`:␟2e5383456e64a1db73ba2861a98cca05343355fe␟3970093442360844708:Edit Record`],Ti=["title",$localize`:␟d461e67d66c81b88a541d95c6e8122a7e01171ee␟6108788549819167720:Record Matches`],Ii=["title",$localize`:␟79ce401e73bf239127680de3975194633346ddce␟1351344403546996322:Import Items`];function xi(e,t){if(1&e&&Q.Mb(0,"eg-marc-html",11),2&e){const e=Q.hc();Q.oc("recordId",e.recordId)("recordType","vandelay-"+e.queueType)}}function Mi(e,t){if(1&e){const e=Q.Sb();Q.Rb(0,"eg-marc-editor",15),Q.fc("recordSaved",(function(t){return Q.Bc(e),Q.hc(3).handleMarcRecordSaved(t)})),Q.Qb()}if(2&e){const e=Q.hc(3);Q.oc("inPlaceMode",!0)("recordXml",e.queuedRecord.marc())("recordSource",e.queuedRecord.bib_source())}}function _i(e,t){if(1&e){const e=Q.Sb();Q.Rb(0,"eg-marc-editor",16),Q.fc("recordSaved",(function(t){return Q.Bc(e),Q.hc(3).handleMarcRecordSaved(t)})),Q.Qb()}if(2&e){const e=Q.hc(3);Q.oc("inPlaceMode",!0)("recordXml",e.queuedRecord.marc())}}function wi(e,t){if(1&e&&(Q.Pb(0),Q.Kc(1,Mi,1,3,"eg-marc-editor",13),Q.Kc(2,_i,1,2,"eg-marc-editor",14),Q.Ob()),2&e){const e=Q.hc(2);Q.xb(1),Q.oc("ngIf","bib"===e.queueType),Q.xb(1),Q.oc("ngIf","bib"!==e.queueType)}}function qi(e,t){if(1&e&&Q.Kc(0,wi,3,2,"ng-container",12),2&e){const e=Q.hc();Q.oc("ngIf",e.queuedRecord)}}function ki(e,t){if(1&e&&Q.Mb(0,"eg-queued-record-matches",17),2&e){const e=Q.hc();Q.oc("recordId",e.recordId)("queueType",e.queueType)}}function $i(e,t){if(1&e&&Q.Mb(0,"eg-queued-record-items",18),2&e){const e=Q.hc();Q.oc("recordId",e.recordId)}}let Ci=(()=>{class e{constructor(e,t,c){this.router=e,this.route=t,this.pcrud=c,this.route.paramMap.subscribe(e=>{this.queueId=+e.get("id"),this.recordId=+e.get("recordId"),this.queueType=e.get("qtype"),this.recordTab=e.get("recordTab"),"edit"===this.recordTab&&this.loadRecord()})}onTabChange(e){this.recordTab=e.nextId,e.preventDefault(),this.router.navigate([`/staff/cat/vandelay/queue/${this.queueType}/${this.queueId}/record/${this.recordId}/${this.recordTab}`])}loadRecord(){this.queuedRecord=null,this.pcrud.retrieve("bib"===this.queueType?"vqbr":"vqar",this.recordId).subscribe(e=>this.queuedRecord=e)}handleMarcRecordSaved(e){this.queuedRecord.marc(e.marcXml),"bib"===this.queueType&&this.queuedRecord.bib_source(e.bibSource),this.pcrud.update(this.queuedRecord).subscribe(e=>{console.log("response = ",e)})}}return e.\u0275fac=function(t){return new(t||e)(Q.Lb(b.c),Q.Lb(b.a),Q.Lb(v.a))},e.\u0275cmp=Q.Fb({type:e,selectors:[["ng-component"]],decls:21,vars:3,consts:[[1,"row","mb-3"],[1,"col-lg-2"],[1,"btn","btn-info","label-with-material-icon",3,"routerLink"],[1,"material-icons"],[3,"activeId","tabChange"],["recordTabs",""],["id","marc",6,"title"],["ngbTabContent",""],["id","edit",6,"title"],["id","matches",6,"title"],["id","items",6,"title"],[3,"recordId","recordType"],[4,"ngIf"],[3,"inPlaceMode","recordXml","recordSource","recordSaved",4,"ngIf"],[3,"inPlaceMode","recordXml","recordSaved",4,"ngIf"],[3,"inPlaceMode","recordXml","recordSource","recordSaved"],[3,"inPlaceMode","recordXml","recordSaved"],[3,"recordId","queueType"],[3,"recordId"]],template:function(e,t){1&e&&(Q.Rb(0,"div",0),Q.Rb(1,"div",1),Q.Rb(2,"button",2),Q.Rb(3,"span",3),Q.Mc(4,"arrow_back"),Q.Qb(),Q.Rb(5,"span"),Q.Vb(6,yi),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(7,"ngb-tabset",4,5),Q.fc("tabChange",(function(e){return t.onTabChange(e)})),Q.Rb(9,"ngb-tab",6),Q.Xb(10,Qi),Q.Kc(11,xi,1,2,"ng-template",7),Q.Qb(),Q.Rb(12,"ngb-tab",8),Q.Xb(13,Si),Q.Kc(14,qi,1,1,"ng-template",7),Q.Qb(),Q.Rb(15,"ngb-tab",9),Q.Xb(16,Ti),Q.Kc(17,ki,1,2,"ng-template",7),Q.Qb(),Q.Rb(18,"ngb-tab",10),Q.Xb(19,Ii),Q.Kc(20,$i,1,1,"ng-template",7),Q.Qb(),Q.Qb()),2&e&&(Q.xb(2),Q.rc("routerLink","/staff/cat/vandelay/queue/",t.queueType,"/",t.queueId,""),Q.xb(5),Q.oc("activeId",t.recordTab))},directives:[b.d,bt.W,bt.T,bt.U,Uc.a,x.v,jc.a,gi,Ri],encapsulation:2}),e})();var Pi=c("RAh1");const Oi=["title",$localize`:␟44aa5f7f8926d06dac25d713d8e609902688da53␟5557714853406237867:Bibliographic Attributes`],zi=["title",$localize`:␟1db70e85cf4cddd03bd44d367f050a4f6bb3ebaa␟2259550136298547059:Authority Attributes`];function Li(e,t){1&e&&(Q.Rb(0,"div",5),Q.Mb(1,"eg-admin-page",6),Q.Qb())}function Ai(e,t){1&e&&(Q.Rb(0,"div",5),Q.Mb(1,"eg-admin-page",7),Q.Qb())}let Ei=(()=>{class e{constructor(e,t){this.router=e,this.route=t,this.route.paramMap.subscribe(e=>{this.attrType=e.get("atype")})}onTabChange(e){this.attrType=e.nextId,e.preventDefault(),this.router.navigate(["/staff/cat/vandelay/display_attrs/"+this.attrType])}}return e.\u0275fac=function(t){return new(t||e)(Q.Lb(b.c),Q.Lb(b.a))},e.\u0275cmp=Q.Fb({type:e,selectors:[["ng-component"]],decls:8,vars:1,consts:[[3,"activeId","tabChange"],["tabs",""],["id","bib",6,"title"],["ngbTabContent",""],["id","authority",6,"title"],[1,"mt-3"],["idlClass","vqbrad"],["idlClass","vqarad"]],template:function(e,t){1&e&&(Q.Rb(0,"ngb-tabset",0,1),Q.fc("tabChange",(function(e){return t.onTabChange(e)})),Q.Rb(2,"ngb-tab",2),Q.Xb(3,Oi),Q.Kc(4,Li,2,0,"ng-template",3),Q.Qb(),Q.Rb(5,"ngb-tab",4),Q.Xb(6,zi),Q.Kc(7,Ai,2,0,"ng-template",3),Q.Qb(),Q.Qb()),2&e&&Q.oc("activeId",t.attrType)},directives:[bt.W,bt.T,bt.U,Pi.a],encapsulation:2}),e})(),Ni=(()=>{class e{constructor(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Q.Fb({type:e,selectors:[["ng-component"]],decls:1,vars:0,consts:[["idlClass","vmp"]],template:function(e,t){1&e&&Q.Mb(0,"eg-admin-page",0)},directives:[Pi.a],encapsulation:2}),e})(),Vi=(()=>{class e{constructor(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Q.Fb({type:e,selectors:[["ng-component"]],decls:1,vars:0,consts:[["idlClass","viiad"]],template:function(e,t){1&e&&Q.Mb(0,"eg-admin-page",0)},directives:[Pi.a],encapsulation:2}),e})();const Bi=["itemsGrid"];var Di;Di=$localize`:␟374a4f9c3f483fa60dec4fba02f81b2c51743515␟2769384034706317195:Return to Queue`;const Ki=["label",$localize`:␟39ec0991f069e6a833174fe399fcab1966bf438a␟369219660710450241:Limit to Import Failures`];let Fi=(()=>{class e{constructor(e,t,c,i,o){this.router=e,this.route=t,this.net=c,this.auth=i,this.vandelay=o,this.route.paramMap.subscribe(e=>{this.queueId=+e.get("id"),this.queueType=e.get("qtype")}),this.gridSource=new Bt.c,this.gridSource.getRows=e=>this.net.request("open-ils.vandelay","open-ils.vandelay.import_item.queue.retrieve",this.auth.token(),this.queueId,{with_import_error:this.filterImportErrors,offset:e.offset,limit:e.limit})}limitToImportErrors(e){this.filterImportErrors=e,this.itemsGrid.reload()}}return e.\u0275fac=function(t){return new(t||e)(Q.Lb(b.c),Q.Lb(b.a),Q.Lb(m.b),Q.Lb(g.a),Q.Lb(T))},e.\u0275cmp=Q.Fb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var c;1&e&&Q.Ic(Bi,!0),2&e&&Q.yc(c=Q.gc())&&(t.itemsGrid=c.first)},decls:11,vars:3,consts:[[1,"row","mb-3"],[1,"col-lg-2"],[1,"btn","btn-info","label-with-material-icon",3,"routerLink"],[1,"material-icons"],["showFields","record,import_error,imported_as,import_time,owning_lib,call_number,barcode","persistKey","cat.vandelay.queue.items","idlClass","vii",3,"dataSource"],["itemsGrid",""],[3,"onChange",6,"label"]],template:function(e,t){1&e&&(Q.Rb(0,"div",0),Q.Rb(1,"div",1),Q.Rb(2,"button",2),Q.Rb(3,"span",3),Q.Mc(4,"arrow_back"),Q.Qb(),Q.Rb(5,"span"),Q.Vb(6,Di),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(7,"eg-grid",4,5),Q.Rb(9,"eg-grid-toolbar-checkbox",6),Q.Xb(10,Ki),Q.fc("onChange",(function(e){return t.limitToImportErrors(e)})),Q.Qb(),Q.Qb()),2&e&&(Q.xb(2),Q.rc("routerLink","/staff/cat/vandelay/queue/",t.queueType,"/",t.queueId,""),Q.xb(5),Q.oc("dataSource",t.gridSource))},directives:[b.d,Vt.a,rc.a],encapsulation:2}),e})();var Gi=c("UUQ6"),Xi=c("wVJ/"),Ui=c("eXX1");const ji=["grid"],Hi=["editDialog"],Wi=["label",$localize`:␟ffc8dd4a75fc9bb03bbc1791ffe223229790a088␟7587326642021274158:New Match Set`],Zi=["label",$localize`:␟96e678d5f4bfe1a041ecfcd34804efa5e100d5e8␟5167284364083276913:Delete Selected`];function Yi(e,t){if(1&e&&(Q.Rb(0,"a",12),Q.Mc(1),Q.Qb()),2&e){const e=t.row;Q.qc("routerLink","/staff/cat/vandelay/match_sets/",e.id(),"/editor"),Q.xb(1),Q.Oc(" ",e.name()," ")}}const Ji=function(){return{id:"biblio"}},eo=function(){return{id:"serial"}},to=function(){return{id:"authority"}},co=function(e,t,c){return[e,t,c]},io=function(e){return{customValues:e}},oo=function(e){return{mtype:e}};let ao=(()=>{class e{constructor(e,t,c,i){this.router=e,this.pcrud=t,this.auth=c,this.org=i,this.gridSource=new Bt.c,this.contextOrg=this.org.get(this.auth.user().ws_ou()),this.gridSource.getRows=e=>{const t=this.org.ancestors(this.contextOrg,!0);return this.pcrud.search("vms",{owner:t},{order_by:{vms:["name"]},limit:e.limit,offset:e.offset})},this.cellTextGenerator={name:e=>e.name()},this.createNew=()=>{this.editDialog.mode="create",this.editDialog.open({size:"lg"}).subscribe(()=>this.grid.reload())},this.deleteSelected=e=>{e.forEach(e=>e.isdeleted(!0)),this.pcrud.autoApply(e).subscribe(e=>console.debug("deleted: "+e),e=>{},()=>this.grid.reload())}}ngAfterViewInit(){this.grid.onRowActivate.subscribe(e=>{this.editDialog.mode="update",this.editDialog.recordId=e.id(),this.editDialog.open({size:"lg"}).subscribe(()=>this.grid.reload())})}orgOnChange(e){this.contextOrg=e,this.grid.reload()}}return e.\u0275fac=function(t){return new(t||e)(Q.Lb(b.c),Q.Lb(v.a),Q.Lb(g.a),Q.Lb(p.a))},e.\u0275cmp=Q.Fb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var c;1&e&&(Q.Ic(ji,!0),Q.Ic(Hi,!0)),2&e&&(Q.yc(c=Q.gc())&&(t.grid=c.first),Q.yc(c=Q.gc())&&(t.editDialog=c.first))},decls:18,vars:18,consts:[[1,"d-flex","mb-3"],[1,"input-group"],[1,"input-group-prepend"],[1,"input-group-text"],[3,"initialOrg","onChange"],["nameTmpl",""],["persistKey","cat.vandelay.match_set.list","idlClass","vms",3,"dataSource","cellTextGenerator"],["grid",""],[3,"action",6,"label"],["name","name",3,"cellTemplate"],["idlClass","vms",3,"fieldOptions"],["editDialog",""],[3,"routerLink"]],template:function(e,t){if(1&e&&(Q.Rb(0,"div",0),Q.Rb(1,"div"),Q.Rb(2,"div",1),Q.Rb(3,"div",2),Q.Rb(4,"span",3),Q.Mc(5,"Owner"),Q.Qb(),Q.Qb(),Q.Rb(6,"eg-org-select",4),Q.fc("onChange",(function(e){return t.orgOnChange(e)})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Kc(7,Yi,2,2,"ng-template",null,5,Q.Lc),Q.Rb(9,"eg-grid",6,7),Q.Rb(11,"eg-grid-toolbar-button",8),Q.Xb(12,Wi),Q.Qb(),Q.Rb(13,"eg-grid-toolbar-action",8),Q.Xb(14,Zi),Q.Qb(),Q.Mb(15,"eg-grid-column",9),Q.Qb(),Q.Mb(16,"eg-fm-record-editor",10,11)),2&e){const e=Q.zc(8);Q.xb(6),Q.oc("initialOrg",t.contextOrg),Q.xb(3),Q.oc("dataSource",t.gridSource)("cellTextGenerator",t.cellTextGenerator),Q.xb(2),Q.oc("action",t.createNew),Q.xb(2),Q.oc("action",t.deleteSelected),Q.xb(2),Q.oc("cellTemplate",e),Q.xb(1),Q.oc("fieldOptions",Q.uc(16,oo,Q.uc(14,io,Q.wc(10,co,Q.tc(7,Ji),Q.tc(8,eo),Q.tc(9,to)))))}},directives:[Xi.a,Vt.a,Ui.a,Dt.a,nc.a,Gi.a,b.f],encapsulation:2}),e})();var ro,no=c("Mr7b"),so=c("G8BM");ro=$localize`:␟4a902f26764a679ed35012306f000ad00399bbf7␟6630137344798872260:Record Attribute:`;const bo=["placeholder",$localize`:␟4d60351e8b4d8e128695987ad63cbb14c53e4588␟7939419250366658413:Record Attribute...`];function lo(e,t){if(1&e){const e=Q.Sb();Q.Pb(0),Q.Rb(1,"div",4),Q.Rb(2,"div",5),Q.Vb(3,ro),Q.Qb(),Q.Rb(4,"div",6),Q.Rb(5,"eg-combobox",7),Q.Xb(6,bo),Q.fc("onChange",(function(t){return Q.Bc(e),Q.hc(2).values.recordAttr=t?t.id:""})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Ob()}if(2&e){const e=Q.hc(2);Q.xb(5),Q.oc("entries",e.bibAttrDefEntries)("required",!0)}}var uo,fo,ho,po,mo,go;function vo(e,t){if(1&e){const e=Q.Sb();Q.Pb(0),Q.Rb(1,"div",4),Q.Rb(2,"div",5),Q.Vb(3,uo),Q.Qb(),Q.Rb(4,"div",8),Q.Rb(5,"input",9),Q.fc("ngModelChange",(function(t){return Q.Bc(e),Q.hc(2).values.marcTag=t})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(6,"div",4),Q.Rb(7,"div",5),Q.Vb(8,fo),Q.Qb(),Q.Rb(9,"div",8),Q.Rb(10,"input",9),Q.fc("ngModelChange",(function(t){return Q.Bc(e),Q.hc(2).values.marcSf=t})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Ob()}if(2&e){const e=Q.hc(2);Q.xb(5),Q.oc("ngModel",e.values.marcTag),Q.xb(5),Q.oc("ngModel",e.values.marcSf)}}function Ro(e,t){1&e&&(Q.Pb(0),Q.Rb(1,"div",4),Q.Rb(2,"div",5),Q.Vb(3,ho),Q.Qb(),Q.Rb(4,"div",8),Q.Mb(5,"input",10),Q.Qb(),Q.Qb(),Q.Ob())}function yo(e,t){if(1&e){const e=Q.Sb();Q.Pb(0),Q.Rb(1,"div",4),Q.Rb(2,"div",5),Q.Mc(3,"Negate:"),Q.Qb(),Q.Rb(4,"div",8),Q.Rb(5,"input",12),Q.fc("ngModelChange",(function(t){return Q.Bc(e),Q.hc(3).values.negate=t})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Ob()}if(2&e){const e=Q.hc(3);Q.xb(5),Q.oc("ngModel",e.values.negate)}}function Qo(e,t){if(1&e){const e=Q.Sb();Q.Pb(0),Q.Rb(1,"div",4),Q.Rb(2,"div",5),Q.Mc(3,"Match Score:"),Q.Qb(),Q.Rb(4,"div",8),Q.Rb(5,"input",11),Q.fc("ngModelChange",(function(t){return Q.Bc(e),Q.hc(2).values.matchScore=t})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Kc(6,yo,6,1,"ng-container",3),Q.Ob()}if(2&e){const e=Q.hc(2);Q.xb(5),Q.oc("ngModel",e.values.matchScore),Q.xb(1),Q.oc("ngIf",!e.isForQuality)}}function So(e,t){if(1&e){const e=Q.Sb();Q.Pb(0),Q.Rb(1,"div",4),Q.Rb(2,"div",5),Q.Mc(3,"Operator:"),Q.Qb(),Q.Rb(4,"div",8),Q.Rb(5,"select",13),Q.fc("ngModelChange",(function(t){return Q.Bc(e),Q.hc(2).values.boolOp=t})),Q.Rb(6,"option",14),Q.Vb(7,po),Q.Qb(),Q.Rb(8,"option",15),Q.Vb(9,mo),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Ob()}if(2&e){const e=Q.hc(2);Q.xb(5),Q.oc("ngModel",e.values.boolOp)}}function To(e,t){if(1&e){const e=Q.Sb();Q.Pb(0),Q.Rb(1,"div",4),Q.Rb(2,"div",5),Q.Vb(3,go),Q.Qb(),Q.Rb(4,"div",8),Q.Rb(5,"input",16),Q.fc("ngModelChange",(function(t){return Q.Bc(e),Q.hc(2).values.value=t})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Ob()}if(2&e){const e=Q.hc(2);Q.xb(5),Q.oc("ngModel",e.values.value)}}function Io(e,t){if(1&e&&(Q.Rb(0,"div",1),Q.Rb(1,"div",2),Q.Kc(2,lo,7,2,"ng-container",3),Q.Kc(3,vo,11,2,"ng-container",3),Q.Kc(4,Ro,6,0,"ng-container",3),Q.Kc(5,Qo,7,2,"ng-container",3),Q.Kc(6,So,10,1,"ng-container",3),Q.Kc(7,To,6,1,"ng-container",3),Q.Qb(),Q.Qb()),2&e){const e=Q.hc();Q.xb(2),Q.oc("ngIf","attr"==e.values.pointType),Q.xb(1),Q.oc("ngIf","marc"==e.values.pointType),Q.xb(1),Q.oc("ngIf","heading"==e.values.pointType),Q.xb(1),Q.oc("ngIf","bool"!=e.values.pointType),Q.xb(1),Q.oc("ngIf","bool"==e.values.pointType),Q.xb(1),Q.oc("ngIf",e.isForQuality)}}uo=$localize`:␟15cab428492d4f8b8bc528a93cf1fdd2dc65328e␟7978273686665519179:Tag:`,fo=$localize`:␟17b1497dabc1fdb473957615655bfceb6f40dd5a␟1425620040227276830:Subfield ‡:`,ho=$localize`:␟feafbe0059ed539ca8591394c233fef40deb7e5c␟840525881228717028:Normalized Heading:`,po=$localize`:␟8a8ca707e84097c88186c20909f7333f5f43a6f3␟2040898397501477279:AND`,mo=$localize`:␟63f5d0ec23e3cf4abf6d5221107633c90d8d4a15␟290735093992020324:OR`,go=$localize`:␟be5c45182a4e7a3c4ee34bb54cc8d1f539f895f7␟3904805944153220794:Value:`;class xo{}let Mo=(()=>{class e{constructor(e,t){this.idl=e,this.pcrud=t,this.values=new xo,this.bibAttrDefs=[],this.bibAttrDefEntries=[]}set pointType(e){this.values.pointType=e,this.values.recordAttr="",this.values.matchScore=1,this.values.negate=!1,this.values.marcTag="",this.values.marcSf="",this.values.boolOp="AND",this.values.value=""}ngOnInit(){this.pcrud.retrieveAll("crad",{order_by:{crad:"label"}}).subscribe(e=>{this.bibAttrDefs.push(e),this.bibAttrDefEntries.push({id:e.name(),label:e.label()})})}setNewPointType(e){}}return e.\u0275fac=function(t){return new(t||e)(Q.Lb(h.a),Q.Lb(v.a))},e.\u0275cmp=Q.Fb({type:e,selectors:[["eg-match-set-new-point"]],inputs:{isForQuality:"isForQuality",pointType:"pointType"},decls:1,vars:1,consts:[["class","row ml-2 mt-4 p-2 border border-secondary",4,"ngIf"],[1,"row","ml-2","mt-4","p-2","border","border-secondary"],[1,"col-lg-12","common-form","striped-odd","form-validated"],[4,"ngIf"],[1,"row","mb-1"],[1,"col-lg-3"],[1,"col-lg-4"],[3,"entries","required","onChange",6,"placeholder"],[1,"col-lg-2"],["required","","type","text",1,"form-control",3,"ngModel","ngModelChange"],["type","checkbox","checked","","disabled","",1,"form-check-input"],["required","","type","number","step","0.1",1,"form-control",3,"ngModel","ngModelChange"],["type","checkbox",1,"form-check-input",3,"ngModel","ngModelChange"],[1,"form-control",3,"ngModel","ngModelChange"],["value","AND"],["value","OR"],["type","text","required","",1,"form-control",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&Q.Kc(0,Io,8,6,"div",0),2&e&&Q.oc("ngIf",t.values.pointType)},directives:[x.v,E.a,K.c,K.E,K.t,K.w,K.z,K.a,K.F,K.y,K.I],encapsulation:2}),e})();var _o=c("tNQm"),wo=c("d4sd");const qo=["newPoint"];var ko,$o,Co,Po,Oo,zo,Lo,Ao,Eo,No,Vo,Bo;function Do(e,t){1&e&&(Q.bc(0,Oo,2),Q.Mb(1,"span"),Q.Yb())}function Ko(e,t){1&e&&(Q.bc(0,Oo,3),Q.Mb(1,"span"),Q.Yb())}function Fo(e,t){if(1&e&&(Q.bc(0,Oo,4),Q.Mb(1,"span"),Q.Yb()),2&e){const e=Q.hc(2).point;Q.xb(1),Q.Zb(e.subfield()),Q.Wb(0)}}function Go(e,t){if(1&e&&(Q.bc(0,Oo,5),Q.Mb(1,"span"),Q.Yb()),2&e){const e=Q.hc(2).point;Q.xb(1),Q.Zb(e.quality()),Q.Wb(0)}}function Xo(e,t){if(1&e&&(Q.bc(0,Oo,1),Q.Pb(1),Q.Kc(2,Do,2,0,"span",15),Q.Kc(3,Ko,2,0,"span",15),Q.Mb(4,"span"),Q.Kc(5,Fo,2,1,"span",15),Q.Kc(6,Go,2,1,"span",15),Q.Ob(),Q.Yb()),2&e){const e=Q.hc(),t=e.point,c=e.showmatch;Q.xb(2),Q.oc("ngIf",t.negate()),Q.xb(1),Q.oc("ngIf",t.heading()),Q.xb(2),Q.oc("ngIf",t.subfield()),Q.xb(1),Q.oc("ngIf",c&&!t.bool_op()),Q.Zb(t.bool_op())(t.svf())(t.tag()),Q.Wb(0)}}function Uo(e,t){if(1&e&&(Q.bc(0,Oo),Q.Kc(1,Xo,7,7,"ng-container",15),Q.Yb()),2&e){const e=t.point;Q.xb(1),Q.oc("ngIf",e)}}function jo(e,t){if(1&e){const e=Q.Sb();Q.Rb(0,"button",9),Q.fc("click",(function(){return Q.Bc(e),Q.hc().newPointType="attr"})),Q.Vb(1,zo),Q.Qb()}}function Ho(e,t){if(1&e){const e=Q.Sb();Q.Rb(0,"button",9),Q.fc("click",(function(){return Q.Bc(e),Q.hc().newPointType="heading"})),Q.Vb(1,Lo),Q.Qb()}}function Wo(e,t){if(1&e){const e=Q.Sb();Q.Rb(0,"div",16),Q.Rb(1,"button",17),Q.fc("click",(function(){return Q.Bc(e),Q.hc().addChildNode()})),Q.Vb(2,Ao),Q.Qb(),Q.Rb(3,"button",18),Q.fc("click",(function(){return Q.Bc(e),Q.hc().addChildNode(!0)})),Q.Vb(4,Eo),Q.Qb(),Q.Qb()}if(2&e){const e=Q.hc();Q.xb(1),Q.oc("disabled",!e.selectedIsBool()),Q.xb(2),Q.oc("disabled",!e.hasSelectedNode()||"bool"!=e.newPointType&&e.selectedIsBool())}}function Zo(e,t){1&e&&(Q.Rb(0,"div",19),Q.Rb(1,"ol"),Q.bc(2,No),Q.Mb(3,"li"),Q.Mb(4,"li"),Q.Mb(5,"li"),Q.Yb(),Q.Qb(),Q.Qb())}function Yo(e,t){if(1&e){const e=Q.Sb();Q.Pb(0),Q.Rb(1,"div",20),Q.Rb(2,"button",21),Q.fc("click",(function(){return Q.Bc(e),Q.hc().deleteNode()})),Q.Vb(3,Vo),Q.Qb(),Q.Rb(4,"button",22),Q.fc("click",(function(){return Q.Bc(e),Q.hc().saveTree()})),Q.Vb(5,Bo),Q.Qb(),Q.Qb(),Q.Rb(6,"div",23),Q.Rb(7,"eg-tree",24),Q.fc("nodeClicked",(function(t){return Q.Bc(e),Q.hc().nodeClicked(t)})),Q.Qb(),Q.Qb(),Q.Ob()}if(2&e){const e=Q.hc();Q.xb(2),Q.oc("disabled",!e.hasSelectedNode()||e.isRootNode()),Q.xb(2),Q.oc("disabled",!e.changesMade),Q.xb(3),Q.oc("tree",e.tree)}}ko=$localize`:␟a75949d5d44bbca9d6ca45d08254a9f413bbad23␟6189243122214810921: Your Expression: ${"\ufffd0\ufffd"}:INTERPOLATION: `,$o=$localize`:␟0a384f59f4707af0f4694f1aa59cd84dee913241␟6205540213661359687:Add New:`,Co=$localize`:␟e8a24d502e3b4b22eb24eaa1ef27bad057950b54␟7458506762923954279:MARC Tag and Subfield`,Po=$localize`:␟f201318fd97e73c8035d87557ec5c95379e56ab8␟9191306405561503368:Boolean Operator`,Oo=$localize`:␟3d68be76700c737eca1956cd1768d30517debe5f␟3742284469838142371:${"\ufffd*1:1\ufffd\ufffd#1:1\ufffd"}:START_TAG_NG_CONTAINER:${"\ufffd*2:2\ufffd\ufffd#1:2\ufffd"}:START_TAG_SPAN:NOT ${"[\ufffd/#1:2\ufffd\ufffd/*2:2\ufffd|\ufffd/#1:3\ufffd\ufffd/*3:3\ufffd|\ufffd/#4:1\ufffd|\ufffd/#1:4\ufffd\ufffd/*5:4\ufffd|\ufffd/#1:5\ufffd\ufffd/*6:5\ufffd]"}:CLOSE_TAG_SPAN:${"\ufffd*3:3\ufffd\ufffd#1:3\ufffd"}:START_TAG_SPAN_1:Normalized Heading${"[\ufffd/#1:2\ufffd\ufffd/*2:2\ufffd|\ufffd/#1:3\ufffd\ufffd/*3:3\ufffd|\ufffd/#4:1\ufffd|\ufffd/#1:4\ufffd\ufffd/*5:4\ufffd|\ufffd/#1:5\ufffd\ufffd/*6:5\ufffd]"}:CLOSE_TAG_SPAN:${"\ufffd#4:1\ufffd"}:START_TAG_SPAN_2:${"\ufffd0:1\ufffd"}:INTERPOLATION:${"\ufffd1:1\ufffd"}:INTERPOLATION_1:${"\ufffd2:1\ufffd"}:INTERPOLATION_2:${"[\ufffd/#1:2\ufffd\ufffd/*2:2\ufffd|\ufffd/#1:3\ufffd\ufffd/*3:3\ufffd|\ufffd/#4:1\ufffd|\ufffd/#1:4\ufffd\ufffd/*5:4\ufffd|\ufffd/#1:5\ufffd\ufffd/*6:5\ufffd]"}:CLOSE_TAG_SPAN:${"\ufffd*5:4\ufffd\ufffd#1:4\ufffd"}:START_TAG_SPAN_3: ‡${"\ufffd0:4\ufffd"}:INTERPOLATION_3:${"[\ufffd/#1:2\ufffd\ufffd/*2:2\ufffd|\ufffd/#1:3\ufffd\ufffd/*3:3\ufffd|\ufffd/#4:1\ufffd|\ufffd/#1:4\ufffd\ufffd/*5:4\ufffd|\ufffd/#1:5\ufffd\ufffd/*6:5\ufffd]"}:CLOSE_TAG_SPAN:${"\ufffd*6:5\ufffd\ufffd#1:5\ufffd"}:START_TAG_SPAN_4: | Match score ${"\ufffd0:5\ufffd"}:INTERPOLATION_4:${"[\ufffd/#1:2\ufffd\ufffd/*2:2\ufffd|\ufffd/#1:3\ufffd\ufffd/*3:3\ufffd|\ufffd/#4:1\ufffd|\ufffd/#1:4\ufffd\ufffd/*5:4\ufffd|\ufffd/#1:5\ufffd\ufffd/*6:5\ufffd]"}:CLOSE_TAG_SPAN:${"\ufffd/#1:1\ufffd\ufffd/*1:1\ufffd"}:CLOSE_TAG_NG_CONTAINER:`,Oo=Q.ac(Oo),zo=$localize`:␟e726c799b03da39783751ce3aa327495919e40cb␟7410001636246507654:Record Attribute`,Lo=$localize`:␟ef59fed0a078dfda7e951963f4a0e3ed3c8b7416␟2808290889837310571:Normalized Authority Heading`,Ao=$localize`:␟cb294fca2b3e4bdf60fbdf69035d03431ef8dc8d␟5561273585375183044: Add To Selected Node `,Eo=$localize`:␟1027bc1af4a0a2342b57eab8076e12907893d364␟7418312807388840022: Replace Selected Node `,No=$localize`:␟6dd30841ccc1ea2c94b4be8dbda2de146ed06c36␟1186369943030718123:${"[\ufffd#3\ufffd|\ufffd#4\ufffd|\ufffd#5\ufffd]"}:START_LIST_ITEM:Define a new match point using the above fields.${"[\ufffd/#3\ufffd|\ufffd/#4\ufffd|\ufffd/#5\ufffd]"}:CLOSE_LIST_ITEM:${"[\ufffd#3\ufffd|\ufffd#4\ufffd|\ufffd#5\ufffd]"}:START_LIST_ITEM:Select a boolean node in the tree.${"[\ufffd/#3\ufffd|\ufffd/#4\ufffd|\ufffd/#5\ufffd]"}:CLOSE_LIST_ITEM:${"[\ufffd#3\ufffd|\ufffd#4\ufffd|\ufffd#5\ufffd]"}:START_LIST_ITEM:Click the "Add..." button to add the new matchpoint as a child of the selected node.${"[\ufffd/#3\ufffd|\ufffd/#4\ufffd|\ufffd/#5\ufffd]"}:CLOSE_LIST_ITEM:`,No=Q.ac(No),Vo=$localize`:␟39a3983f700824f2161bae55816e30c905648de9␟5093216674362518382: Remove Selected Node `,Bo=$localize`:␟0f4e490db02764b363cc3dddfd4f91f64a06b02f␟3807355661675884532: Save Changes `;let Jo=(()=>{class e{constructor(e,t,c,i,o,a){this.idl=e,this.pcrud=t,this.net=c,this.auth=i,this.org=o,this.strings=a,this.newId=-1}set matchSet(e){this.matchSet_=e,e&&!this.initDone&&(this.matchSetType=e.mtype(),this.initDone=!0,this.refreshTree())}ngOnInit(){}refreshTree(){return this.matchSet_?this.pcrud.search("vmsp",{match_set:this.matchSet_.id()},{},{atomic:!0,authoritative:!0}).toPromise().then(e=>{e.length>0?this.ingestMatchPoints(e):this.addRootNode()}):Promise.resolve()}addRootNode(){const e=this.idl.create("vmsp");e.id(this.newId--),e.isnew(!0),e.match_set(this.matchSet_.id()),e.children([]),e.bool_op("AND");const t=new no.b({id:e.id(),callerData:{point:e}});this.tree=new no.a(t),this.setNodeLabel(t,e)}ingestMatchPoints(e){const t=[],c={};e.forEach(e=>{e.negate("t"===e.negate()),e.heading("t"===e.heading()),e.children([]);const i=new no.b({id:e.id(),expanded:!0,callerData:{point:e}});c[i.id+""]=i,this.setNodeLabel(i,e).then(()=>t.push(i))}),e.forEach(e=>{const t=c[e.id()+""];e.parent()?c[e.parent()+""].children.push(t):this.tree=new no.a(t)})}setNodeLabel(e,t){return e.label?Promise.resolve(null):Promise.all([this.getPointLabel(t,!0).then(t=>e.label=t),this.getPointLabel(t,!1).then(t=>e.callerData.slimLabel=t)])}getPointLabel(e,t){return this.strings.interpolate("staff.cat.vandelay.matchpoint.label",{point:e,showmatch:t})}nodeClicked(e){}deleteNode(){this.changesMade=!0;const e=this.tree.selectedNode();this.tree.removeNode(e)}hasSelectedNode(){return Boolean(this.tree.selectedNode())}isRootNode(){const e=this.tree.selectedNode();return!(!e||null!==this.tree.findParentNode(e))}selectedIsBool(){if(this.tree){const e=this.tree.selectedNode();return e&&e.callerData.point.bool_op()}return!1}addChildNode(e){this.changesMade=!0;const t=this.tree.selectedNode();let c;e?(c=t.callerData.point,c.ischanged(!0),["bool_op","svf","tag","subfield","heading"].forEach(e=>c[e](null))):(c=this.idl.create("vmsp"),c.id(this.newId--),c.isnew(!0),c.parent(t.id),c.match_set(this.matchSet_.id()),c.children([]));const i=this.newPoint.values.pointType;if("bool"===i?c.bool_op(this.newPoint.values.boolOp):("attr"===i?c.svf(this.newPoint.values.recordAttr):"marc"===i?(c.tag(this.newPoint.values.marcTag),c.subfield(this.newPoint.values.marcSf)):"heading"===i&&c.heading(!0),c.negate(this.newPoint.values.negate),c.quality(this.newPoint.values.matchScore)),e)t.label=null,this.setNodeLabel(t,c);else{const e=new no.b({id:c.id(),callerData:{point:c}});this.setNodeLabel(e,c).then(()=>t.children.push(e))}}expressionAsString(){if(!this.tree)return"";const e=t=>t?t.children.length?"("+t.children.map(e).join(" "+t.callerData.slimLabel+" ")+")":t.callerData.point.bool_op()?"()":t.callerData.slimLabel:"";return e(this.tree.rootNode)}saveTree(){const e=t=>{t||(t=this.tree.rootNode);const c=t.callerData.point;return t.children.forEach(t=>c.children().push(e(t))),c},t=e();return this.net.request("open-ils.vandelay","open-ils.vandelay.match_set.update",this.auth.token(),this.matchSet_.id(),t).toPromise().then(e=>this.refreshTree(),e=>console.error(e))}}return e.\u0275fac=function(t){return new(t||e)(Q.Lb(h.a),Q.Lb(v.a),Q.Lb(m.b),Q.Lb(g.a),Q.Lb(p.a),Q.Lb(so.a))},e.\u0275cmp=Q.Fb({type:e,selectors:[["eg-match-set-expression"]],viewQuery:function(e,t){var c;1&e&&Q.Ic(qo,!0),2&e&&Q.yc(c=Q.gc())&&(t.newPoint=c.first)},inputs:{matchSet:"matchSet"},decls:23,vars:8,consts:[["nodeStrTmpl",""],["key","staff.cat.vandelay.matchpoint.label",3,"template"],[1,"row","mt-2"],[1,"col-lg-7"],[1,"row","ml-2"],[1,"text-white","bg-dark","p-2"],[1,"row","ml-2","mt-4"],[1,"mr-2"],["class","btn btn-outline-dark mr-2",3,"click",4,"ngIf"],[1,"btn","btn-outline-dark","mr-2",3,"click"],[3,"pointType"],["newPoint",""],["class","row mt-2 ml-2",4,"ngIf"],["class","row mt-2 ml-2 font-italic",4,"ngIf"],[1,"col-lg-5"],[4,"ngIf"],[1,"row","mt-2","ml-2"],[1,"btn","btn-success",3,"disabled","click"],[1,"btn","btn-success","ml-3",3,"disabled","click"],[1,"row","mt-2","ml-2","font-italic"],[1,"d-flex"],[1,"btn","btn-warning","mr-1",3,"disabled","click"],[1,"btn","btn-success","mr-1",3,"disabled","click"],[1,"pt-2"],[3,"tree","nodeClicked"]],template:function(e,t){if(1&e&&(Q.Kc(0,Uo,2,1,"ng-template",null,0,Q.Lc),Q.Mb(2,"eg-string",1),Q.Rb(3,"div",2),Q.Rb(4,"div",3),Q.Rb(5,"div",4),Q.Rb(6,"span",5),Q.Vb(7,ko),Q.Qb(),Q.Qb(),Q.Rb(8,"div",6),Q.Rb(9,"span",7),Q.Vb(10,$o),Q.Qb(),Q.Kc(11,jo,2,0,"button",8),Q.Rb(12,"button",9),Q.fc("click",(function(){return t.newPointType="marc"})),Q.Vb(13,Co),Q.Qb(),Q.Kc(14,Ho,2,0,"button",8),Q.Rb(15,"button",9),Q.fc("click",(function(){return t.newPointType="bool"})),Q.Vb(16,Po),Q.Qb(),Q.Qb(),Q.Mb(17,"eg-match-set-new-point",10,11),Q.Kc(19,Wo,5,2,"div",12),Q.Kc(20,Zo,6,0,"div",13),Q.Qb(),Q.Rb(21,"div",14),Q.Kc(22,Yo,8,3,"ng-container",15),Q.Qb(),Q.Qb()),2&e){const e=Q.zc(1);Q.xb(2),Q.oc("template",e),Q.xb(5),Q.Zb(t.expressionAsString()),Q.Wb(7),Q.xb(4),Q.oc("ngIf","biblio"==t.matchSetType),Q.xb(3),Q.oc("ngIf","authority"==t.matchSetType),Q.xb(3),Q.oc("pointType",t.newPointType),Q.xb(2),Q.oc("ngIf",t.newPointType),Q.xb(1),Q.oc("ngIf",t.newPointType),Q.xb(2),Q.oc("ngIf",t.tree)}},directives:[_o.a,x.v,Mo,wo.a],encapsulation:2}),e})();const ea=["newPoint"],ta=["grid"];var ca,ia;ca=$localize`:␟0a384f59f4707af0f4694f1aa59cd84dee913241␟6205540213661359687:Add New:`,ia=$localize`:␟e8a24d502e3b4b22eb24eaa1ef27bad057950b54␟7458506762923954279:MARC Tag and Subfield`;const oa=["label",$localize`:␟96e678d5f4bfe1a041ecfcd34804efa5e100d5e8␟5167284364083276913:Delete Selected`];var aa,ra,na;function sa(e,t){if(1&e){const e=Q.Sb();Q.Rb(0,"button",5),Q.fc("click",(function(){return Q.Bc(e),Q.hc().newPointType="attr"})),Q.Vb(1,aa),Q.Qb()}}function ba(e,t){if(1&e){const e=Q.Sb();Q.Rb(0,"div",12),Q.Rb(1,"button",13),Q.fc("click",(function(){return Q.Bc(e),Q.hc().addQuality()})),Q.Vb(2,ra),Q.Qb(),Q.Rb(3,"button",14),Q.fc("click",(function(){return Q.Bc(e),Q.hc().newPointType=null})),Q.Vb(4,na),Q.Qb(),Q.Qb()}}aa=$localize`:␟e726c799b03da39783751ce3aa327495919e40cb␟7410001636246507654:Record Attribute`,ra=$localize`:␟f6755cff4957d5c3c89bafce5651f1b6fa2b1fd9␟3249513483374643425:Add`,na=$localize`:␟d7b35c384aecd25a516200d6921836374613dfe7␟2159130950882492111:Cancel`;let la=(()=>{class e{constructor(e,t,c,i,o){this.idl=e,this.pcrud=t,this.net=c,this.auth=i,this.org=o,this.dataSource=new Bt.c,this.dataSource.getRows=(e,t)=>{if(!this.matchSet_)return Object(Nt.a)();const c={};t.length&&(c.vmsq=t[0].name+" "+t[0].dir);const i={offset:e.offset,limit:e.limit,order_by:c},o={match_set:this.matchSet_.id()};return this.pcrud.search("vmsq",o,i)},this.deleteSelected=e=>{this.pcrud.remove(e).subscribe(e=>console.log("deleted ",e),e=>console.error(e),()=>this.grid.reload())}}set matchSet(e){this.matchSet_=e,e&&(this.matchSetType=e.mtype(),this.grid&&this.grid.reload())}ngOnInit(){}addQuality(){const e=this.idl.create("vmsq"),t=this.newPoint.values;e.match_set(this.matchSet_.id()),e.quality(t.matchScore),e.value(t.value),t.recordAttr?e.svf(t.recordAttr):(e.tag(t.marcTag),e.subfield(t.marcSf)),this.pcrud.create(e).subscribe(e=>console.debug("created ",e),e=>console.error(e),()=>{this.newPointType=null,this.grid.reload()})}}return e.\u0275fac=function(t){return new(t||e)(Q.Lb(h.a),Q.Lb(v.a),Q.Lb(m.b),Q.Lb(g.a),Q.Lb(p.a))},e.\u0275cmp=Q.Fb({type:e,selectors:[["eg-match-set-quality"]],viewQuery:function(e,t){var c;1&e&&(Q.Ic(ea,!0),Q.Ic(ta,!0)),2&e&&(Q.yc(c=Q.gc())&&(t.newPoint=c.first),Q.yc(c=Q.gc())&&(t.grid=c.first))},inputs:{matchSet:"matchSet"},decls:15,vars:6,consts:[[1,"row","mt-2"],[1,"col-lg-7"],[1,"row","ml-2","mt-4"],[1,"mr-2"],["class","btn btn-outline-dark mr-2",3,"click",4,"ngIf"],[1,"btn","btn-outline-dark","mr-2",3,"click"],[3,"pointType","isForQuality"],["newPoint",""],["class","row mt-2 ml-2",4,"ngIf"],["idlClass","vmsq","persistKey","staff.cat.vandelay.match_set.quality",3,"dataSource"],["grid",""],[3,"action",6,"label"],[1,"row","mt-2","ml-2"],[1,"btn","btn-success","mr-2",3,"click"],[1,"btn","btn-warning",3,"click"]],template:function(e,t){1&e&&(Q.Rb(0,"div",0),Q.Rb(1,"div",1),Q.Rb(2,"div",2),Q.Rb(3,"span",3),Q.Vb(4,ca),Q.Qb(),Q.Kc(5,sa,2,0,"button",4),Q.Rb(6,"button",5),Q.fc("click",(function(){return t.newPointType="marc"})),Q.Vb(7,ia),Q.Qb(),Q.Qb(),Q.Mb(8,"eg-match-set-new-point",6,7),Q.Kc(10,ba,5,0,"div",8),Q.Qb(),Q.Qb(),Q.Rb(11,"eg-grid",9,10),Q.Rb(13,"eg-grid-toolbar-action",11),Q.Xb(14,oa),Q.Qb(),Q.Qb()),2&e&&(Q.xb(5),Q.oc("ngIf","biblio"==t.matchSetType),Q.xb(3),Q.oc("pointType",t.newPointType)("isForQuality",!0),Q.xb(2),Q.oc("ngIf",t.newPointType),Q.xb(1),Q.oc("dataSource",t.dataSource),Q.xb(2),Q.oc("action",t.deleteSelected))},directives:[x.v,Mo,Vt.a,Dt.a],encapsulation:2}),e})();const da=["title",$localize`:␟01b51b35626f9400409315f4e2f667a7ac8b0710␟5092259295843627570:Match Set Editor`],ua=["title",$localize`:␟079e9d1c25650c8b206e3c01b47a2378de4adcb4␟3975344561710508425:Match Set Quality Metrics`];var fa,ha,pa,ma;function ga(e,t){if(1&e&&(Q.Rb(0,"div",5),Q.Rb(1,"div",6),Q.Rb(2,"div",7),Q.Rb(3,"h5",8),Q.Vb(4,fa),Q.Qb(),Q.Rb(5,"div",9),Q.Rb(6,"div",10),Q.Rb(7,"div",11),Q.Vb(8,ha),Q.Qb(),Q.Rb(9,"div",11),Q.Mc(10),Q.Qb(),Q.Qb(),Q.Rb(11,"div",10),Q.Rb(12,"div",11),Q.Vb(13,pa),Q.Qb(),Q.Rb(14,"div",11),Q.Mc(15),Q.Qb(),Q.Qb(),Q.Rb(16,"div",10),Q.Rb(17,"div",11),Q.Vb(18,ma),Q.Qb(),Q.Rb(19,"div",11),Q.Mc(20),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb()),2&e){const e=Q.hc();Q.xb(10),Q.Nc(e.matchSet.name()),Q.xb(5),Q.Nc(e.matchSet.owner().shortname()),Q.xb(5),Q.Nc(e.matchSet.mtype())}}function va(e,t){if(1&e&&Q.Mb(0,"eg-match-set-expression",12),2&e){const e=Q.hc();Q.oc("matchSet",e.matchSet)}}function Ra(e,t){if(1&e&&Q.Mb(0,"eg-match-set-quality",12),2&e){const e=Q.hc();Q.oc("matchSet",e.matchSet)}}fa=$localize`:␟246790e38037bd5017feac4961101c3b4d883662␟10341640407111545:Match Set Summary`,ha=$localize`:␟220c2fa9684cd88049f0076af3b151b24dcbf3a1␟6055370700598406739:Match Set Name:`,pa=$localize`:␟143fa28797a5decd9321c014021c2c762849f81a␟8291217115871231801:Owning Library:`,ma=$localize`:␟e78c0d60ac39787f62c9159646fe0b3c1ed55a1d␟2736556170366900089:Type:`;let ya=(()=>{class e{constructor(e,t,c,i){this.router=e,this.route=t,this.pcrud=c,this.org=i,this.route.paramMap.subscribe(e=>{this.matchSetId=+e.get("id"),this.matchSetTab=e.get("matchSetTab")})}ngOnInit(){this.pcrud.retrieve("vms",this.matchSetId).toPromise().then(e=>{e.owner(this.org.get(e.owner())),this.matchSet=e})}onTabChange(e){this.matchSetTab=e.nextId,e.preventDefault(),this.router.navigate([`/staff/cat/vandelay/match_sets/${this.matchSetId}/${this.matchSetTab}`])}}return e.\u0275fac=function(t){return new(t||e)(Q.Lb(b.c),Q.Lb(b.a),Q.Lb(v.a),Q.Lb(p.a))},e.\u0275cmp=Q.Fb({type:e,selectors:[["ng-component"]],decls:8,vars:2,consts:[["class","row pb-2",4,"ngIf"],[3,"activeId","tabChange"],["id","editor",6,"title"],["ngbTabContent",""],["id","quality",6,"title"],[1,"row","pb-2"],[1,"col-lg-4"],[1,"card","tight-card"],[1,"card-header"],[1,"card-body"],[1,"row"],[1,"col-lg-6"],[3,"matchSet"]],template:function(e,t){1&e&&(Q.Kc(0,ga,21,3,"div",0),Q.Rb(1,"ngb-tabset",1),Q.fc("tabChange",(function(e){return t.onTabChange(e)})),Q.Rb(2,"ngb-tab",2),Q.Xb(3,da),Q.Kc(4,va,1,1,"ng-template",3),Q.Qb(),Q.Rb(5,"ngb-tab",4),Q.Xb(6,ua),Q.Kc(7,Ra,1,1,"ng-template",3),Q.Qb(),Q.Qb()),2&e&&(Q.oc("ngIf",t.matchSet),Q.xb(1),Q.oc("activeId",t.matchSetTab))},directives:[x.v,bt.W,bt.T,bt.U,Jo,la],encapsulation:2}),e})();var Qa,Sa,Ta,Ia,xa,Ma,_a,wa,qa,ka=c("LTyc");function $a(e,t){1&e&&(Q.Rb(0,"div"),Q.Rb(1,"div",8),Q.Rb(2,"div",1),Q.Rb(3,"div",9),Q.Rb(4,"span"),Q.Vb(5,Sa),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb())}function Ca(e,t){if(1&e&&(Q.Rb(0,"span"),Q.bc(1,Ia),Q.Mb(2,"a",20),Q.Yb(),Q.Qb()),2&e){const e=Q.hc().$implicit;Q.xb(2),Q.rc("routerLink","/staff/cat/vandelay/queue/",e.record_type(),"/",e.queue().id(),""),Q.Zb(e.queue().name()),Q.Wb(1)}}function Pa(e,t){1&e&&(Q.Rb(0,"span",21),Q.Vb(1,xa),Q.Qb())}function Oa(e,t){1&e&&(Q.Rb(0,"span",21),Q.Vb(1,Ma),Q.Qb())}function za(e,t){1&e&&(Q.Rb(0,"span"),Q.Vb(1,_a),Q.Qb())}function La(e,t){1&e&&(Q.Rb(0,"span"),Q.Vb(1,wa),Q.Qb())}function Aa(e,t){1&e&&(Q.Rb(0,"span"),Q.Vb(1,qa),Q.Qb())}function Ea(e,t){1&e&&(Q.Rb(0,"span",22),Q.Rb(1,"span",23),Q.Mc(2,"thumb_up"),Q.Qb(),Q.Qb())}function Na(e,t){if(1&e&&(Q.Rb(0,"div",10),Q.Rb(1,"div",11),Q.Rb(2,"div",12),Q.Rb(3,"div",13),Q.Rb(4,"div",14),Q.Rb(5,"span"),Q.bc(6,Ta),Q.ic(7,"date"),Q.Mb(8,"span",15),Q.Yb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Rb(9,"div",16),Q.Rb(10,"div",8),Q.Rb(11,"div",1),Q.Mb(12,"eg-progress-inline",17),Q.Qb(),Q.Rb(13,"div",1),Q.Kc(14,Ca,3,3,"span",6),Q.Kc(15,Pa,2,0,"span",18),Q.Kc(16,Oa,2,0,"span",18),Q.Kc(17,za,2,0,"span",6),Q.Kc(18,La,2,0,"span",6),Q.Kc(19,Aa,2,0,"span",6),Q.Kc(20,Ea,3,0,"span",19),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb()),2&e){const e=t.$implicit;Q.xb(8),Q.Zb(Q.kc(7,11,e.create_time(),"short"))(e.name()),Q.Wb(6),Q.xb(4),Q.oc("max","complete"==e.state()?e.actions_performed():e.total_actions()||null)("value",e.actions_performed()),Q.xb(2),Q.oc("ngIf",e.queue().id),Q.xb(1),Q.oc("ngIf","enqueue"==e.action_type()),Q.xb(1),Q.oc("ngIf","import"==e.action_type()),Q.xb(1),Q.oc("ngIf","active"==e.state()),Q.xb(1),Q.oc("ngIf","complete"==e.state()),Q.xb(1),Q.oc("ngIf","error"==e.state()),Q.xb(1),Q.oc("ngIf","complete"==e.state())}}Qa=$localize`:␟f16c21a87a1ac0362ad7cc13b2cbda8fdd344200␟3833321868727649730:Show Sessions Since: `,Sa=$localize`:␟1dbb7f4f4c10f2334407bd01c13f3d3d1e5a11f2␟2089027763324618149:No Import Sessions To Display`,Ta=$localize`:␟78fc25f58d39e27a168238bf9f3f733719a95616␟2953380955998906150: ${"\ufffd0\ufffd"}:INTERPOLATION: : ${"\ufffd#8\ufffd"}:START_TAG_SPAN:${"\ufffd1\ufffd"}:INTERPOLATION_1:${"\ufffd/#8\ufffd"}:CLOSE_TAG_SPAN:`,Ia=$localize`:␟6d2c88451fd2a7337c669bd612b598222a70e471␟9215776011298069894:${"\ufffd#2\ufffd"}:START_LINK: Queue ${"\ufffd0\ufffd"}:INTERPOLATION: ${"\ufffd/#2\ufffd"}:CLOSE_LINK:`,xa=$localize`:␟7b4c4e20f42c6daf48037fb01721e332c69f7d66␟3393069604584373022:Enqueuing... `,Ma=$localize`:␟dafc6622f83cd0b043f872883850fb9fa90a3be0␟1193668558159304259:Importing... `,_a=$localize`:␟b36e1450940b7f6028d8587568c7d669b53f7a06␟8204176479746810612:Active`,wa=$localize`:␟bf612b44e3ba6c05c219aceac6a6ed6c37df1dc4␟8384225360105280028:Complete`,qa=$localize`:␟6080b77234e92ad41bb52653b239c4c4f851317d␟1519954996184640001:Error`;const Va=[{path:"",component:L,children:[{path:"",pathMatch:"full",redirectTo:"import"},{path:"import",component:nt},{path:"export",component:Et},{path:"export/basket",component:Et},{path:"queue",component:tc},{path:"queue/:qtype/:id",component:Xc},{path:"queue/:qtype/:id/record/:recordId",component:Ci},{path:"queue/:qtype/:id/record/:recordId/:recordTab",component:Ci},{path:"queue/:qtype/:id/items",component:Fi},{path:"display_attrs",component:Ei},{path:"display_attrs/:atype",component:Ei},{path:"merge_profiles",component:Ni},{path:"holdings_profiles",component:Vi},{path:"match_sets",component:ao},{path:"match_sets/:id/:matchSetTab",component:ya},{path:"active_imports",component:(()=>{class e{constructor(e,t,c,i){this.idl=e,this.auth=t,this.pcrud=c,this.vandelay=i,this.refreshInterval=2e3,this.trackers=[]}ngOnInit(){const e=new Date;e.setHours(0),e.setMinutes(0),e.setSeconds(0),this.sinceDate=e.toISOString(),this.pollTrackers()}dateFilterChange(e){e&&(this.sinceDate=e,this.pollTimeout&&(clearTimeout(this.pollTimeout),this.pollTimeout=null),this.trackers=[],this.pollTrackers())}pollTrackers(){const e={"-and":[{"-or":[{workstation:this.auth.user().wsid()},{usr:this.auth.user().id()}]},{"-or":[{create_time:{">=":this.sinceDate}},{state:"active"}]}]};this.pcrud.search("vst",e,{order_by:{vst:"create_time"}}).subscribe(e=>{const t=this.trackers.filter(t=>t.id()===e.id())[0];if(t)t.update_time(e.update_time()),t.state(e.state()),t.total_actions(e.total_actions()),t.actions_performed(e.actions_performed());else{const t=this.trackers.filter(t=>t.session_key()===e.session_key())[0];if(t)if("enqueue"===t.action_type())for(let e=0;e<this.trackers.length;e++){const c=this.trackers[e];if(c.id()===t.id()){console.debug(`removing tracker ${c.id()} from the list`),this.trackers.splice(e,1);break}}else if("import"===t.action_type())return;console.debug(`adding tracker ${e.id()} to list`),this.trackers.unshift(e),this.fleshTrackerQueue(e)}},e=>{},()=>{const e=this.trackers.filter(e=>"active"===e.state());this.pollTimeout=e.length>0?setTimeout(()=>this.pollTrackers(),this.refreshInterval):null})}fleshTrackerQueue(e){const t="bib"===e.record_type()?"vbq":"vaq";this.pcrud.retrieve(t,e.queue()).subscribe(t=>e.queue(t))}}return e.\u0275fac=function(t){return new(t||e)(Q.Lb(h.a),Q.Lb(g.a),Q.Lb(v.a),Q.Lb(T))},e.\u0275cmp=Q.Fb({type:e,selectors:[["ng-component"]],decls:9,vars:3,consts:[[1,"row","mb-2"],[1,"col-lg-6"],[1,"input-group"],[1,"input-group-prepend"],[1,"input-group-text"],[3,"initialIso","onChangeAsIso"],[4,"ngIf"],["class","row mb-4",4,"ngFor","ngForOf"],[1,"row"],[1,"alert","alert-info"],[1,"row","mb-4"],[1,"col-lg-12"],[1,"card","tight-card"],[1,"card-header"],[1,"panel-title"],[1,"font-weight-bold"],[1,"card-body"],[3,"max","value"],["class","pl-2",4,"ngIf"],["class","pl-3",4,"ngIf"],[1,"font-weight-bold",3,"routerLink"],[1,"pl-2"],[1,"pl-3"],[1,"material-icons","text-success"]],template:function(e,t){1&e&&(Q.Rb(0,"div",0),Q.Rb(1,"div",1),Q.Rb(2,"div",2),Q.Rb(3,"div",3),Q.Rb(4,"span",4),Q.Vb(5,Qa),Q.Qb(),Q.Qb(),Q.Rb(6,"eg-date-select",5),Q.fc("onChangeAsIso",(function(e){return t.dateFilterChange(e)})),Q.Qb(),Q.Qb(),Q.Qb(),Q.Qb(),Q.Kc(7,$a,6,0,"div",6),Q.Kc(8,Na,21,14,"div",7)),2&e&&(Q.xb(6),Q.oc("initialIso",t.sinceDate),Q.xb(1),Q.oc("ngIf",0==t.trackers.length),Q.xb(1),Q.oc("ngForOf",t.trackers))},directives:[ka.a,x.v,x.u,N.a,b.f],pipes:[x.f],encapsulation:2}),e})()}]}];let Ba=(()=>{class e{}return e.\u0275mod=Q.Jb({type:e}),e.\u0275inj=Q.Ib({factory:function(t){return new(t||e)},providers:[],imports:[[b.g.forChild(Va)],b.g]}),e})();var Da=c("9u+K");let Ka=(()=>{class e{}return e.\u0275mod=Q.Jb({type:e}),e.\u0275inj=Q.Ib({factory:function(t){return new(t||e)},providers:[T],imports:[[n.a,o.a,i.a,s.a,Da.a,a.a,Ba,r.b]]}),e})()},Iab2:function(e,t,c){var i,o;void 0===(o="function"==typeof(i=function(){"use strict";function t(e,t,c){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){a(i.response,t,c)},i.onerror=function(){console.error("could not download file")},i.send()}function c(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function i(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(t){var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(c)}}var o="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,a=o.saveAs||("object"!=typeof window||window!==o?function(){}:"download"in HTMLAnchorElement.prototype?function(e,a,r){var n=o.URL||o.webkitURL,s=document.createElement("a");s.download=a=a||e.name||"download",s.rel="noopener","string"==typeof e?(s.href=e,s.origin===location.origin?i(s):c(s.href)?t(e,a,r):i(s,s.target="_blank")):(s.href=n.createObjectURL(e),setTimeout((function(){n.revokeObjectURL(s.href)}),4e4),setTimeout((function(){i(s)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,o,a){if(o=o||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,a),o);else if(c(e))t(e,o,a);else{var r=document.createElement("a");r.href=e,r.target="_blank",setTimeout((function(){i(r)}))}}:function(e,c,i,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return t(e,c,i);var r="application/octet-stream"===e.type,n=/constructor/i.test(o.HTMLElement)||o.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);if((s||r&&n)&&"object"==typeof FileReader){var b=new FileReader;b.onloadend=function(){var e=b.result;e=s?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=e:location=e,a=null},b.readAsDataURL(e)}else{var l=o.URL||o.webkitURL,d=l.createObjectURL(e);a?a.location=d:location.href=d,a=null,setTimeout((function(){l.revokeObjectURL(d)}),4e4)}});o.saveAs=a.saveAs=a,e.exports=a})?i.apply(t,[]):i)||(e.exports=o)}}]);