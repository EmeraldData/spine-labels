(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{FYik:function(e,t,i){"use strict";i.r(t),i.d(t,"ManageWorkstationsModule",(function(){return K}));var o=i("MZHd"),s=i("tyNb"),a=i("OXuP"),n=i("Osig"),r=i("wN9v"),c=i("8PDw"),b=i("cm5s"),l=i("EQDH"),d=i("36iw"),h=i("87XM"),f=i("fXoL"),g=i("ufrD"),u=i("ayJW"),m=i("ofXK"),w=i("wVJ/"),p=i("3Pt+");const k=["workstationExistsDialog"],R=["bannerText",$localize`:␟38431f0ad5c20d964932539a4f290c2cf68b5c09␟7390058263711243394:Workstation Administration`],v=["prefix",$localize`:␟3beb59fdccfcd091186316549dc06941a0c77e60␟2222955184841578201:Manage Workstations`],N=["dialogTitle",$localize`:␟fd3ba2eb084d6115d5dd490fcbaa4e59ed936c01␟1997822011035487300:Workstation Exists`,"dialogBody",$localize`:␟f9ca4bb65a34fe10bcdac8b25e267832804fcbe4␟8178467473316439193:Workstation "${"\ufffd0\ufffd"}:INTERPOLATION:" already exists.  Use it anyway?`];var Q;Q=$localize`:␟9394e2bd4000f6369cfbafa766966e3baf022266␟7970895831025577731:Register a New Workstation For This Browser`;const W=["placeholder",$localize`:␟b9229fd210a2c9a79f07fad0818645f5876c0bc0␟4877921883699113157:Owner...`],O=["title",$localize`:␟ad17620e2d036bcadd0aa37137f44e4c9b572407␟4128758440503314208:Workstation Name`,"placeholder",$localize`:␟d8bf4237152d28d545cf73076ed0c89dbe408305␟2437899456176608310:Workstation Name...`];var x,I,$,T,y,D,L,M;function z(e,t){if(1&e&&(f.Rb(0,"div",23),f.Vb(1,D),f.Qb()),2&e){const e=f.hc();f.xb(1),f.Zb(e.removeWorkstation),f.Wb(1)}}function E(e,t){1&e&&(f.Rb(0,"div",24),f.Rb(1,"span"),f.Vb(2,L),f.Qb(),f.Qb())}function A(e,t){if(1&e&&(f.Rb(0,"span"),f.Vb(1,M),f.Qb()),2&e){const e=f.hc().$implicit;f.xb(1),f.Zb(e.name),f.Wb(1)}}function S(e,t){if(1&e&&(f.Rb(0,"span"),f.Mc(1),f.Qb()),2&e){const e=f.hc().$implicit;f.xb(1),f.Oc(" ",e.name," ")}}function C(e,t){if(1&e&&(f.Rb(0,"option",25),f.Kc(1,A,2,1,"span",26),f.Kc(2,S,2,1,"span",26),f.Qb()),2&e){const e=t.$implicit,i=f.hc();f.pc("value",e.name),f.xb(1),f.oc("ngIf",e.name==i.defaultName),f.xb(1),f.oc("ngIf",e.name!=i.defaultName)}}x=$localize`:␟cfc2f436ec2beffb042e7511a73c89c372e86a6c␟3301086086650990787:Register`,I=$localize`:␟d6b99f0b855ddc164f8c286e69eb2be89bda94e9␟562759173343085225:Workstations Registered With This Browser`,$=$localize`:␟19dd04e03ee1b386d5b4c032e1e602c1c0dc55ab␟1380688330048661041: Use Now `,T=$localize`:␟5ad0c0966d86bd108891da9882e4f8cab93ee58c␟8279112284155000833: Mark As Default `,y=$localize`:␟6222a0da77a892954456d3fff33247419bb4d8f0␟3354652787858636348: Remove `,D=$localize`:␟cf2387a275cd410f6c1d461ecd6423a1c29a6562␟3310296881116206426: Workstation ${"\ufffd0\ufffd"}:INTERPOLATION: is no longer valid. Removing registration. `,L=$localize`:␟0a73e6de3fe7d8e1fd87ed426bd4093e1c5f8a2e␟9153541225692383310:Please register a workstation.`,M=$localize`:␟c28c401e8b62d93a7961f251743b2c5f1297a30d␟7168319777817109423: ${"\ufffd0\ufffd"}:INTERPOLATION: (Default) `;let P=(()=>{class e{constructor(e,t,i,o,s,a,n,r,c){this.router=e,this.route=t,this.evt=i,this.net=o,this.store=s,this.auth=a,this.org=n,this.hatch=r,this.perm=c,this.workstations=[],this.orgOnChange=e=>{this.newOwner=e}}ngOnInit(){this.store.getWorkstations().then(e=>(this.workstations=e||[],this.setNewName())).then(e=>this.store.getDefaultWorkstation()).then(e=>{this.defaultName=e,this.selectedName=this.auth.workstation()||this.defaultName;const t=this.route.snapshot.paramMap.get("remove");t&&this.removeSelected(this.removeWorkstation=t)}),this.perm.hasWorkPermAt(["REGISTER_WORKSTATION"],!0).then(e=>{this.disableOrgs=this.org.filterList({canHaveUsers:!1},!0).concat(this.org.filterList({notInList:e.REGISTER_WORKSTATION},!0))})}selected(){return this.workstations.filter(e=>e.name===this.selectedName)[0]}useNow(){this.selected()&&this.router.navigate(["/staff/login"],{queryParams:{workstation:this.selected().name}})}setDefault(){this.selected()&&(this.defaultName=this.selected().name,this.store.setDefaultWorkstation(this.defaultName))}removeSelected(e){e||(e=this.selected().name),this.workstations=this.workstations.filter(t=>t.name!==e),this.store.setWorkstations(this.workstations)}setNewName(){this.hatch.hostname().then(e=>this.newName=e||"")}canDeleteSelected(){return!0}registerWorkstation(){console.log(`Registering new workstation "${this.newName}" at ${this.newOwner.shortname()}`),this.newName=this.newOwner.shortname()+"-"+this.newName,this.registerWorkstationApi().then(e=>this.registerWorkstationLocal(e),e=>console.log("Workstation registration canceled/failed"))}handleCollision(){return new Promise((e,t)=>{this.wsExistsDialog.open().subscribe(i=>{i&&this.registerWorkstationApi(!0).then(t=>e(t),e=>t(e))})})}registerWorkstationApi(e){let t="open-ils.actor.workstation.register";return e&&(t+=".override"),new Promise((e,i)=>{this.net.request("open-ils.actor",t,this.auth.token(),this.newName,this.newOwner.id()).subscribe(t=>{const o=this.evt.parse(t);o?"WORKSTATION_NAME_EXISTS"===o.textcode?this.handleCollision().then(t=>e(t),e=>i(e)):(console.error("Registration failed "+o),i()):e(t)})})}registerWorkstationLocal(e){const t={id:e,name:this.newName,owning_lib:this.newOwner.id()};this.workstations.push(t),this.store.setWorkstations(this.workstations),this.newName="",1===this.workstations.length&&(this.selectedName=t.name,this.setDefault())}}return e.\u0275fac=function(t){return new(t||e)(f.Lb(s.c),f.Lb(s.a),f.Lb(l.a),f.Lb(n.b),f.Lb(a.a),f.Lb(c.a),f.Lb(b.a),f.Lb(h.b),f.Lb(r.a))},e.\u0275cmp=f.Fb({type:e,selectors:[["ng-component"]],viewQuery:function(e,t){var i;1&e&&f.Ic(k,!0),2&e&&f.yc(i=f.gc())&&(t.wsExistsDialog=i.first)},decls:42,vars:13,consts:[[6,"bannerText"],[6,"prefix"],[6,"dialogTitle","dialogBody"],["workstationExistsDialog",""],[1,"row"],[1,"col-lg-8","offset-1","mt-3"],["class","alert alert-warning",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"col"],[1,"row","mt-2"],[1,"col-lg-2"],[3,"applyDefault","hideOrgs","disableOrgs","onChange",6,"placeholder"],[1,"col-lg-6"],[1,"input-group"],["type","text",1,"form-control",3,"ngModel","ngModelChange",6,"title","placeholder"],[1,"input-group-btn"],[1,"btn","btn-outline-dark",3,"disabled","click"],[1,"row","mt-3","pt-3","border","border-left-0","border-right-0","border-bottom-0","border-light"],[1,"col-lg-8"],[1,"form-control",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"btn","btn-success",3,"disabled","click"],[1,"btn","btn-danger",3,"disabled","click"],[1,"alert","alert-warning"],[1,"alert","alert-danger"],[3,"value"],[4,"ngIf"]],template:function(e,t){1&e&&(f.Rb(0,"eg-staff-banner",0),f.Xb(1,R),f.Qb(),f.Rb(2,"eg-title",1),f.Xb(3,v),f.Qb(),f.Rb(4,"eg-confirm-dialog",2,3),f.Xb(6,N),f.Qb(),f.Rb(7,"div",4),f.Rb(8,"div",5),f.Kc(9,z,2,1,"div",6),f.Kc(10,E,3,0,"div",7),f.Rb(11,"div",4),f.Rb(12,"div",8),f.Vb(13,Q),f.Qb(),f.Qb(),f.Rb(14,"div",9),f.Rb(15,"div",10),f.Rb(16,"eg-org-select",11),f.Xb(17,W),f.fc("onChange",(function(e){return t.orgOnChange(e)})),f.Qb(),f.Qb(),f.Rb(18,"div",12),f.Rb(19,"div",13),f.Rb(20,"input",14),f.Xb(21,O),f.fc("ngModelChange",(function(e){return t.newName=e})),f.Qb(),f.Rb(22,"div",15),f.Rb(23,"button",16),f.fc("click",(function(){return t.registerWorkstation()})),f.Rb(24,"span"),f.Vb(25,x),f.Qb(),f.Qb(),f.Qb(),f.Qb(),f.Qb(),f.Qb(),f.Rb(26,"div",17),f.Rb(27,"div",8),f.Rb(28,"span"),f.Vb(29,I),f.Qb(),f.Qb(),f.Qb(),f.Rb(30,"div",4),f.Rb(31,"div",18),f.Rb(32,"select",19),f.fc("ngModelChange",(function(e){return t.selectedName=e})),f.Kc(33,C,3,3,"option",20),f.Qb(),f.Qb(),f.Qb(),f.Rb(34,"div",9),f.Rb(35,"div",12),f.Rb(36,"button",21),f.fc("click",(function(){return t.useNow()})),f.Vb(37,$),f.Qb(),f.Rb(38,"button",16),f.fc("click",(function(){return t.setDefault()})),f.Vb(39,T),f.Qb(),f.Rb(40,"button",22),f.fc("click",(function(){return t.removeSelected()})),f.Vb(41,y),f.Qb(),f.Qb(),f.Qb(),f.Qb(),f.Qb()),2&e&&(f.xb(4),f.Zb(t.newName),f.Wb(6),f.xb(5),f.oc("ngIf",t.removeWorkstation),f.xb(1),f.oc("ngIf",0==t.workstations.length),f.xb(6),f.oc("applyDefault",!0)("hideOrgs",t.hideOrgs)("disableOrgs",t.disableOrgs),f.xb(4),f.oc("ngModel",t.newName),f.xb(3),f.oc("disabled",!t.newName||!t.newOwner),f.xb(9),f.oc("ngModel",t.selectedName),f.xb(1),f.oc("ngForOf",t.workstations),f.xb(3),f.oc("disabled",!t.selected),f.xb(2),f.oc("disabled",!t.selected),f.xb(2),f.oc("disabled",!t.selected||!t.canDeleteSelected()))},directives:[g.a,u.a,d.a,m.v,w.a,p.c,p.t,p.w,p.F,m.u,p.y,p.I],encapsulation:2}),e})();const V=[{path:"manage",component:P},{path:"remove/:remove",component:P}];let X=(()=>{class e{}return e.\u0275mod=f.Jb({type:e}),e.\u0275inj=f.Ib({factory:function(t){return new(t||e)},imports:[[s.g.forChild(V)],s.g]}),e})(),K=(()=>{class e{}return e.\u0275mod=f.Jb({type:e}),e.\u0275inj=f.Ib({factory:function(t){return new(t||e)},imports:[[o.a,X]]}),e})()}}]);